<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>STM8S/A Standard Peripherals Firmware Library: stm8s_i2c.c Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />



</head>
<body><script language="javascript">
if (window.name != "content")
    document.write("<center><a href='index.html?page=stm8s__i2c_8c_source.html'>show framing</a></center>")
</script>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">STM8S/A Standard Peripherals Firmware Library
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.5.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="dir_99fee8dcdd0167cb7ca79288e08b10f1.html">STM8S_StdPeriph_Lib_V2.3.0</a>      </li>
      <li class="navelem"><a class="el" href="dir_f5da7e899866e3fe224c5708fd2dd723.html">Libraries</a>      </li>
      <li class="navelem"><a class="el" href="dir_c53ce1dacb9f624efb36b49d8509ea3b.html">STM8S_StdPeriph_Driver</a>      </li>
      <li class="navelem"><a class="el" href="dir_52950623546e9b39c79b5c109bbbfc22.html">src</a>      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">stm8s_i2c.c</div>  </div>
</div>
<div class="contents">
<a href="stm8s__i2c_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/**</span>
<a name="l00002"></a>00002 <span class="comment">  ******************************************************************************</span>
<a name="l00003"></a>00003 <span class="comment">  * @file    stm8s_i2c.c</span>
<a name="l00004"></a>00004 <span class="comment">  * @author  MCD Application Team</span>
<a name="l00005"></a>00005 <span class="comment">  * @version V2.3.0</span>
<a name="l00006"></a>00006 <span class="comment">  * @date    16-June-2017</span>
<a name="l00007"></a>00007 <span class="comment">  * @brief   This file contains all the functions for the I2C peripheral.</span>
<a name="l00008"></a>00008 <span class="comment">   ******************************************************************************</span>
<a name="l00009"></a>00009 <span class="comment">  * @attention</span>
<a name="l00010"></a>00010 <span class="comment">  *</span>
<a name="l00011"></a>00011 <span class="comment">  * &lt;h2&gt;&lt;center&gt;&amp;copy; COPYRIGHT 2014 STMicroelectronics&lt;/center&gt;&lt;/h2&gt;</span>
<a name="l00012"></a>00012 <span class="comment">  *</span>
<a name="l00013"></a>00013 <span class="comment">  * Licensed under MCD-ST Liberty SW License Agreement V2, (the &quot;License&quot;);</span>
<a name="l00014"></a>00014 <span class="comment">  * You may not use this file except in compliance with the License.</span>
<a name="l00015"></a>00015 <span class="comment">  * You may obtain a copy of the License at:</span>
<a name="l00016"></a>00016 <span class="comment">  *</span>
<a name="l00017"></a>00017 <span class="comment">  *        http://www.st.com/software_license_agreement_liberty_v2</span>
<a name="l00018"></a>00018 <span class="comment">  *</span>
<a name="l00019"></a>00019 <span class="comment">  * Unless required by applicable law or agreed to in writing, software </span>
<a name="l00020"></a>00020 <span class="comment">  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS, </span>
<a name="l00021"></a>00021 <span class="comment">  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<a name="l00022"></a>00022 <span class="comment">  * See the License for the specific language governing permissions and</span>
<a name="l00023"></a>00023 <span class="comment">  * limitations under the License.</span>
<a name="l00024"></a>00024 <span class="comment">  *</span>
<a name="l00025"></a>00025 <span class="comment">  ******************************************************************************</span>
<a name="l00026"></a>00026 <span class="comment">  */</span>
<a name="l00027"></a>00027 
<a name="l00028"></a>00028 <span class="comment">/* Includes ------------------------------------------------------------------*/</span>
<a name="l00029"></a>00029 <span class="preprocessor">#include &quot;<a class="code" href="stm8s__i2c_8h.html" title="This file contains all functions prototype and macros for the I2C peripheral.">stm8s_i2c.h</a>&quot;</span>
<a name="l00030"></a>00030 <span class="comment"></span>
<a name="l00031"></a>00031 <span class="comment">/** @addtogroup STM8S_StdPeriph_Driver</span>
<a name="l00032"></a>00032 <span class="comment">  * @{</span>
<a name="l00033"></a>00033 <span class="comment">  */</span>
<a name="l00034"></a>00034 <span class="comment">/* Private typedef -----------------------------------------------------------*/</span>
<a name="l00035"></a>00035 <span class="comment"></span>
<a name="l00036"></a>00036 <span class="comment">/** @addtogroup I2C_Private_Defines</span>
<a name="l00037"></a>00037 <span class="comment">  * @{</span>
<a name="l00038"></a>00038 <span class="comment">  */</span>
<a name="l00039"></a>00039 <span class="comment">/* I2C register mask */</span>
<a name="l00040"></a><a class="code" href="group__i2c__private__defines.html#gabe83f294561a64ea986ec4f2fef39b0a">00040</a> <span class="preprocessor">#define REGISTER_Mask               ((uint16_t)0x3000)</span>
<a name="l00041"></a><a class="code" href="group__i2c__private__defines.html#gab05825bbf266abde5a7875b167c67c01">00041</a> <span class="preprocessor"></span><span class="preprocessor">#define REGISTER_SR1_Index          ((uint16_t)0x0100)</span>
<a name="l00042"></a><a class="code" href="group__i2c__private__defines.html#ga341cc1580349aeec19c455df368700fd">00042</a> <span class="preprocessor"></span><span class="preprocessor">#define REGISTER_SR2_Index          ((uint16_t)0x0200)</span>
<a name="l00043"></a>00043 <span class="preprocessor"></span><span class="comment">/* I2C Interrupt Enable mask */</span>
<a name="l00044"></a><a class="code" href="group__i2c__private__defines.html#gab99e12994e073c2a681a6cf68492b3e2">00044</a> <span class="preprocessor">#define ITEN_Mask                   ((uint16_t)0x0700)</span>
<a name="l00045"></a>00045 <span class="preprocessor"></span><span class="comment">/* I2C FLAG mask */</span>
<a name="l00046"></a><a class="code" href="group__i2c__private__defines.html#ga2be62bf481cd44de9ab604efe5595ff6">00046</a> <span class="preprocessor">#define FLAG_Mask                   ((uint16_t)0x00FF)</span>
<a name="l00047"></a>00047 <span class="preprocessor"></span><span class="comment">/**</span>
<a name="l00048"></a>00048 <span class="comment">  * @}</span>
<a name="l00049"></a>00049 <span class="comment">  */</span>
<a name="l00050"></a>00050 
<a name="l00051"></a>00051 <span class="comment">/* Private macro -------------------------------------------------------------*/</span>
<a name="l00052"></a>00052 <span class="comment">/* Private variables ---------------------------------------------------------*/</span>
<a name="l00053"></a>00053 <span class="comment">/* Private function prototypes -----------------------------------------------*/</span>
<a name="l00054"></a>00054 <span class="comment">/* Private functions ---------------------------------------------------------*/</span>
<a name="l00055"></a>00055 
<a name="l00056"></a>00056 <span class="comment"></span>
<a name="l00057"></a>00057 <span class="comment">/**</span>
<a name="l00058"></a>00058 <span class="comment">  * @addtogroup I2C_Public_Functions</span>
<a name="l00059"></a>00059 <span class="comment">  * @{</span>
<a name="l00060"></a>00060 <span class="comment">  */</span>
<a name="l00061"></a>00061 <span class="comment"></span>
<a name="l00062"></a>00062 <span class="comment">/**</span>
<a name="l00063"></a>00063 <span class="comment">  * @brief  Deinitializes the I2C peripheral registers to their default reset values.</span>
<a name="l00064"></a>00064 <span class="comment">  * @param  None</span>
<a name="l00065"></a>00065 <span class="comment">  * @retval None</span>
<a name="l00066"></a>00066 <span class="comment">  */</span>
<a name="l00067"></a><a class="code" href="group__i2c__public__functions.html#ga475ebf7c2c0f64e9631fb1ed82d6bb32">00067</a> <span class="keywordtype">void</span> <a class="code" href="group__i2c__exported__functions.html#ga475ebf7c2c0f64e9631fb1ed82d6bb32" title="Deinitializes the I2C peripheral registers to their default reset values.">I2C_DeInit</a>(<span class="keywordtype">void</span>)
<a name="l00068"></a>00068 {
<a name="l00069"></a>00069   <a class="code" href="stm8s_8h.html#a457a9aa93dbb216459873a30bdb4d84a">I2C</a>-&gt;CR1 = <a class="code" href="group__i2c__registers__reset__value.html#gad9fb7e2277ce4dc45d658e3466adebf0">I2C_CR1_RESET_VALUE</a>;
<a name="l00070"></a>00070   <a class="code" href="stm8s_8h.html#a457a9aa93dbb216459873a30bdb4d84a">I2C</a>-&gt;CR2 = <a class="code" href="group__i2c__registers__reset__value.html#ga998e1c73f5d76260debb6ae551def044">I2C_CR2_RESET_VALUE</a>;
<a name="l00071"></a>00071   <a class="code" href="stm8s_8h.html#a457a9aa93dbb216459873a30bdb4d84a">I2C</a>-&gt;FREQR = <a class="code" href="group__i2c__registers__reset__value.html#ga85b52a876fe0411e42d07d72eb380179">I2C_FREQR_RESET_VALUE</a>;
<a name="l00072"></a>00072   <a class="code" href="stm8s_8h.html#a457a9aa93dbb216459873a30bdb4d84a">I2C</a>-&gt;OARL = <a class="code" href="group__i2c__registers__reset__value.html#ga2002fccc7619b329ceb6ed13352fcb31">I2C_OARL_RESET_VALUE</a>;
<a name="l00073"></a>00073   <a class="code" href="stm8s_8h.html#a457a9aa93dbb216459873a30bdb4d84a">I2C</a>-&gt;OARH = <a class="code" href="group__i2c__registers__reset__value.html#ga957aa843525c7cba90edf3df23dc0246">I2C_OARH_RESET_VALUE</a>;
<a name="l00074"></a>00074   <a class="code" href="stm8s_8h.html#a457a9aa93dbb216459873a30bdb4d84a">I2C</a>-&gt;ITR = <a class="code" href="group__i2c__registers__reset__value.html#ga0b8836158e6e2e96c089cd3c5e83e480">I2C_ITR_RESET_VALUE</a>;
<a name="l00075"></a>00075   <a class="code" href="stm8s_8h.html#a457a9aa93dbb216459873a30bdb4d84a">I2C</a>-&gt;CCRL = <a class="code" href="group__i2c__registers__reset__value.html#ga0c64b07ebc0bb49b4edf3baa1bd5fbfe">I2C_CCRL_RESET_VALUE</a>;
<a name="l00076"></a>00076   <a class="code" href="stm8s_8h.html#a457a9aa93dbb216459873a30bdb4d84a">I2C</a>-&gt;CCRH = <a class="code" href="group__i2c__registers__reset__value.html#ga292bdc25ab2c47f6fd7443fc82b601d5">I2C_CCRH_RESET_VALUE</a>;
<a name="l00077"></a>00077   <a class="code" href="stm8s_8h.html#a457a9aa93dbb216459873a30bdb4d84a">I2C</a>-&gt;TRISER = <a class="code" href="group__i2c__registers__reset__value.html#ga9df83dfdf4b6c4ef978f7e017f7cd298">I2C_TRISER_RESET_VALUE</a>;
<a name="l00078"></a>00078 }
<a name="l00079"></a>00079 <span class="comment"></span>
<a name="l00080"></a>00080 <span class="comment">/**</span>
<a name="l00081"></a>00081 <span class="comment">  * @brief  Initializes the I2C according to the specified parameters in standard</span>
<a name="l00082"></a>00082 <span class="comment">  *         or fast mode.</span>
<a name="l00083"></a>00083 <span class="comment">  * @param  OutputClockFrequencyHz : Specifies the output clock frequency in Hz.</span>
<a name="l00084"></a>00084 <span class="comment">  * @param  OwnAddress : Specifies the own address.</span>
<a name="l00085"></a>00085 <span class="comment">  * @param  I2C_DutyCycle : Specifies the duty cycle to apply in fast mode.</span>
<a name="l00086"></a>00086 <span class="comment">  *         This parameter can be any of the  @ref I2C_DutyCycle_TypeDef enumeration.</span>
<a name="l00087"></a>00087 <span class="comment">  * @note   This parameter don&#39;t have impact when the OutputClockFrequency lower</span>
<a name="l00088"></a>00088 <span class="comment">  *         than 100KHz.</span>
<a name="l00089"></a>00089 <span class="comment">  * @param  Ack : Specifies the acknowledge mode to apply.</span>
<a name="l00090"></a>00090 <span class="comment">  *         This parameter can be any of the  @ref I2C_Ack_TypeDef enumeration.</span>
<a name="l00091"></a>00091 <span class="comment">  * @param  AddMode : Specifies the acknowledge address to apply.</span>
<a name="l00092"></a>00092 <span class="comment">  *         This parameter can be any of the  @ref I2C_AddMode_TypeDef enumeration.</span>
<a name="l00093"></a>00093 <span class="comment">  * @param  InputClockFrequencyMHz : Specifies the input clock frequency in MHz.</span>
<a name="l00094"></a>00094 <span class="comment">  * @retval None</span>
<a name="l00095"></a>00095 <span class="comment">  */</span>
<a name="l00096"></a><a class="code" href="group__i2c__public__functions.html#ga1b854d035a3bb4b30350c57022d94f4d">00096</a> <span class="keywordtype">void</span> <a class="code" href="group__i2c__exported__functions.html#ga1b854d035a3bb4b30350c57022d94f4d" title="Initializes the I2C according to the specified parameters in standard or fast mode.">I2C_Init</a>(<a class="code" href="group__exported__types.html#ga06896e8c53f721507066c079052171f8">uint32_t</a> OutputClockFrequencyHz, <a class="code" href="group__exported__types.html#ga273cf69d639a59973b6019625df33e30">uint16_t</a> <a class="code" href="tags_8txt.html#a86325fba0d78dc041798f8b9b781a14b">OwnAddress</a>, 
<a name="l00097"></a>00097               <a class="code" href="group__i2c__exported__types.html#gac0fae3e51f48b185d7413e529ef5dd1d" title="I2C duty cycle (fast mode only)">I2C_DutyCycle_TypeDef</a> <a class="code" href="tags_8txt.html#a1b07863949a6a577618fe9ed389600ac">I2C_DutyCycle</a>, <a class="code" href="group__i2c__exported__types.html#gaa4e039897cc642ec3abd95a1fa1cc1b3" title="I2C Acknowledgement configuration.">I2C_Ack_TypeDef</a> <a class="code" href="tags_8txt.html#a1bec387141a7bd3a0f6abcde5043bc5d">Ack</a>, 
<a name="l00098"></a>00098               <a class="code" href="group__i2c__exported__types.html#ga183d9b2cf41469e7f6b7c00750e5a7ea" title="I2C Addressing Mode (slave mode only)">I2C_AddMode_TypeDef</a> <a class="code" href="tags_8txt.html#a98076709d77e1e81d157875e34e9fb16">AddMode</a>, <a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> InputClockFrequencyMHz )
<a name="l00099"></a>00099 {
<a name="l00100"></a>00100   <a class="code" href="group__exported__types.html#ga273cf69d639a59973b6019625df33e30">uint16_t</a> result = 0x0004;
<a name="l00101"></a>00101   <a class="code" href="group__exported__types.html#ga273cf69d639a59973b6019625df33e30">uint16_t</a> tmpval = 0;
<a name="l00102"></a>00102   <a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> tmpccrh = 0;
<a name="l00103"></a>00103 
<a name="l00104"></a>00104   <span class="comment">/* Check the parameters */</span>
<a name="l00105"></a>00105   <a class="code" href="stm8s__stdperiph__examples_2adc2_2adc2__continuousconversion_2stm8s__conf_8h.html#a631dea7b230e600555f979c62af1de21" title="The assert_param macro is used for function&#39;s parameters check.">assert_param</a>(<a class="code" href="group__i2c__private__macros.html#ga6dbc91bfba7009086b65f6ae21bbeeff" title="Macro used by the assert function to check the different acknowledgement configuration.">IS_I2C_ACK_OK</a>(Ack));
<a name="l00106"></a>00106   <a class="code" href="stm8s__stdperiph__examples_2adc2_2adc2__continuousconversion_2stm8s__conf_8h.html#a631dea7b230e600555f979c62af1de21" title="The assert_param macro is used for function&#39;s parameters check.">assert_param</a>(<a class="code" href="group__i2c__private__macros.html#ga5e4db3aaf4339bd77e2321a853a4c88a" title="Macro used by the assert function to check the different I2C addressing modes.">IS_I2C_ADDMODE_OK</a>(AddMode));
<a name="l00107"></a>00107   <a class="code" href="stm8s__stdperiph__examples_2adc2_2adc2__continuousconversion_2stm8s__conf_8h.html#a631dea7b230e600555f979c62af1de21" title="The assert_param macro is used for function&#39;s parameters check.">assert_param</a>(<a class="code" href="group__i2c__private__macros.html#gab480ff99f97b0d20e28a3cc985bcf715" title="Macro used by the assert function to check the different I2C possible own address.">IS_I2C_OWN_ADDRESS_OK</a>(OwnAddress));
<a name="l00108"></a>00108   <a class="code" href="stm8s__stdperiph__examples_2adc2_2adc2__continuousconversion_2stm8s__conf_8h.html#a631dea7b230e600555f979c62af1de21" title="The assert_param macro is used for function&#39;s parameters check.">assert_param</a>(<a class="code" href="group__i2c__private__macros.html#ga7fb242f468edf62877d98c5ff3ed0745" title="Macro used by the assert function to check the different functions parameters.">IS_I2C_DUTYCYCLE_OK</a>(I2C_DutyCycle));  
<a name="l00109"></a>00109   <a class="code" href="stm8s__stdperiph__examples_2adc2_2adc2__continuousconversion_2stm8s__conf_8h.html#a631dea7b230e600555f979c62af1de21" title="The assert_param macro is used for function&#39;s parameters check.">assert_param</a>(<a class="code" href="group__i2c__private__macros.html#ga9924e634fc251f361ab1b4be88fd0989" title="Macro used by the assert function to check that I2C Input clock frequency must be between 1MHz and 50...">IS_I2C_INPUT_CLOCK_FREQ_OK</a>(InputClockFrequencyMHz));
<a name="l00110"></a>00110   <a class="code" href="stm8s__stdperiph__examples_2adc2_2adc2__continuousconversion_2stm8s__conf_8h.html#a631dea7b230e600555f979c62af1de21" title="The assert_param macro is used for function&#39;s parameters check.">assert_param</a>(<a class="code" href="group__i2c__private__macros.html#ga373cc47709aceea8515b539e1c70cf95" title="Macro used by the assert function to check that I2C Output clock frequency must be between 1Hz and 40...">IS_I2C_OUTPUT_CLOCK_FREQ_OK</a>(OutputClockFrequencyHz));
<a name="l00111"></a>00111 
<a name="l00112"></a>00112 
<a name="l00113"></a>00113   <span class="comment">/*------------------------- I2C FREQ Configuration ------------------------*/</span>
<a name="l00114"></a>00114   <span class="comment">/* Clear frequency bits */</span>
<a name="l00115"></a>00115   <a class="code" href="stm8s_8h.html#a457a9aa93dbb216459873a30bdb4d84a">I2C</a>-&gt;FREQR &amp;= (<a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>)(~<a class="code" href="group__i2c__registers__bits__definition.html#ga970d85ddb242d7ccf3702c253fc2215b">I2C_FREQR_FREQ</a>);
<a name="l00116"></a>00116   <span class="comment">/* Write new value */</span>
<a name="l00117"></a>00117   <a class="code" href="stm8s_8h.html#a457a9aa93dbb216459873a30bdb4d84a">I2C</a>-&gt;FREQR |= InputClockFrequencyMHz;
<a name="l00118"></a>00118 
<a name="l00119"></a>00119   <span class="comment">/*--------------------------- I2C CCR Configuration ------------------------*/</span>
<a name="l00120"></a>00120   <span class="comment">/* Disable I2C to configure TRISER */</span>
<a name="l00121"></a>00121   <a class="code" href="stm8s_8h.html#a457a9aa93dbb216459873a30bdb4d84a">I2C</a>-&gt;CR1 &amp;= (<a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>)(~<a class="code" href="group__i2c__registers__bits__definition.html#ga953b0d38414808db79da116842ed3262">I2C_CR1_PE</a>);
<a name="l00122"></a>00122 
<a name="l00123"></a>00123   <span class="comment">/* Clear CCRH &amp; CCRL */</span>
<a name="l00124"></a>00124   <a class="code" href="stm8s_8h.html#a457a9aa93dbb216459873a30bdb4d84a">I2C</a>-&gt;CCRH &amp;= (<a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>)(~(<a class="code" href="group__i2c__registers__bits__definition.html#gabfaac975e21226e0307590aa5ecb9bc0">I2C_CCRH_FS</a> | <a class="code" href="group__i2c__registers__bits__definition.html#gaa9733a14324d19e26c42c052042d6ada">I2C_CCRH_DUTY</a> | <a class="code" href="group__i2c__registers__bits__definition.html#gac91f728529a25c0d3f9a9118ca76999b">I2C_CCRH_CCR</a>));
<a name="l00125"></a>00125   <a class="code" href="stm8s_8h.html#a457a9aa93dbb216459873a30bdb4d84a">I2C</a>-&gt;CCRL &amp;= (<a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>)(~<a class="code" href="group__i2c__registers__bits__definition.html#ga5bf27a3edbf7ded085bd256c21b55c52">I2C_CCRL_CCR</a>);
<a name="l00126"></a>00126 
<a name="l00127"></a>00127   <span class="comment">/* Detect Fast or Standard mode depending on the Output clock frequency selected */</span>
<a name="l00128"></a>00128   <span class="keywordflow">if</span> (OutputClockFrequencyHz &gt; <a class="code" href="group__i2c__exported__constants.html#gab7bc718356f2b3a2ebd8963d0d83903b">I2C_MAX_STANDARD_FREQ</a>) <span class="comment">/* FAST MODE */</span>
<a name="l00129"></a>00129   {
<a name="l00130"></a>00130     <span class="comment">/* Set F/S bit for fast mode */</span>
<a name="l00131"></a>00131     tmpccrh = <a class="code" href="group__i2c__registers__bits__definition.html#gabfaac975e21226e0307590aa5ecb9bc0">I2C_CCRH_FS</a>;
<a name="l00132"></a>00132 
<a name="l00133"></a>00133     <span class="keywordflow">if</span> (I2C_DutyCycle == <a class="code" href="group__i2c__exported__types.html#ggac0fae3e51f48b185d7413e529ef5dd1da7863251159588f24be3dc095ad768d7a">I2C_DUTYCYCLE_2</a>)
<a name="l00134"></a>00134     {
<a name="l00135"></a>00135       <span class="comment">/* Fast mode speed calculate: Tlow/Thigh = 2 */</span>
<a name="l00136"></a>00136       result = (<a class="code" href="group__exported__types.html#ga273cf69d639a59973b6019625df33e30">uint16_t</a>) ((InputClockFrequencyMHz * 1000000) / (OutputClockFrequencyHz * 3));
<a name="l00137"></a>00137     }
<a name="l00138"></a>00138     <span class="keywordflow">else</span> <span class="comment">/* I2C_DUTYCYCLE_16_9 */</span>
<a name="l00139"></a>00139     {
<a name="l00140"></a>00140       <span class="comment">/* Fast mode speed calculate: Tlow/Thigh = 16/9 */</span>
<a name="l00141"></a>00141       result = (<a class="code" href="group__exported__types.html#ga273cf69d639a59973b6019625df33e30">uint16_t</a>) ((InputClockFrequencyMHz * 1000000) / (OutputClockFrequencyHz * 25));
<a name="l00142"></a>00142       <span class="comment">/* Set DUTY bit */</span>
<a name="l00143"></a>00143       tmpccrh |= <a class="code" href="group__i2c__registers__bits__definition.html#gaa9733a14324d19e26c42c052042d6ada">I2C_CCRH_DUTY</a>;
<a name="l00144"></a>00144     }
<a name="l00145"></a>00145 
<a name="l00146"></a>00146     <span class="comment">/* Verify and correct CCR value if below minimum value */</span>
<a name="l00147"></a>00147     <span class="keywordflow">if</span> (result &lt; (<a class="code" href="group__exported__types.html#ga273cf69d639a59973b6019625df33e30">uint16_t</a>)0x01)
<a name="l00148"></a>00148     {
<a name="l00149"></a>00149       <span class="comment">/* Set the minimum allowed value */</span>
<a name="l00150"></a>00150       result = (<a class="code" href="group__exported__types.html#ga273cf69d639a59973b6019625df33e30">uint16_t</a>)0x0001;
<a name="l00151"></a>00151     }
<a name="l00152"></a>00152 
<a name="l00153"></a>00153     <span class="comment">/* Set Maximum Rise Time: 300ns max in Fast Mode</span>
<a name="l00154"></a>00154 <span class="comment">    = [300ns/(1/InputClockFrequencyMHz.10e6)]+1</span>
<a name="l00155"></a>00155 <span class="comment">    = [(InputClockFrequencyMHz * 3)/10]+1 */</span>
<a name="l00156"></a>00156     tmpval = ((InputClockFrequencyMHz * 3) / 10) + 1;
<a name="l00157"></a>00157     <a class="code" href="stm8s_8h.html#a457a9aa93dbb216459873a30bdb4d84a">I2C</a>-&gt;TRISER = (<a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>)tmpval;
<a name="l00158"></a>00158 
<a name="l00159"></a>00159   }
<a name="l00160"></a>00160   <span class="keywordflow">else</span> <span class="comment">/* STANDARD MODE */</span>
<a name="l00161"></a>00161   {
<a name="l00162"></a>00162 
<a name="l00163"></a>00163     <span class="comment">/* Calculate standard mode speed */</span>
<a name="l00164"></a>00164     result = (<a class="code" href="group__exported__types.html#ga273cf69d639a59973b6019625df33e30">uint16_t</a>)((InputClockFrequencyMHz * 1000000) / (OutputClockFrequencyHz &lt;&lt; (<a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>)1));
<a name="l00165"></a>00165 
<a name="l00166"></a>00166     <span class="comment">/* Verify and correct CCR value if below minimum value */</span>
<a name="l00167"></a>00167     <span class="keywordflow">if</span> (result &lt; (<a class="code" href="group__exported__types.html#ga273cf69d639a59973b6019625df33e30">uint16_t</a>)0x0004)
<a name="l00168"></a>00168     {
<a name="l00169"></a>00169       <span class="comment">/* Set the minimum allowed value */</span>
<a name="l00170"></a>00170       result = (<a class="code" href="group__exported__types.html#ga273cf69d639a59973b6019625df33e30">uint16_t</a>)0x0004;
<a name="l00171"></a>00171     }
<a name="l00172"></a>00172 
<a name="l00173"></a>00173     <span class="comment">/* Set Maximum Rise Time: 1000ns max in Standard Mode</span>
<a name="l00174"></a>00174 <span class="comment">    = [1000ns/(1/InputClockFrequencyMHz.10e6)]+1</span>
<a name="l00175"></a>00175 <span class="comment">    = InputClockFrequencyMHz+1 */</span>
<a name="l00176"></a>00176     <a class="code" href="stm8s_8h.html#a457a9aa93dbb216459873a30bdb4d84a">I2C</a>-&gt;TRISER = (<a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>)(InputClockFrequencyMHz + (<a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>)1);
<a name="l00177"></a>00177 
<a name="l00178"></a>00178   }
<a name="l00179"></a>00179 
<a name="l00180"></a>00180   <span class="comment">/* Write CCR with new calculated value */</span>
<a name="l00181"></a>00181   <a class="code" href="stm8s_8h.html#a457a9aa93dbb216459873a30bdb4d84a">I2C</a>-&gt;CCRL = (<a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>)result;
<a name="l00182"></a>00182   <a class="code" href="stm8s_8h.html#a457a9aa93dbb216459873a30bdb4d84a">I2C</a>-&gt;CCRH = (<a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>)((<a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>)((<a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>)(result &gt;&gt; 8) &amp; <a class="code" href="group__i2c__registers__bits__definition.html#gac91f728529a25c0d3f9a9118ca76999b">I2C_CCRH_CCR</a>) | tmpccrh);
<a name="l00183"></a>00183 
<a name="l00184"></a>00184   <span class="comment">/* Enable I2C */</span>
<a name="l00185"></a>00185   <a class="code" href="stm8s_8h.html#a457a9aa93dbb216459873a30bdb4d84a">I2C</a>-&gt;CR1 |= <a class="code" href="group__i2c__registers__bits__definition.html#ga953b0d38414808db79da116842ed3262">I2C_CR1_PE</a>;
<a name="l00186"></a>00186 
<a name="l00187"></a>00187   <span class="comment">/* Configure I2C acknowledgement */</span>
<a name="l00188"></a>00188   <a class="code" href="group__i2c__exported__functions.html#ga002310a2fd258c4cb013a7e8417f153b" title="Enable or Disable the I2C acknowledge and position acknowledge feature.">I2C_AcknowledgeConfig</a>(Ack);
<a name="l00189"></a>00189 
<a name="l00190"></a>00190   <span class="comment">/*--------------------------- I2C OAR Configuration ------------------------*/</span>
<a name="l00191"></a>00191   <a class="code" href="stm8s_8h.html#a457a9aa93dbb216459873a30bdb4d84a">I2C</a>-&gt;OARL = (<a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>)(OwnAddress);
<a name="l00192"></a>00192   <a class="code" href="stm8s_8h.html#a457a9aa93dbb216459873a30bdb4d84a">I2C</a>-&gt;OARH = (<a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>)((<a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>)(AddMode | <a class="code" href="group__i2c__registers__bits__definition.html#ga5aed6ceacaadfaf73c11cb343e0a661e">I2C_OARH_ADDCONF</a>) |
<a name="l00193"></a>00193                    (<a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>)((OwnAddress &amp; (<a class="code" href="group__exported__types.html#ga273cf69d639a59973b6019625df33e30">uint16_t</a>)0x0300) &gt;&gt; (<a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>)7));
<a name="l00194"></a>00194 }
<a name="l00195"></a>00195 <span class="comment"></span>
<a name="l00196"></a>00196 <span class="comment">/**</span>
<a name="l00197"></a>00197 <span class="comment">  * @brief  Enables or disables the I2C peripheral.</span>
<a name="l00198"></a>00198 <span class="comment">  * @param  NewState : Indicate the new I2C peripheral state.</span>
<a name="l00199"></a>00199 <span class="comment">  *         This parameter can be any of the @ref FunctionalState enumeration.</span>
<a name="l00200"></a>00200 <span class="comment">  * @retval None</span>
<a name="l00201"></a>00201 <span class="comment">  */</span>
<a name="l00202"></a><a class="code" href="group__i2c__public__functions.html#gae696416c6624783e6f3240742a1a474f">00202</a> <span class="keywordtype">void</span> <a class="code" href="group__i2c__exported__functions.html#gae696416c6624783e6f3240742a1a474f" title="Enables or disables the I2C peripheral.">I2C_Cmd</a>(<a class="code" href="group__exported__types.html#gac9a7e9a35d2513ec15c3b537aaa4fba1">FunctionalState</a> NewState)
<a name="l00203"></a>00203 {
<a name="l00204"></a>00204   <span class="comment">/* Check function parameters */</span>
<a name="l00205"></a>00205   <a class="code" href="stm8s__stdperiph__examples_2adc2_2adc2__continuousconversion_2stm8s__conf_8h.html#a631dea7b230e600555f979c62af1de21" title="The assert_param macro is used for function&#39;s parameters check.">assert_param</a>(<a class="code" href="group__exported__types.html#gafda1b4aabfd993b1e9e0945008fe00a8">IS_FUNCTIONALSTATE_OK</a>(NewState));
<a name="l00206"></a>00206 
<a name="l00207"></a>00207   <span class="keywordflow">if</span> (NewState != <a class="code" href="group__exported__types.html#ggac9a7e9a35d2513ec15c3b537aaa4fba1ad3a9df141be0ccf10389b640f492b26d">DISABLE</a>)
<a name="l00208"></a>00208   {
<a name="l00209"></a>00209     <span class="comment">/* Enable I2C peripheral */</span>
<a name="l00210"></a>00210     <a class="code" href="stm8s_8h.html#a457a9aa93dbb216459873a30bdb4d84a">I2C</a>-&gt;CR1 |= <a class="code" href="group__i2c__registers__bits__definition.html#ga953b0d38414808db79da116842ed3262">I2C_CR1_PE</a>;
<a name="l00211"></a>00211   }
<a name="l00212"></a>00212   <span class="keywordflow">else</span> <span class="comment">/* NewState == DISABLE */</span>
<a name="l00213"></a>00213   {
<a name="l00214"></a>00214     <span class="comment">/* Disable I2C peripheral */</span>
<a name="l00215"></a>00215     <a class="code" href="stm8s_8h.html#a457a9aa93dbb216459873a30bdb4d84a">I2C</a>-&gt;CR1 &amp;= (<a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>)(~<a class="code" href="group__i2c__registers__bits__definition.html#ga953b0d38414808db79da116842ed3262">I2C_CR1_PE</a>);
<a name="l00216"></a>00216   }
<a name="l00217"></a>00217 }
<a name="l00218"></a>00218 <span class="comment"></span>
<a name="l00219"></a>00219 <span class="comment">/**</span>
<a name="l00220"></a>00220 <span class="comment">  * @brief  Enables or disables the I2C General Call feature.</span>
<a name="l00221"></a>00221 <span class="comment">  * @param  NewState : State of the General Call feature.</span>
<a name="l00222"></a>00222 <span class="comment">  *         This parameter can be any of the @ref FunctionalState enumeration.</span>
<a name="l00223"></a>00223 <span class="comment">  * @retval None</span>
<a name="l00224"></a>00224 <span class="comment">  */</span>
<a name="l00225"></a><a class="code" href="group__i2c__public__functions.html#ga11fc3ef503340e7c395419cf0f04e3e6">00225</a> <span class="keywordtype">void</span> <a class="code" href="group__i2c__exported__functions.html#ga11fc3ef503340e7c395419cf0f04e3e6" title="Enables or disables the I2C General Call feature.">I2C_GeneralCallCmd</a>(<a class="code" href="group__exported__types.html#gac9a7e9a35d2513ec15c3b537aaa4fba1">FunctionalState</a> NewState)
<a name="l00226"></a>00226 {
<a name="l00227"></a>00227   <span class="comment">/* Check function parameters */</span>
<a name="l00228"></a>00228   <a class="code" href="stm8s__stdperiph__examples_2adc2_2adc2__continuousconversion_2stm8s__conf_8h.html#a631dea7b230e600555f979c62af1de21" title="The assert_param macro is used for function&#39;s parameters check.">assert_param</a>(<a class="code" href="group__exported__types.html#gafda1b4aabfd993b1e9e0945008fe00a8">IS_FUNCTIONALSTATE_OK</a>(NewState));
<a name="l00229"></a>00229 
<a name="l00230"></a>00230   <span class="keywordflow">if</span> (NewState != <a class="code" href="group__exported__types.html#ggac9a7e9a35d2513ec15c3b537aaa4fba1ad3a9df141be0ccf10389b640f492b26d">DISABLE</a>)
<a name="l00231"></a>00231   {
<a name="l00232"></a>00232     <span class="comment">/* Enable General Call */</span>
<a name="l00233"></a>00233     <a class="code" href="stm8s_8h.html#a457a9aa93dbb216459873a30bdb4d84a">I2C</a>-&gt;CR1 |= <a class="code" href="group__i2c__registers__bits__definition.html#ga1d8c219193b11f8507d7b85831d14912">I2C_CR1_ENGC</a>;
<a name="l00234"></a>00234   }
<a name="l00235"></a>00235   <span class="keywordflow">else</span> <span class="comment">/* NewState == DISABLE */</span>
<a name="l00236"></a>00236   {
<a name="l00237"></a>00237     <span class="comment">/* Disable General Call */</span>
<a name="l00238"></a>00238     <a class="code" href="stm8s_8h.html#a457a9aa93dbb216459873a30bdb4d84a">I2C</a>-&gt;CR1 &amp;= (<a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>)(~<a class="code" href="group__i2c__registers__bits__definition.html#ga1d8c219193b11f8507d7b85831d14912">I2C_CR1_ENGC</a>);
<a name="l00239"></a>00239   }
<a name="l00240"></a>00240 }
<a name="l00241"></a>00241 <span class="comment"></span>
<a name="l00242"></a>00242 <span class="comment">/**</span>
<a name="l00243"></a>00243 <span class="comment">  * @brief  Generates I2C communication START condition.</span>
<a name="l00244"></a>00244 <span class="comment">  * @note   CCR must be programmed, i.e. I2C_Init function must have been called</span>
<a name="l00245"></a>00245 <span class="comment">  *         with a valid I2C_ClockSpeed</span>
<a name="l00246"></a>00246 <span class="comment">  * @param  NewState : Enable or disable the start condition.</span>
<a name="l00247"></a>00247 <span class="comment">  *         This parameter can be any of the @ref FunctionalState enumeration.</span>
<a name="l00248"></a>00248 <span class="comment">  * @retval None</span>
<a name="l00249"></a>00249 <span class="comment">  */</span>
<a name="l00250"></a><a class="code" href="group__i2c__public__functions.html#ga176b1151ef1f0735fcf2df35fe3c93f1">00250</a> <span class="keywordtype">void</span> <a class="code" href="group__i2c__exported__functions.html#ga176b1151ef1f0735fcf2df35fe3c93f1" title="Generates I2C communication START condition.">I2C_GenerateSTART</a>(<a class="code" href="group__exported__types.html#gac9a7e9a35d2513ec15c3b537aaa4fba1">FunctionalState</a> NewState)
<a name="l00251"></a>00251 {
<a name="l00252"></a>00252   <span class="comment">/* Check function parameters */</span>
<a name="l00253"></a>00253   <a class="code" href="stm8s__stdperiph__examples_2adc2_2adc2__continuousconversion_2stm8s__conf_8h.html#a631dea7b230e600555f979c62af1de21" title="The assert_param macro is used for function&#39;s parameters check.">assert_param</a>(<a class="code" href="group__exported__types.html#gafda1b4aabfd993b1e9e0945008fe00a8">IS_FUNCTIONALSTATE_OK</a>(NewState));
<a name="l00254"></a>00254 
<a name="l00255"></a>00255   <span class="keywordflow">if</span> (NewState != <a class="code" href="group__exported__types.html#ggac9a7e9a35d2513ec15c3b537aaa4fba1ad3a9df141be0ccf10389b640f492b26d">DISABLE</a>)
<a name="l00256"></a>00256   {
<a name="l00257"></a>00257     <span class="comment">/* Generate a START condition */</span>
<a name="l00258"></a>00258     <a class="code" href="stm8s_8h.html#a457a9aa93dbb216459873a30bdb4d84a">I2C</a>-&gt;CR2 |= <a class="code" href="group__i2c__registers__bits__definition.html#ga5ac78b87a12a9eaf564f5a3f99928478">I2C_CR2_START</a>;
<a name="l00259"></a>00259   }
<a name="l00260"></a>00260   <span class="keywordflow">else</span> <span class="comment">/* NewState == DISABLE */</span>
<a name="l00261"></a>00261   {
<a name="l00262"></a>00262     <span class="comment">/* Disable the START condition generation */</span>
<a name="l00263"></a>00263     <a class="code" href="stm8s_8h.html#a457a9aa93dbb216459873a30bdb4d84a">I2C</a>-&gt;CR2 &amp;= (<a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>)(~<a class="code" href="group__i2c__registers__bits__definition.html#ga5ac78b87a12a9eaf564f5a3f99928478">I2C_CR2_START</a>);
<a name="l00264"></a>00264   }
<a name="l00265"></a>00265 }
<a name="l00266"></a>00266 <span class="comment"></span>
<a name="l00267"></a>00267 <span class="comment">/**</span>
<a name="l00268"></a>00268 <span class="comment">  * @brief  Generates I2C communication STOP condition.</span>
<a name="l00269"></a>00269 <span class="comment">  * @param   NewState : Enable or disable the stop condition.</span>
<a name="l00270"></a>00270 <span class="comment">  *          This parameter can be any of the @ref FunctionalState enumeration.</span>
<a name="l00271"></a>00271 <span class="comment">  * @retval None</span>
<a name="l00272"></a>00272 <span class="comment">  */</span>
<a name="l00273"></a><a class="code" href="group__i2c__public__functions.html#ga1c1f2b51e6077fa322aa5f13d6cfba68">00273</a> <span class="keywordtype">void</span> <a class="code" href="group__i2c__exported__functions.html#ga1c1f2b51e6077fa322aa5f13d6cfba68" title="Generates I2C communication STOP condition.">I2C_GenerateSTOP</a>(<a class="code" href="group__exported__types.html#gac9a7e9a35d2513ec15c3b537aaa4fba1">FunctionalState</a> NewState)
<a name="l00274"></a>00274 {
<a name="l00275"></a>00275   <span class="comment">/* Check function parameters */</span>
<a name="l00276"></a>00276   <a class="code" href="stm8s__stdperiph__examples_2adc2_2adc2__continuousconversion_2stm8s__conf_8h.html#a631dea7b230e600555f979c62af1de21" title="The assert_param macro is used for function&#39;s parameters check.">assert_param</a>(<a class="code" href="group__exported__types.html#gafda1b4aabfd993b1e9e0945008fe00a8">IS_FUNCTIONALSTATE_OK</a>(NewState));
<a name="l00277"></a>00277 
<a name="l00278"></a>00278   <span class="keywordflow">if</span> (NewState != <a class="code" href="group__exported__types.html#ggac9a7e9a35d2513ec15c3b537aaa4fba1ad3a9df141be0ccf10389b640f492b26d">DISABLE</a>)
<a name="l00279"></a>00279   {
<a name="l00280"></a>00280     <span class="comment">/* Generate a STOP condition */</span>
<a name="l00281"></a>00281     <a class="code" href="stm8s_8h.html#a457a9aa93dbb216459873a30bdb4d84a">I2C</a>-&gt;CR2 |= <a class="code" href="group__i2c__registers__bits__definition.html#ga37007be453dd8a637be2d793d3b5f2a2">I2C_CR2_STOP</a>;
<a name="l00282"></a>00282   }
<a name="l00283"></a>00283   <span class="keywordflow">else</span> <span class="comment">/* NewState == DISABLE */</span>
<a name="l00284"></a>00284   {
<a name="l00285"></a>00285     <span class="comment">/* Disable the STOP condition generation */</span>
<a name="l00286"></a>00286     <a class="code" href="stm8s_8h.html#a457a9aa93dbb216459873a30bdb4d84a">I2C</a>-&gt;CR2 &amp;= (<a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>)(~<a class="code" href="group__i2c__registers__bits__definition.html#ga37007be453dd8a637be2d793d3b5f2a2">I2C_CR2_STOP</a>);
<a name="l00287"></a>00287   }
<a name="l00288"></a>00288 }
<a name="l00289"></a>00289 <span class="comment"></span>
<a name="l00290"></a>00290 <span class="comment">/**</span>
<a name="l00291"></a>00291 <span class="comment">  * @brief  Enables or disables I2C software reset.</span>
<a name="l00292"></a>00292 <span class="comment">  * @param  NewState : Specifies the new state of the I2C software reset.</span>
<a name="l00293"></a>00293 <span class="comment">  *         This parameter can be any of the @ref FunctionalState enumeration.</span>
<a name="l00294"></a>00294 <span class="comment">  * @retval None</span>
<a name="l00295"></a>00295 <span class="comment">  */</span>
<a name="l00296"></a><a class="code" href="group__i2c__public__functions.html#ga214d2beb6f03f51a0b5e8405e6dd4884">00296</a> <span class="keywordtype">void</span> <a class="code" href="group__i2c__exported__functions.html#ga214d2beb6f03f51a0b5e8405e6dd4884" title="Enables or disables I2C software reset.">I2C_SoftwareResetCmd</a>(<a class="code" href="group__exported__types.html#gac9a7e9a35d2513ec15c3b537aaa4fba1">FunctionalState</a> NewState)
<a name="l00297"></a>00297 {
<a name="l00298"></a>00298   <span class="comment">/* Check function parameters */</span>
<a name="l00299"></a>00299   <a class="code" href="stm8s__stdperiph__examples_2adc2_2adc2__continuousconversion_2stm8s__conf_8h.html#a631dea7b230e600555f979c62af1de21" title="The assert_param macro is used for function&#39;s parameters check.">assert_param</a>(<a class="code" href="group__exported__types.html#gafda1b4aabfd993b1e9e0945008fe00a8">IS_FUNCTIONALSTATE_OK</a>(NewState));
<a name="l00300"></a>00300 
<a name="l00301"></a>00301   <span class="keywordflow">if</span> (NewState != <a class="code" href="group__exported__types.html#ggac9a7e9a35d2513ec15c3b537aaa4fba1ad3a9df141be0ccf10389b640f492b26d">DISABLE</a>)
<a name="l00302"></a>00302   {
<a name="l00303"></a>00303     <span class="comment">/* Peripheral under reset */</span>
<a name="l00304"></a>00304     <a class="code" href="stm8s_8h.html#a457a9aa93dbb216459873a30bdb4d84a">I2C</a>-&gt;CR2 |= <a class="code" href="group__i2c__registers__bits__definition.html#gab135fa60e8276bfc64e3d4bb7372eef7">I2C_CR2_SWRST</a>;
<a name="l00305"></a>00305   }
<a name="l00306"></a>00306   <span class="keywordflow">else</span> <span class="comment">/* NewState == DISABLE */</span>
<a name="l00307"></a>00307   {
<a name="l00308"></a>00308     <span class="comment">/* Peripheral not under reset */</span>
<a name="l00309"></a>00309     <a class="code" href="stm8s_8h.html#a457a9aa93dbb216459873a30bdb4d84a">I2C</a>-&gt;CR2 &amp;= (<a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>)(~<a class="code" href="group__i2c__registers__bits__definition.html#gab135fa60e8276bfc64e3d4bb7372eef7">I2C_CR2_SWRST</a>);
<a name="l00310"></a>00310   }
<a name="l00311"></a>00311 }
<a name="l00312"></a>00312 <span class="comment"></span>
<a name="l00313"></a>00313 <span class="comment">/**</span>
<a name="l00314"></a>00314 <span class="comment">  * @brief  Enables or disables the I2C clock stretching.</span>
<a name="l00315"></a>00315 <span class="comment">  * @param  NewState : Specifies the new state of the I2C Clock stretching.</span>
<a name="l00316"></a>00316 <span class="comment">  *         This parameter can be any of the @ref FunctionalState enumeration.</span>
<a name="l00317"></a>00317 <span class="comment">  * @retval None</span>
<a name="l00318"></a>00318 <span class="comment">  */</span>
<a name="l00319"></a>00319 
<a name="l00320"></a><a class="code" href="group__i2c__public__functions.html#ga0f1d010931085ffefcab387579b87557">00320</a> <span class="keywordtype">void</span> <a class="code" href="group__i2c__exported__functions.html#ga0f1d010931085ffefcab387579b87557" title="Enables or disables the I2C clock stretching.">I2C_StretchClockCmd</a>(<a class="code" href="group__exported__types.html#gac9a7e9a35d2513ec15c3b537aaa4fba1">FunctionalState</a> NewState)
<a name="l00321"></a>00321 {
<a name="l00322"></a>00322   <span class="comment">/* Check function parameters */</span>
<a name="l00323"></a>00323   <a class="code" href="stm8s__stdperiph__examples_2adc2_2adc2__continuousconversion_2stm8s__conf_8h.html#a631dea7b230e600555f979c62af1de21" title="The assert_param macro is used for function&#39;s parameters check.">assert_param</a>(<a class="code" href="group__exported__types.html#gafda1b4aabfd993b1e9e0945008fe00a8">IS_FUNCTIONALSTATE_OK</a>(NewState));
<a name="l00324"></a>00324 
<a name="l00325"></a>00325   <span class="keywordflow">if</span> (NewState != <a class="code" href="group__exported__types.html#ggac9a7e9a35d2513ec15c3b537aaa4fba1ad3a9df141be0ccf10389b640f492b26d">DISABLE</a>)
<a name="l00326"></a>00326   {
<a name="l00327"></a>00327     <span class="comment">/* Clock Stretching Enable */</span>
<a name="l00328"></a>00328     <a class="code" href="stm8s_8h.html#a457a9aa93dbb216459873a30bdb4d84a">I2C</a>-&gt;CR1 &amp;= (<a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>)(~<a class="code" href="group__i2c__registers__bits__definition.html#ga197aaca79f64e832af3a0a0864c2a08c">I2C_CR1_NOSTRETCH</a>);
<a name="l00329"></a>00329 
<a name="l00330"></a>00330   }
<a name="l00331"></a>00331   <span class="keywordflow">else</span> <span class="comment">/* NewState == DISABLE */</span>
<a name="l00332"></a>00332   {
<a name="l00333"></a>00333     <span class="comment">/* Clock Stretching Disable (Slave mode) */</span>
<a name="l00334"></a>00334     <a class="code" href="stm8s_8h.html#a457a9aa93dbb216459873a30bdb4d84a">I2C</a>-&gt;CR1 |= <a class="code" href="group__i2c__registers__bits__definition.html#ga197aaca79f64e832af3a0a0864c2a08c">I2C_CR1_NOSTRETCH</a>;
<a name="l00335"></a>00335   }
<a name="l00336"></a>00336 }
<a name="l00337"></a>00337 <span class="comment"></span>
<a name="l00338"></a>00338 <span class="comment">/**</span>
<a name="l00339"></a>00339 <span class="comment">  * @brief  Enable or Disable the I2C acknowledge and position acknowledge feature.</span>
<a name="l00340"></a>00340 <span class="comment">  * @note   This function must be called before data reception start</span>
<a name="l00341"></a>00341 <span class="comment">  * @param  Ack : Specifies the acknowledge mode to apply.</span>
<a name="l00342"></a>00342 <span class="comment">  *         This parameter can be any of the  @ref I2C_Ack_TypeDef enumeration.</span>
<a name="l00343"></a>00343 <span class="comment">  * @retval None</span>
<a name="l00344"></a>00344 <span class="comment">  */</span>
<a name="l00345"></a><a class="code" href="group__i2c__public__functions.html#ga002310a2fd258c4cb013a7e8417f153b">00345</a> <span class="keywordtype">void</span> <a class="code" href="group__i2c__exported__functions.html#ga002310a2fd258c4cb013a7e8417f153b" title="Enable or Disable the I2C acknowledge and position acknowledge feature.">I2C_AcknowledgeConfig</a>(<a class="code" href="group__i2c__exported__types.html#gaa4e039897cc642ec3abd95a1fa1cc1b3" title="I2C Acknowledgement configuration.">I2C_Ack_TypeDef</a> <a class="code" href="tags_8txt.html#a1bec387141a7bd3a0f6abcde5043bc5d">Ack</a>)
<a name="l00346"></a>00346 {
<a name="l00347"></a>00347   <span class="comment">/* Check function parameters */</span>
<a name="l00348"></a>00348   <a class="code" href="stm8s__stdperiph__examples_2adc2_2adc2__continuousconversion_2stm8s__conf_8h.html#a631dea7b230e600555f979c62af1de21" title="The assert_param macro is used for function&#39;s parameters check.">assert_param</a>(<a class="code" href="group__i2c__private__macros.html#ga6dbc91bfba7009086b65f6ae21bbeeff" title="Macro used by the assert function to check the different acknowledgement configuration.">IS_I2C_ACK_OK</a>(Ack));
<a name="l00349"></a>00349 
<a name="l00350"></a>00350   <span class="keywordflow">if</span> (Ack == <a class="code" href="group__i2c__exported__types.html#ggaa4e039897cc642ec3abd95a1fa1cc1b3a48b04c46be06f4197a776455262585f8">I2C_ACK_NONE</a>)
<a name="l00351"></a>00351   {
<a name="l00352"></a>00352     <span class="comment">/* Disable the acknowledgement */</span>
<a name="l00353"></a>00353     <a class="code" href="stm8s_8h.html#a457a9aa93dbb216459873a30bdb4d84a">I2C</a>-&gt;CR2 &amp;= (<a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>)(~<a class="code" href="group__i2c__registers__bits__definition.html#ga8534d4362bc2bab7ba74077be917fe4d">I2C_CR2_ACK</a>);
<a name="l00354"></a>00354   }
<a name="l00355"></a>00355   <span class="keywordflow">else</span>
<a name="l00356"></a>00356   {
<a name="l00357"></a>00357     <span class="comment">/* Enable the acknowledgement */</span>
<a name="l00358"></a>00358     <a class="code" href="stm8s_8h.html#a457a9aa93dbb216459873a30bdb4d84a">I2C</a>-&gt;CR2 |= <a class="code" href="group__i2c__registers__bits__definition.html#ga8534d4362bc2bab7ba74077be917fe4d">I2C_CR2_ACK</a>;
<a name="l00359"></a>00359 
<a name="l00360"></a>00360     <span class="keywordflow">if</span> (Ack == <a class="code" href="group__i2c__exported__types.html#ggaa4e039897cc642ec3abd95a1fa1cc1b3a336be6f5676342e3bf059cba6321ab91">I2C_ACK_CURR</a>)
<a name="l00361"></a>00361     {
<a name="l00362"></a>00362       <span class="comment">/* Configure (N)ACK on current byte */</span>
<a name="l00363"></a>00363       <a class="code" href="stm8s_8h.html#a457a9aa93dbb216459873a30bdb4d84a">I2C</a>-&gt;CR2 &amp;= (<a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>)(~<a class="code" href="group__i2c__registers__bits__definition.html#gaeba15eac7565c44f0bebd806add9429e">I2C_CR2_POS</a>);
<a name="l00364"></a>00364     }
<a name="l00365"></a>00365     <span class="keywordflow">else</span>
<a name="l00366"></a>00366     {
<a name="l00367"></a>00367       <span class="comment">/* Configure (N)ACK on next byte */</span>
<a name="l00368"></a>00368       <a class="code" href="stm8s_8h.html#a457a9aa93dbb216459873a30bdb4d84a">I2C</a>-&gt;CR2 |= <a class="code" href="group__i2c__registers__bits__definition.html#gaeba15eac7565c44f0bebd806add9429e">I2C_CR2_POS</a>;
<a name="l00369"></a>00369     }
<a name="l00370"></a>00370   }
<a name="l00371"></a>00371 }
<a name="l00372"></a>00372 <span class="comment"></span>
<a name="l00373"></a>00373 <span class="comment">/**</span>
<a name="l00374"></a>00374 <span class="comment">  * @brief  Enables or disables the specified I2C interrupt.</span>
<a name="l00375"></a>00375 <span class="comment">  * @param  I2C_IT : Name of the interrupt to enable or disable.</span>
<a name="l00376"></a>00376 <span class="comment">  *         This parameter can be any of the  @ref I2C_IT_TypeDef enumeration.</span>
<a name="l00377"></a>00377 <span class="comment">  * @param  NewState : State of the interrupt to apply.</span>
<a name="l00378"></a>00378 <span class="comment">  *         This parameter can be any of the @ref FunctionalState enumeration.</span>
<a name="l00379"></a>00379 <span class="comment">  * @retval None</span>
<a name="l00380"></a>00380 <span class="comment">  */</span>
<a name="l00381"></a><a class="code" href="group__i2c__public__functions.html#ga2ef0a21551d54216f84bd2077fe8bd6b">00381</a> <span class="keywordtype">void</span> <a class="code" href="group__i2c__exported__functions.html#ga2ef0a21551d54216f84bd2077fe8bd6b" title="Enables or disables the specified I2C interrupt.">I2C_ITConfig</a>(<a class="code" href="group__i2c__exported__types.html#gaed6510c550547134afb30f717f17da88" title="I2C Interrupt sources Warning: the values correspond to the bit position in the ITR register...">I2C_IT_TypeDef</a> I2C_IT, <a class="code" href="group__exported__types.html#gac9a7e9a35d2513ec15c3b537aaa4fba1">FunctionalState</a> NewState)
<a name="l00382"></a>00382 {
<a name="l00383"></a>00383   <span class="comment">/* Check functions parameters */</span>
<a name="l00384"></a>00384   <a class="code" href="stm8s__stdperiph__examples_2adc2_2adc2__continuousconversion_2stm8s__conf_8h.html#a631dea7b230e600555f979c62af1de21" title="The assert_param macro is used for function&#39;s parameters check.">assert_param</a>(<a class="code" href="group__i2c__private__macros.html#ga6f6de160104265e8e0284d7dddcf0f1f" title="Macro used by the assert function to check the different I2C interrupt types.">IS_I2C_INTERRUPT_OK</a>(I2C_IT));
<a name="l00385"></a>00385   <a class="code" href="stm8s__stdperiph__examples_2adc2_2adc2__continuousconversion_2stm8s__conf_8h.html#a631dea7b230e600555f979c62af1de21" title="The assert_param macro is used for function&#39;s parameters check.">assert_param</a>(<a class="code" href="group__exported__types.html#gafda1b4aabfd993b1e9e0945008fe00a8">IS_FUNCTIONALSTATE_OK</a>(NewState));
<a name="l00386"></a>00386 
<a name="l00387"></a>00387   <span class="keywordflow">if</span> (NewState != <a class="code" href="group__exported__types.html#ggac9a7e9a35d2513ec15c3b537aaa4fba1ad3a9df141be0ccf10389b640f492b26d">DISABLE</a>)
<a name="l00388"></a>00388   {
<a name="l00389"></a>00389     <span class="comment">/* Enable the selected I2C interrupts */</span>
<a name="l00390"></a>00390     <a class="code" href="stm8s_8h.html#a457a9aa93dbb216459873a30bdb4d84a">I2C</a>-&gt;ITR |= (<a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>)I2C_IT;
<a name="l00391"></a>00391   }
<a name="l00392"></a>00392   <span class="keywordflow">else</span> <span class="comment">/* NewState == DISABLE */</span>
<a name="l00393"></a>00393   {
<a name="l00394"></a>00394     <span class="comment">/* Disable the selected I2C interrupts */</span>
<a name="l00395"></a>00395     <a class="code" href="stm8s_8h.html#a457a9aa93dbb216459873a30bdb4d84a">I2C</a>-&gt;ITR &amp;= (<a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>)(~(<a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>)I2C_IT);
<a name="l00396"></a>00396   }
<a name="l00397"></a>00397 }
<a name="l00398"></a>00398 <span class="comment"></span>
<a name="l00399"></a>00399 <span class="comment">/**</span>
<a name="l00400"></a>00400 <span class="comment">  * @brief  Selects the specified I2C fast mode duty cycle.</span>
<a name="l00401"></a>00401 <span class="comment">  * @param  I2C_DutyCycle : Specifies the duty cycle to apply.</span>
<a name="l00402"></a>00402 <span class="comment">  *         This parameter can be any of the @ref I2C_DutyCycle_TypeDef enumeration.</span>
<a name="l00403"></a>00403 <span class="comment">  * @retval None</span>
<a name="l00404"></a>00404 <span class="comment">  */</span>
<a name="l00405"></a><a class="code" href="group__i2c__public__functions.html#gaad5fc0ce0378ec0e9616523ecf271a95">00405</a> <span class="keywordtype">void</span> <a class="code" href="group__i2c__exported__functions.html#gaad5fc0ce0378ec0e9616523ecf271a95" title="Selects the specified I2C fast mode duty cycle.">I2C_FastModeDutyCycleConfig</a>(<a class="code" href="group__i2c__exported__types.html#gac0fae3e51f48b185d7413e529ef5dd1d" title="I2C duty cycle (fast mode only)">I2C_DutyCycle_TypeDef</a> <a class="code" href="tags_8txt.html#a1b07863949a6a577618fe9ed389600ac">I2C_DutyCycle</a>)
<a name="l00406"></a>00406 {
<a name="l00407"></a>00407   <span class="comment">/* Check function parameters */</span>
<a name="l00408"></a>00408   <a class="code" href="stm8s__stdperiph__examples_2adc2_2adc2__continuousconversion_2stm8s__conf_8h.html#a631dea7b230e600555f979c62af1de21" title="The assert_param macro is used for function&#39;s parameters check.">assert_param</a>(<a class="code" href="group__i2c__private__macros.html#ga7fb242f468edf62877d98c5ff3ed0745" title="Macro used by the assert function to check the different functions parameters.">IS_I2C_DUTYCYCLE_OK</a>(I2C_DutyCycle));
<a name="l00409"></a>00409 
<a name="l00410"></a>00410   <span class="keywordflow">if</span> (I2C_DutyCycle == <a class="code" href="group__i2c__exported__types.html#ggac0fae3e51f48b185d7413e529ef5dd1da3624931a02accb739dc09a55481ba07a">I2C_DUTYCYCLE_16_9</a>)
<a name="l00411"></a>00411   {
<a name="l00412"></a>00412     <span class="comment">/* I2C fast mode Tlow/Thigh = 16/9 */</span>
<a name="l00413"></a>00413     <a class="code" href="stm8s_8h.html#a457a9aa93dbb216459873a30bdb4d84a">I2C</a>-&gt;CCRH |= <a class="code" href="group__i2c__registers__bits__definition.html#gaa9733a14324d19e26c42c052042d6ada">I2C_CCRH_DUTY</a>;
<a name="l00414"></a>00414   }
<a name="l00415"></a>00415   <span class="keywordflow">else</span> <span class="comment">/* I2C_DUTYCYCLE_2 */</span>
<a name="l00416"></a>00416   {
<a name="l00417"></a>00417     <span class="comment">/* I2C fast mode Tlow/Thigh = 2 */</span>
<a name="l00418"></a>00418     <a class="code" href="stm8s_8h.html#a457a9aa93dbb216459873a30bdb4d84a">I2C</a>-&gt;CCRH &amp;= (<a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>)(~<a class="code" href="group__i2c__registers__bits__definition.html#gaa9733a14324d19e26c42c052042d6ada">I2C_CCRH_DUTY</a>);
<a name="l00419"></a>00419   }
<a name="l00420"></a>00420 }
<a name="l00421"></a>00421 <span class="comment"></span>
<a name="l00422"></a>00422 <span class="comment">/**</span>
<a name="l00423"></a>00423 <span class="comment">  * @brief  Returns the most recent received data.</span>
<a name="l00424"></a>00424 <span class="comment">  * @param  None</span>
<a name="l00425"></a>00425 <span class="comment">  * @retval uint8_t : The value of the received byte data.</span>
<a name="l00426"></a>00426 <span class="comment">  */</span>
<a name="l00427"></a><a class="code" href="group__i2c__public__functions.html#ga73e8870450debd272f1bb0cea9e77d52">00427</a> <a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> <a class="code" href="group__i2c__exported__functions.html#ga73e8870450debd272f1bb0cea9e77d52" title="Returns the most recent received data.">I2C_ReceiveData</a>(<span class="keywordtype">void</span>)
<a name="l00428"></a>00428 {
<a name="l00429"></a>00429   <span class="comment">/* Return the data present in the DR register */</span>
<a name="l00430"></a>00430   <span class="keywordflow">return</span> ((<a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>)<a class="code" href="stm8s_8h.html#a457a9aa93dbb216459873a30bdb4d84a">I2C</a>-&gt;DR);
<a name="l00431"></a>00431 }
<a name="l00432"></a>00432 <span class="comment"></span>
<a name="l00433"></a>00433 <span class="comment">/**</span>
<a name="l00434"></a>00434 <span class="comment">  * @brief  Transmits the 7-bit address (to select the) slave device.</span>
<a name="l00435"></a>00435 <span class="comment">  * @param   Address : Specifies the slave address which will be transmitted.</span>
<a name="l00436"></a>00436 <span class="comment">  * @param   Direction : Specifies whether the I2C device will be a Transmitter or a Receiver.</span>
<a name="l00437"></a>00437 <span class="comment">  * This parameter can be any of the @ref I2C_Direction_TypeDef enumeration.</span>
<a name="l00438"></a>00438 <span class="comment">  * @retval None</span>
<a name="l00439"></a>00439 <span class="comment">  */</span>
<a name="l00440"></a><a class="code" href="group__i2c__public__functions.html#ga865f03e165537185ccb1e5493bfb62ae">00440</a> <span class="keywordtype">void</span> <a class="code" href="group__i2c__exported__functions.html#ga865f03e165537185ccb1e5493bfb62ae" title="Transmits the 7-bit address (to select the) slave device.">I2C_Send7bitAddress</a>(<a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> Address, <a class="code" href="group__i2c__exported__types.html#gac5294e7f2dfbf66c835de2f81f9edc72" title="I2C transfer direction Warning: the values correspond to the ADD0 bit position in the OARL register...">I2C_Direction_TypeDef</a> Direction)
<a name="l00441"></a>00441 {
<a name="l00442"></a>00442   <span class="comment">/* Check function parameters */</span>
<a name="l00443"></a>00443   <a class="code" href="stm8s__stdperiph__examples_2adc2_2adc2__continuousconversion_2stm8s__conf_8h.html#a631dea7b230e600555f979c62af1de21" title="The assert_param macro is used for function&#39;s parameters check.">assert_param</a>(<a class="code" href="group__i2c__private__macros.html#gae0812a8faca675360a8f475d9ff77bb7">IS_I2C_ADDRESS_OK</a>(Address));
<a name="l00444"></a>00444   <a class="code" href="stm8s__stdperiph__examples_2adc2_2adc2__continuousconversion_2stm8s__conf_8h.html#a631dea7b230e600555f979c62af1de21" title="The assert_param macro is used for function&#39;s parameters check.">assert_param</a>(<a class="code" href="group__i2c__private__macros.html#ga87a1c8e8468a9439a19ad1b05730bcbe" title="Macro used by the assert function to check the different I2C communcation direction.">IS_I2C_DIRECTION_OK</a>(Direction));
<a name="l00445"></a>00445 
<a name="l00446"></a>00446   <span class="comment">/* Clear bit0 (direction) just in case */</span>
<a name="l00447"></a>00447   Address &amp;= (<a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>)0xFE;
<a name="l00448"></a>00448 
<a name="l00449"></a>00449   <span class="comment">/* Send the Address + Direction */</span>
<a name="l00450"></a>00450   <a class="code" href="stm8s_8h.html#a457a9aa93dbb216459873a30bdb4d84a">I2C</a>-&gt;DR = (<a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>)(Address | (<a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>)Direction);
<a name="l00451"></a>00451 }
<a name="l00452"></a>00452 <span class="comment"></span>
<a name="l00453"></a>00453 <span class="comment">/**</span>
<a name="l00454"></a>00454 <span class="comment">  * @brief  Send a byte by writing in the DR register.</span>
<a name="l00455"></a>00455 <span class="comment">  * @param   Data : Byte to be sent.</span>
<a name="l00456"></a>00456 <span class="comment">  * @retval None</span>
<a name="l00457"></a>00457 <span class="comment">  */</span>
<a name="l00458"></a><a class="code" href="group__i2c__public__functions.html#gad9f80b2c416bdf1ac578859a11e68a40">00458</a> <span class="keywordtype">void</span> <a class="code" href="group__i2c__exported__functions.html#gad9f80b2c416bdf1ac578859a11e68a40" title="Send a byte by writing in the DR register.">I2C_SendData</a>(<a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> Data)
<a name="l00459"></a>00459 {
<a name="l00460"></a>00460   <span class="comment">/* Write in the DR register the data to be sent */</span>
<a name="l00461"></a>00461   <a class="code" href="stm8s_8h.html#a457a9aa93dbb216459873a30bdb4d84a">I2C</a>-&gt;DR = Data;
<a name="l00462"></a>00462 }
<a name="l00463"></a>00463 <span class="comment"></span>
<a name="l00464"></a>00464 <span class="comment">/**</span>
<a name="l00465"></a>00465 <span class="comment"> * @brief</span>
<a name="l00466"></a>00466 <span class="comment"> ****************************************************************************************</span>
<a name="l00467"></a>00467 <span class="comment"> *</span>
<a name="l00468"></a>00468 <span class="comment"> *                         I2C State Monitoring Functions</span>
<a name="l00469"></a>00469 <span class="comment"> *</span>
<a name="l00470"></a>00470 <span class="comment"> ****************************************************************************************</span>
<a name="l00471"></a>00471 <span class="comment"> * This I2C driver provides three different ways for I2C state monitoring</span>
<a name="l00472"></a>00472 <span class="comment"> *  depending on the application requirements and constraints:</span>
<a name="l00473"></a>00473 <span class="comment"> *</span>
<a name="l00474"></a>00474 <span class="comment"> *</span>
<a name="l00475"></a>00475 <span class="comment"> * 1) Basic state monitoring:</span>
<a name="l00476"></a>00476 <span class="comment"> *    Using I2C_CheckEvent() function:</span>
<a name="l00477"></a>00477 <span class="comment"> *    It compares the status registers (SR1, SR2 and SR3) content to a given event</span>
<a name="l00478"></a>00478 <span class="comment"> *    (can be the combination of one or more flags).</span>
<a name="l00479"></a>00479 <span class="comment"> *    It returns SUCCESS if the current status includes the given flags</span>
<a name="l00480"></a>00480 <span class="comment"> *    and returns ERROR if one or more flags are missing in the current status.</span>
<a name="l00481"></a>00481 <span class="comment"> *    - When to use:</span>
<a name="l00482"></a>00482 <span class="comment"> *      - This function is suitable for most applications as well as for startup</span>
<a name="l00483"></a>00483 <span class="comment"> *      activity since the events are fully described in the product reference manual</span>
<a name="l00484"></a>00484 <span class="comment"> *      (RM0016).</span>
<a name="l00485"></a>00485 <span class="comment"> *      - It is also suitable for users who need to define their own events.</span>
<a name="l00486"></a>00486 <span class="comment"> *    - Limitations:</span>
<a name="l00487"></a>00487 <span class="comment"> *      - If an error occurs (ie. error flags are set besides to the monitored flags),</span>
<a name="l00488"></a>00488 <span class="comment"> *        the I2C_CheckEvent() function may return SUCCESS despite the communication</span>
<a name="l00489"></a>00489 <span class="comment"> *        hold or corrupted real state.</span>
<a name="l00490"></a>00490 <span class="comment"> *        In this case, it is advised to use error interrupts to monitor the error</span>
<a name="l00491"></a>00491 <span class="comment"> *        events and handle them in the interrupt IRQ handler.</span>
<a name="l00492"></a>00492 <span class="comment"> *</span>
<a name="l00493"></a>00493 <span class="comment"> *        @note</span>
<a name="l00494"></a>00494 <span class="comment"> *        For error management, it is advised to use the following functions:</span>
<a name="l00495"></a>00495 <span class="comment"> *          - I2C_ITConfig() to configure and enable the error interrupts (I2C_IT_ERR).</span>
<a name="l00496"></a>00496 <span class="comment"> *          - I2C_IRQHandler() which is called when the I2C interrupts occur.</span>
<a name="l00497"></a>00497 <span class="comment"> *          - I2C_GetFlagStatus() or I2C_GetITStatus() to be called into the</span>
<a name="l00498"></a>00498 <span class="comment"> *           I2C_IRQHandler() function in order to determine which error occurred.</span>
<a name="l00499"></a>00499 <span class="comment"> *          - I2C_ClearFlag() or I2C_ClearITPendingBit() and/or I2C_SoftwareResetCmd()</span>
<a name="l00500"></a>00500 <span class="comment"> *            and/or I2C_GenerateStop() in order to clear the error flag and</span>
<a name="l00501"></a>00501 <span class="comment"> *            source and return to correct communication status.</span>
<a name="l00502"></a>00502 <span class="comment"> *</span>
<a name="l00503"></a>00503 <span class="comment"> *</span>
<a name="l00504"></a>00504 <span class="comment"> *  2) Advanced state monitoring:</span>
<a name="l00505"></a>00505 <span class="comment"> *     Using the function I2C_GetLastEvent() which returns the image of both SR1</span>
<a name="l00506"></a>00506 <span class="comment"> *     &amp; SR3 status registers in a single word (uint16_t) (Status Register 3 value</span>
<a name="l00507"></a>00507 <span class="comment"> *     is shifted left by 8 bits and concatenated to Status Register 1).</span>
<a name="l00508"></a>00508 <span class="comment"> *     - When to use:</span>
<a name="l00509"></a>00509 <span class="comment"> *       - This function is suitable for the same applications above but it allows to</span>
<a name="l00510"></a>00510 <span class="comment"> *         overcome the limitations of I2C_GetFlagStatus() function (see below).</span>
<a name="l00511"></a>00511 <span class="comment"> *         The returned value could be compared to events already defined in the</span>
<a name="l00512"></a>00512 <span class="comment"> *         library (stm8s_i2c.h) or to custom values defined by user.</span>
<a name="l00513"></a>00513 <span class="comment"> *       - This function is suitable when multiple flags are monitored at the same time.</span>
<a name="l00514"></a>00514 <span class="comment"> *       - At the opposite of I2C_CheckEvent() function, this function allows user to</span>
<a name="l00515"></a>00515 <span class="comment"> *         choose when an event is accepted (when all events flags are set and no</span>
<a name="l00516"></a>00516 <span class="comment"> *         other flags are set or just when the needed flags are set like</span>
<a name="l00517"></a>00517 <span class="comment"> *         I2C_CheckEvent() function).</span>
<a name="l00518"></a>00518 <span class="comment"> *     - Limitations:</span>
<a name="l00519"></a>00519 <span class="comment"> *       - User may need to define his own events.</span>
<a name="l00520"></a>00520 <span class="comment"> *       - Same remark concerning the error management is applicable for this</span>
<a name="l00521"></a>00521 <span class="comment"> *         function if user decides to check only regular communication flags (and</span>
<a name="l00522"></a>00522 <span class="comment"> *         ignores error flags).</span>
<a name="l00523"></a>00523 <span class="comment"> *</span>
<a name="l00524"></a>00524 <span class="comment"> *</span>
<a name="l00525"></a>00525 <span class="comment"> *  3) Flag-based state monitoring:</span>
<a name="l00526"></a>00526 <span class="comment"> *     Using the function I2C_GetFlagStatus() which simply returns the status of</span>
<a name="l00527"></a>00527 <span class="comment"> *     one single flag (ie. I2C_FLAG_RXNE ...).</span>
<a name="l00528"></a>00528 <span class="comment"> *     - When to use:</span>
<a name="l00529"></a>00529 <span class="comment"> *        - This function could be used for specific applications or in debug phase.</span>
<a name="l00530"></a>00530 <span class="comment"> *        - It is suitable when only one flag checking is needed (most I2C events</span>
<a name="l00531"></a>00531 <span class="comment"> *          are monitored through multiple flags).</span>
<a name="l00532"></a>00532 <span class="comment"> *     - Limitations:</span>
<a name="l00533"></a>00533 <span class="comment"> *        - When calling this function, the Status register is accessed. Some flags are</span>
<a name="l00534"></a>00534 <span class="comment"> *          cleared when the status register is accessed. So checking the status</span>
<a name="l00535"></a>00535 <span class="comment"> *          of one Flag, may clear other ones.</span>
<a name="l00536"></a>00536 <span class="comment"> *        - Function may need to be called twice or more in order to monitor one</span>
<a name="l00537"></a>00537 <span class="comment"> *          single event.</span>
<a name="l00538"></a>00538 <span class="comment"> *</span>
<a name="l00539"></a>00539 <span class="comment"> *  For detailed description of Events, please refer to section I2C_Events in</span>
<a name="l00540"></a>00540 <span class="comment"> *  stm8s_i2c.h file.</span>
<a name="l00541"></a>00541 <span class="comment"> *</span>
<a name="l00542"></a>00542 <span class="comment"> */</span><span class="comment"></span>
<a name="l00543"></a>00543 <span class="comment">/**</span>
<a name="l00544"></a>00544 <span class="comment"> *</span>
<a name="l00545"></a>00545 <span class="comment"> *  1) Basic state monitoring</span>
<a name="l00546"></a>00546 <span class="comment"> *******************************************************************************</span>
<a name="l00547"></a>00547 <span class="comment"> */</span>
<a name="l00548"></a>00548 <span class="comment"></span>
<a name="l00549"></a>00549 <span class="comment">/**</span>
<a name="l00550"></a>00550 <span class="comment">  * @brief  Checks whether the last I2C Event is equal to the one passed</span>
<a name="l00551"></a>00551 <span class="comment">  *   as parameter.</span>
<a name="l00552"></a>00552 <span class="comment">  * @param  I2C_Event: specifies the event to be checked.</span>
<a name="l00553"></a>00553 <span class="comment">  *   This parameter can be one of the following values:</span>
<a name="l00554"></a>00554 <span class="comment">  *     @arg I2C_EVENT_SLAVE_TRANSMITTER_ADDRESS_MATCHED           : EV1</span>
<a name="l00555"></a>00555 <span class="comment">  *     @arg I2C_EVENT_SLAVE_RECEIVER_ADDRESS_MATCHED              : EV1</span>
<a name="l00556"></a>00556 <span class="comment">  *     @arg I2C_EVENT_SLAVE_GENERALCALLADDRESS_MATCHED            : EV1</span>
<a name="l00557"></a>00557 <span class="comment">  *     @arg I2C_EVENT_SLAVE_BYTE_RECEIVED                         : EV2</span>
<a name="l00558"></a>00558 <span class="comment">  *     @arg (I2C_EVENT_SLAVE_BYTE_RECEIVED | I2C_FLAG_GENCALL)    : EV2</span>
<a name="l00559"></a>00559 <span class="comment">  *     @arg I2C_EVENT_SLAVE_BYTE_TRANSMITTED                      : EV3</span>
<a name="l00560"></a>00560 <span class="comment">  *     @arg (I2C_EVENT_SLAVE_BYTE_TRANSMITTED | I2C_FLAG_GENCALL) : EV3</span>
<a name="l00561"></a>00561 <span class="comment">  *     @arg I2C_EVENT_SLAVE_ACK_FAILURE                           : EV3_2</span>
<a name="l00562"></a>00562 <span class="comment">  *     @arg I2C_EVENT_SLAVE_STOP_DETECTED                         : EV4</span>
<a name="l00563"></a>00563 <span class="comment">  *     @arg I2C_EVENT_MASTER_MODE_SELECT                          : EV5</span>
<a name="l00564"></a>00564 <span class="comment">  *     @arg I2C_EVENT_MASTER_TRANSMITTER_MODE_SELECTED            : EV6</span>
<a name="l00565"></a>00565 <span class="comment">  *     @arg I2C_EVENT_MASTER_RECEIVER_MODE_SELECTED               : EV6</span>
<a name="l00566"></a>00566 <span class="comment">  *     @arg I2C_EVENT_MASTER_BYTE_RECEIVED                        : EV7</span>
<a name="l00567"></a>00567 <span class="comment">  *     @arg I2C_EVENT_MASTER_BYTE_TRANSMITTING                    : EV8</span>
<a name="l00568"></a>00568 <span class="comment">  *     @arg I2C_EVENT_MASTER_BYTE_TRANSMITTED                     : EV8_2</span>
<a name="l00569"></a>00569 <span class="comment">  *     @arg I2C_EVENT_MASTER_MODE_ADDRESS10                       : EV9</span>
<a name="l00570"></a>00570 <span class="comment">  *</span>
<a name="l00571"></a>00571 <span class="comment">  * @note: For detailed description of Events, please refer to section</span>
<a name="l00572"></a>00572 <span class="comment">  *    I2C_Events in stm8s_i2c.h file.</span>
<a name="l00573"></a>00573 <span class="comment">  *</span>
<a name="l00574"></a>00574 <span class="comment">  * @retval An ErrorStatus enumeration value:</span>
<a name="l00575"></a>00575 <span class="comment">  * - SUCCESS: Last event is equal to the I2C_EVENT</span>
<a name="l00576"></a>00576 <span class="comment">  * - ERROR: Last event is different from the I2C_EVENT</span>
<a name="l00577"></a>00577 <span class="comment">  */</span>
<a name="l00578"></a><a class="code" href="group__i2c__public__functions.html#ga7932c7b6a5da690a32632a6f9a23d641">00578</a> <a class="code" href="group__exported__types.html#ga8333b96c67f83cba354b3407fcbb6ee8">ErrorStatus</a> <a class="code" href="group__i2c__exported__functions.html#ga7932c7b6a5da690a32632a6f9a23d641" title="I2C State Monitoring Functions.">I2C_CheckEvent</a>(<a class="code" href="group__i2c__exported__types.html#gadc952f191791c5a48a1b03dd0c0c6940" title="I2C possible events Values convention: 0xXXYY XX = Event SR3 corresponding value YY = Event SR1 corre...">I2C_Event_TypeDef</a> I2C_Event)
<a name="l00579"></a>00579 {
<a name="l00580"></a>00580   <a class="code" href="group__exported__types.html#gaec43007d9998a0a0e01faede4133d6be">__IO</a> <a class="code" href="group__exported__types.html#ga273cf69d639a59973b6019625df33e30">uint16_t</a> lastevent = 0x00;
<a name="l00581"></a>00581   <a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> flag1 = 0x00 ;
<a name="l00582"></a>00582   <a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> flag2 = 0x00;
<a name="l00583"></a>00583   <a class="code" href="group__exported__types.html#ga8333b96c67f83cba354b3407fcbb6ee8">ErrorStatus</a> status = <a class="code" href="group__exported__types.html#gga8333b96c67f83cba354b3407fcbb6ee8a2fd6f336d08340583bd620a7f5694c90">ERROR</a>;
<a name="l00584"></a>00584 
<a name="l00585"></a>00585   <span class="comment">/* Check the parameters */</span>
<a name="l00586"></a>00586   <a class="code" href="stm8s__stdperiph__examples_2adc2_2adc2__continuousconversion_2stm8s__conf_8h.html#a631dea7b230e600555f979c62af1de21" title="The assert_param macro is used for function&#39;s parameters check.">assert_param</a>(<a class="code" href="group__i2c__private__macros.html#gac3852d50976e6b2ffec7d740d098f8d5" title="Macro used by the assert function to check the different I2C possible events.">IS_I2C_EVENT_OK</a>(I2C_Event));
<a name="l00587"></a>00587 
<a name="l00588"></a>00588   <span class="keywordflow">if</span> (I2C_Event == <a class="code" href="group__i2c__exported__types.html#ggadc952f191791c5a48a1b03dd0c0c6940a8219a1ed637f4b83d356a96bf8fb0537">I2C_EVENT_SLAVE_ACK_FAILURE</a>)
<a name="l00589"></a>00589   {
<a name="l00590"></a>00590     lastevent = <a class="code" href="stm8s_8h.html#a457a9aa93dbb216459873a30bdb4d84a">I2C</a>-&gt;SR2 &amp; <a class="code" href="group__i2c__registers__bits__definition.html#gab6512fca3d02fdaff99a0eb3daf1b75b">I2C_SR2_AF</a>;
<a name="l00591"></a>00591   }
<a name="l00592"></a>00592   <span class="keywordflow">else</span>
<a name="l00593"></a>00593   {
<a name="l00594"></a>00594     flag1 = <a class="code" href="stm8s_8h.html#a457a9aa93dbb216459873a30bdb4d84a">I2C</a>-&gt;SR1;
<a name="l00595"></a>00595     flag2 = <a class="code" href="stm8s_8h.html#a457a9aa93dbb216459873a30bdb4d84a">I2C</a>-&gt;SR3;
<a name="l00596"></a>00596     lastevent = ((<a class="code" href="group__exported__types.html#ga273cf69d639a59973b6019625df33e30">uint16_t</a>)((<a class="code" href="group__exported__types.html#ga273cf69d639a59973b6019625df33e30">uint16_t</a>)flag2 &lt;&lt; (<a class="code" href="group__exported__types.html#ga273cf69d639a59973b6019625df33e30">uint16_t</a>)8) | (<a class="code" href="group__exported__types.html#ga273cf69d639a59973b6019625df33e30">uint16_t</a>)flag1);
<a name="l00597"></a>00597   }
<a name="l00598"></a>00598   <span class="comment">/* Check whether the last event is equal to I2C_EVENT */</span>
<a name="l00599"></a>00599   <span class="keywordflow">if</span> (((<a class="code" href="group__exported__types.html#ga273cf69d639a59973b6019625df33e30">uint16_t</a>)lastevent &amp; (<a class="code" href="group__exported__types.html#ga273cf69d639a59973b6019625df33e30">uint16_t</a>)I2C_Event) == (<a class="code" href="group__exported__types.html#ga273cf69d639a59973b6019625df33e30">uint16_t</a>)I2C_Event)
<a name="l00600"></a>00600   {
<a name="l00601"></a>00601     <span class="comment">/* SUCCESS: last event is equal to I2C_EVENT */</span>
<a name="l00602"></a>00602     status = <a class="code" href="group__exported__types.html#gga8333b96c67f83cba354b3407fcbb6ee8ac7f69f7c9e5aea9b8f54cf02870e2bf8">SUCCESS</a>;
<a name="l00603"></a>00603   }
<a name="l00604"></a>00604   <span class="keywordflow">else</span>
<a name="l00605"></a>00605   {
<a name="l00606"></a>00606     <span class="comment">/* ERROR: last event is different from I2C_EVENT */</span>
<a name="l00607"></a>00607     status = <a class="code" href="group__exported__types.html#gga8333b96c67f83cba354b3407fcbb6ee8a2fd6f336d08340583bd620a7f5694c90">ERROR</a>;
<a name="l00608"></a>00608   }
<a name="l00609"></a>00609 
<a name="l00610"></a>00610   <span class="comment">/* Return status */</span>
<a name="l00611"></a>00611   <span class="keywordflow">return</span> status;
<a name="l00612"></a>00612 }
<a name="l00613"></a>00613 <span class="comment"></span>
<a name="l00614"></a>00614 <span class="comment">/**</span>
<a name="l00615"></a>00615 <span class="comment"> *</span>
<a name="l00616"></a>00616 <span class="comment"> *  2) Advanced state monitoring</span>
<a name="l00617"></a>00617 <span class="comment"> *******************************************************************************</span>
<a name="l00618"></a>00618 <span class="comment"> */</span><span class="comment"></span>
<a name="l00619"></a>00619 <span class="comment">/**</span>
<a name="l00620"></a>00620 <span class="comment">  * @brief  Returns the last I2C Event.</span>
<a name="l00621"></a>00621 <span class="comment">  *</span>
<a name="l00622"></a>00622 <span class="comment">  * @note: For detailed description of Events, please refer to section</span>
<a name="l00623"></a>00623 <span class="comment">  *    I2C_Events in stm8s_i2c.h file.</span>
<a name="l00624"></a>00624 <span class="comment">  *</span>
<a name="l00625"></a>00625 <span class="comment">  * @retval The last event</span>
<a name="l00626"></a>00626 <span class="comment">  *   This parameter can be any of the  @ref I2C_Event_TypeDef enumeration.</span>
<a name="l00627"></a>00627 <span class="comment">  */</span>
<a name="l00628"></a><a class="code" href="group__i2c__public__functions.html#ga4a4027acb7ff9817eefbdf6cf6ca217d">00628</a> <a class="code" href="group__i2c__exported__types.html#gadc952f191791c5a48a1b03dd0c0c6940" title="I2C possible events Values convention: 0xXXYY XX = Event SR3 corresponding value YY = Event SR1 corre...">I2C_Event_TypeDef</a> <a class="code" href="group__i2c__exported__functions.html#ga4a4027acb7ff9817eefbdf6cf6ca217d" title="2) Advanced state monitoring">I2C_GetLastEvent</a>(<span class="keywordtype">void</span>)
<a name="l00629"></a>00629 {
<a name="l00630"></a>00630   <a class="code" href="group__exported__types.html#gaec43007d9998a0a0e01faede4133d6be">__IO</a> <a class="code" href="group__exported__types.html#ga273cf69d639a59973b6019625df33e30">uint16_t</a> lastevent = 0;
<a name="l00631"></a>00631   <a class="code" href="group__exported__types.html#ga273cf69d639a59973b6019625df33e30">uint16_t</a> flag1 = 0;
<a name="l00632"></a>00632   <a class="code" href="group__exported__types.html#ga273cf69d639a59973b6019625df33e30">uint16_t</a> flag2 = 0;
<a name="l00633"></a>00633 
<a name="l00634"></a>00634   <span class="keywordflow">if</span> ((<a class="code" href="stm8s_8h.html#a457a9aa93dbb216459873a30bdb4d84a">I2C</a>-&gt;SR2 &amp; <a class="code" href="group__i2c__registers__bits__definition.html#gab6512fca3d02fdaff99a0eb3daf1b75b">I2C_SR2_AF</a>) != 0x00)
<a name="l00635"></a>00635   {
<a name="l00636"></a>00636     lastevent = <a class="code" href="group__i2c__exported__types.html#ggadc952f191791c5a48a1b03dd0c0c6940a8219a1ed637f4b83d356a96bf8fb0537">I2C_EVENT_SLAVE_ACK_FAILURE</a>;
<a name="l00637"></a>00637   }
<a name="l00638"></a>00638   <span class="keywordflow">else</span>
<a name="l00639"></a>00639   {
<a name="l00640"></a>00640     <span class="comment">/* Read the I2C status register */</span>
<a name="l00641"></a>00641     flag1 = <a class="code" href="stm8s_8h.html#a457a9aa93dbb216459873a30bdb4d84a">I2C</a>-&gt;SR1;
<a name="l00642"></a>00642     flag2 = <a class="code" href="stm8s_8h.html#a457a9aa93dbb216459873a30bdb4d84a">I2C</a>-&gt;SR3;
<a name="l00643"></a>00643 
<a name="l00644"></a>00644     <span class="comment">/* Get the last event value from I2C status register */</span>
<a name="l00645"></a>00645     lastevent = ((<a class="code" href="group__exported__types.html#ga273cf69d639a59973b6019625df33e30">uint16_t</a>)((<a class="code" href="group__exported__types.html#ga273cf69d639a59973b6019625df33e30">uint16_t</a>)flag2 &lt;&lt; 8) | (<a class="code" href="group__exported__types.html#ga273cf69d639a59973b6019625df33e30">uint16_t</a>)flag1);
<a name="l00646"></a>00646   }
<a name="l00647"></a>00647   <span class="comment">/* Return status */</span>
<a name="l00648"></a>00648   <span class="keywordflow">return</span> (<a class="code" href="group__i2c__exported__types.html#gadc952f191791c5a48a1b03dd0c0c6940" title="I2C possible events Values convention: 0xXXYY XX = Event SR3 corresponding value YY = Event SR1 corre...">I2C_Event_TypeDef</a>)lastevent;
<a name="l00649"></a>00649 }
<a name="l00650"></a>00650 <span class="comment"></span>
<a name="l00651"></a>00651 <span class="comment">/**</span>
<a name="l00652"></a>00652 <span class="comment"> *</span>
<a name="l00653"></a>00653 <span class="comment"> *  3) Flag-based state monitoring</span>
<a name="l00654"></a>00654 <span class="comment"> *******************************************************************************</span>
<a name="l00655"></a>00655 <span class="comment"> */</span><span class="comment"></span>
<a name="l00656"></a>00656 <span class="comment">/**</span>
<a name="l00657"></a>00657 <span class="comment">  * @brief  Checks whether the specified I2C flag is set or not.</span>
<a name="l00658"></a>00658 <span class="comment">  * @param  I2C_Flag: specifies the flag to check.</span>
<a name="l00659"></a>00659 <span class="comment">  *   This parameter can be one of the following values:</span>
<a name="l00660"></a>00660 <span class="comment">  *     @arg I2C_FLAG_GENERALCALL: General call header flag (Slave mode)</span>
<a name="l00661"></a>00661 <span class="comment">  *     @arg I2C_FLAG_TRANSMITTERRECEIVER: Transmitter/Receiver flag</span>
<a name="l00662"></a>00662 <span class="comment">  *     @arg I2C_FLAG_BUSBUSY: Bus busy flag</span>
<a name="l00663"></a>00663 <span class="comment">  *     @arg I2C_FLAG_MASTERSLAVE: Master/Slave flag</span>
<a name="l00664"></a>00664 <span class="comment">  *     @arg I2C_FLAG_WAKEUPFROMHALT: Wake up from HALT flag  </span>
<a name="l00665"></a>00665 <span class="comment">  *     @arg I2C_FLAG_OVERRUNUNDERRUN: Overrun/Underrun flag (Slave mode)</span>
<a name="l00666"></a>00666 <span class="comment">  *     @arg I2C_FLAG_ACKNOWLEDGEFAILURE: Acknowledge failure flag</span>
<a name="l00667"></a>00667 <span class="comment">  *     @arg I2C_FLAG_ARBITRATIONLOSS: Arbitration lost flag (Master mode)</span>
<a name="l00668"></a>00668 <span class="comment">  *     @arg I2C_FLAG_BUSERROR: Bus error flag</span>
<a name="l00669"></a>00669 <span class="comment">  *     @arg I2C_FLAG_TXEMPTY: Data register empty flag (Transmitter)</span>
<a name="l00670"></a>00670 <span class="comment">  *     @arg I2C_FLAG_RXNOTEMPTY: Data register not empty (Receiver) flag</span>
<a name="l00671"></a>00671 <span class="comment">  *     @arg I2C_FLAG_STOPDETECTION: Stop detection flag (Slave mode)</span>
<a name="l00672"></a>00672 <span class="comment">  *     @arg I2C_FLAG_HEADERSENT: 10-bit header sent flag (Master mode)</span>
<a name="l00673"></a>00673 <span class="comment">  *     @arg I2C_FLAG_TRANSFERFINISHED: Byte transfer finished flag</span>
<a name="l00674"></a>00674 <span class="comment">  *     @arg I2C_FLAG_ADDRESSSENTMATCHED: Address sent flag (Master mode) ADSL</span>
<a name="l00675"></a>00675 <span class="comment">  *   Address matched flag (Slave mode)ENDAD</span>
<a name="l00676"></a>00676 <span class="comment">  *     @arg I2C_FLAG_STARTDETECTION: Start bit flag (Master mode)</span>
<a name="l00677"></a>00677 <span class="comment">  * @retval The new state of I2C_FLAG (SET or RESET).</span>
<a name="l00678"></a>00678 <span class="comment">  */</span>
<a name="l00679"></a><a class="code" href="group__i2c__public__functions.html#ga39f1313722666a647f4246adfbb713cd">00679</a> <a class="code" href="group__exported__types.html#ga89136caac2e14c55151f527ac02daaff">FlagStatus</a> <a class="code" href="group__i2c__exported__functions.html#ga39f1313722666a647f4246adfbb713cd" title="3) Flag-based state monitoring">I2C_GetFlagStatus</a>(<a class="code" href="group__i2c__exported__types.html#gaa5ff1a9e0dffb49301663ae1ebeea40a" title="I2C Flags.">I2C_Flag_TypeDef</a> I2C_Flag)
<a name="l00680"></a>00680 {
<a name="l00681"></a>00681   <a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> tempreg = 0;
<a name="l00682"></a>00682   <a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> regindex = 0;
<a name="l00683"></a>00683   <a class="code" href="group__exported__types.html#ga89136caac2e14c55151f527ac02daaff">FlagStatus</a> bitstatus = <a class="code" href="group__exported__types.html#gga89136caac2e14c55151f527ac02daaffa589b7d94a3d91d145720e2fed0eb3a05">RESET</a>;
<a name="l00684"></a>00684 
<a name="l00685"></a>00685   <span class="comment">/* Check the parameters */</span>
<a name="l00686"></a>00686   <a class="code" href="stm8s__stdperiph__examples_2adc2_2adc2__continuousconversion_2stm8s__conf_8h.html#a631dea7b230e600555f979c62af1de21" title="The assert_param macro is used for function&#39;s parameters check.">assert_param</a>(<a class="code" href="group__i2c__private__macros.html#ga82bad60b5c9929415d6ede2d6b1b148c" title="Macro used by the assert function to check the different I2C flags.">IS_I2C_FLAG_OK</a>(I2C_Flag));
<a name="l00687"></a>00687 
<a name="l00688"></a>00688   <span class="comment">/* Read flag register index */</span>
<a name="l00689"></a>00689   regindex = (<a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>)((<a class="code" href="group__exported__types.html#ga273cf69d639a59973b6019625df33e30">uint16_t</a>)I2C_Flag &gt;&gt; 8);
<a name="l00690"></a>00690   <span class="comment">/* Check SRx index */</span>
<a name="l00691"></a>00691   <span class="keywordflow">switch</span> (regindex)
<a name="l00692"></a>00692   {
<a name="l00693"></a>00693       <span class="comment">/* Returns whether the status register to check is SR1 */</span>
<a name="l00694"></a>00694     <span class="keywordflow">case</span> 0x01:
<a name="l00695"></a>00695       tempreg = (<a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>)<a class="code" href="stm8s_8h.html#a457a9aa93dbb216459873a30bdb4d84a">I2C</a>-&gt;SR1;
<a name="l00696"></a>00696       <span class="keywordflow">break</span>;
<a name="l00697"></a>00697 
<a name="l00698"></a>00698       <span class="comment">/* Returns whether the status register to check is SR2 */</span>
<a name="l00699"></a>00699     <span class="keywordflow">case</span> 0x02:
<a name="l00700"></a>00700       tempreg = (<a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>)<a class="code" href="stm8s_8h.html#a457a9aa93dbb216459873a30bdb4d84a">I2C</a>-&gt;SR2;
<a name="l00701"></a>00701       <span class="keywordflow">break</span>;
<a name="l00702"></a>00702 
<a name="l00703"></a>00703       <span class="comment">/* Returns whether the status register to check is SR3 */</span>
<a name="l00704"></a>00704     <span class="keywordflow">case</span> 0x03:
<a name="l00705"></a>00705       tempreg = (<a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>)<a class="code" href="stm8s_8h.html#a457a9aa93dbb216459873a30bdb4d84a">I2C</a>-&gt;SR3;
<a name="l00706"></a>00706       <span class="keywordflow">break</span>;
<a name="l00707"></a>00707 
<a name="l00708"></a>00708     <span class="keywordflow">default</span>:
<a name="l00709"></a>00709       <span class="keywordflow">break</span>;
<a name="l00710"></a>00710   }
<a name="l00711"></a>00711 
<a name="l00712"></a>00712   <span class="comment">/* Check the status of the specified I2C flag */</span>
<a name="l00713"></a>00713   <span class="keywordflow">if</span> ((tempreg &amp; (<a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>)I2C_Flag ) != 0)
<a name="l00714"></a>00714   {
<a name="l00715"></a>00715     <span class="comment">/* Flag is set */</span>
<a name="l00716"></a>00716     bitstatus = <a class="code" href="group__exported__types.html#gga89136caac2e14c55151f527ac02daaffab44c8101cc294c074709ec1b14211792">SET</a>;
<a name="l00717"></a>00717   }
<a name="l00718"></a>00718   <span class="keywordflow">else</span>
<a name="l00719"></a>00719   {
<a name="l00720"></a>00720     <span class="comment">/* Flag is reset */</span>
<a name="l00721"></a>00721     bitstatus = <a class="code" href="group__exported__types.html#gga89136caac2e14c55151f527ac02daaffa589b7d94a3d91d145720e2fed0eb3a05">RESET</a>;
<a name="l00722"></a>00722   }
<a name="l00723"></a>00723   <span class="comment">/* Return the flag status */</span>
<a name="l00724"></a>00724   <span class="keywordflow">return</span> bitstatus;
<a name="l00725"></a>00725 }
<a name="l00726"></a>00726 <span class="comment"></span>
<a name="l00727"></a>00727 <span class="comment">/**</span>
<a name="l00728"></a>00728 <span class="comment">  * @brief  Clear flags</span>
<a name="l00729"></a>00729 <span class="comment">  * @param  I2C_FLAG : Specifies the flag to clear</span>
<a name="l00730"></a>00730 <span class="comment">  *   This parameter can be any combination of the following values:</span>
<a name="l00731"></a>00731 <span class="comment">  *                       - I2C_FLAG_WAKEUPFROMHALT: Wakeup from Halt</span>
<a name="l00732"></a>00732 <span class="comment">  *                       - I2C_FLAG_OVERRUNUNDERRUN: Overrun/Underrun flag (Slave mode)</span>
<a name="l00733"></a>00733 <span class="comment">  *                       - I2C_FLAG_ACKNOWLEDGEFAILURE: Acknowledge failure flag</span>
<a name="l00734"></a>00734 <span class="comment">  *                       - I2C_FLAG_ARBITRATIONLOSS: Arbitration lost flag (Master mode)</span>
<a name="l00735"></a>00735 <span class="comment">  *                       - I2C_FLAG_BUSERROR: Bus error flag.</span>
<a name="l00736"></a>00736 <span class="comment">  * @note Notes:</span>
<a name="l00737"></a>00737 <span class="comment">  *                       - STOPF (STOP detection) is cleared by software</span>
<a name="l00738"></a>00738 <span class="comment">  *                         sequence: a read operation to I2C_SR1 register</span>
<a name="l00739"></a>00739 <span class="comment">  *                         (I2C_GetFlagStatus()) followed by a write operation</span>
<a name="l00740"></a>00740 <span class="comment">  *                         to I2C_CR2 register.</span>
<a name="l00741"></a>00741 <span class="comment">  *                       - ADD10 (10-bit header sent) is cleared by software</span>
<a name="l00742"></a>00742 <span class="comment">  *                         sequence: a read operation to I2C_SR1</span>
<a name="l00743"></a>00743 <span class="comment">  *                         (I2C_GetFlagStatus()) followed by writing the</span>
<a name="l00744"></a>00744 <span class="comment">  *                         second byte of the address in DR register.</span>
<a name="l00745"></a>00745 <span class="comment">  *                       - BTF (Byte Transfer Finished) is cleared by software</span>
<a name="l00746"></a>00746 <span class="comment">  *                         sequence: a read operation to I2C_SR1 register</span>
<a name="l00747"></a>00747 <span class="comment">  *                         (I2C_GetFlagStatus()) followed by a read/write to</span>
<a name="l00748"></a>00748 <span class="comment">  *                         I2C_DR register (I2C_SendData()).</span>
<a name="l00749"></a>00749 <span class="comment">  *                       - ADDR (Address sent) is cleared by software sequence:</span>
<a name="l00750"></a>00750 <span class="comment">  *                         a read operation to I2C_SR1 register</span>
<a name="l00751"></a>00751 <span class="comment">  *                         (I2C_GetFlagStatus()) followed by a read operation to</span>
<a name="l00752"></a>00752 <span class="comment">  *                         I2C_SR3 register ((void)(I2C-&gt;SR3)).</span>
<a name="l00753"></a>00753 <span class="comment">  *                       - SB (Start Bit) is cleared software sequence: a read</span>
<a name="l00754"></a>00754 <span class="comment">  *                         operation to I2C_SR1 register (I2C_GetFlagStatus())</span>
<a name="l00755"></a>00755 <span class="comment">  *                         followed by a write operation to I2C_DR register</span>
<a name="l00756"></a>00756 <span class="comment">  *                         (I2C_SendData()).</span>
<a name="l00757"></a>00757 <span class="comment">  * @retval None</span>
<a name="l00758"></a>00758 <span class="comment">  */</span>
<a name="l00759"></a><a class="code" href="group__i2c__public__functions.html#gab68d22553dbe25b1e6a7f4ed003c7279">00759</a> <span class="keywordtype">void</span> <a class="code" href="group__i2c__exported__functions.html#gab68d22553dbe25b1e6a7f4ed003c7279" title="Clear flags.">I2C_ClearFlag</a>(<a class="code" href="group__i2c__exported__types.html#gaa5ff1a9e0dffb49301663ae1ebeea40a" title="I2C Flags.">I2C_Flag_TypeDef</a> I2C_FLAG)
<a name="l00760"></a>00760 {
<a name="l00761"></a>00761   <a class="code" href="group__exported__types.html#ga273cf69d639a59973b6019625df33e30">uint16_t</a> flagpos = 0;
<a name="l00762"></a>00762   <span class="comment">/* Check the parameters */</span>
<a name="l00763"></a>00763   <a class="code" href="stm8s__stdperiph__examples_2adc2_2adc2__continuousconversion_2stm8s__conf_8h.html#a631dea7b230e600555f979c62af1de21" title="The assert_param macro is used for function&#39;s parameters check.">assert_param</a>(<a class="code" href="group__i2c__private__macros.html#ga446fe3953d7dfa28c77f083ada212e40" title="Macro used by the assert function to check the I2C flags to clear.">IS_I2C_CLEAR_FLAG_OK</a>(I2C_FLAG));
<a name="l00764"></a>00764 
<a name="l00765"></a>00765   <span class="comment">/* Get the I2C flag position */</span>
<a name="l00766"></a>00766   flagpos = (<a class="code" href="group__exported__types.html#ga273cf69d639a59973b6019625df33e30">uint16_t</a>)I2C_FLAG &amp; <a class="code" href="group__i2c__private__defines.html#ga2be62bf481cd44de9ab604efe5595ff6">FLAG_Mask</a>;
<a name="l00767"></a>00767   <span class="comment">/* Clear the selected I2C flag */</span>
<a name="l00768"></a>00768   <a class="code" href="stm8s_8h.html#a457a9aa93dbb216459873a30bdb4d84a">I2C</a>-&gt;SR2 = (<a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>)((<a class="code" href="group__exported__types.html#ga273cf69d639a59973b6019625df33e30">uint16_t</a>)(~flagpos));
<a name="l00769"></a>00769 }
<a name="l00770"></a>00770 <span class="comment"></span>
<a name="l00771"></a>00771 <span class="comment">/**</span>
<a name="l00772"></a>00772 <span class="comment">  * @brief  Checks whether the specified I2C interrupt has occurred or not.</span>
<a name="l00773"></a>00773 <span class="comment">  * @param  I2C_ITPendingBit: specifies the interrupt source to check.</span>
<a name="l00774"></a>00774 <span class="comment">  *            This parameter can be one of the following values:</span>
<a name="l00775"></a>00775 <span class="comment">  *               - I2C_ITPENDINGBIT_WAKEUPFROMHALT: Wakeup from Halt</span>
<a name="l00776"></a>00776 <span class="comment">  *               - I2C_ITPENDINGBIT_OVERRUNUNDERRUN: Overrun/Underrun flag (Slave mode)</span>
<a name="l00777"></a>00777 <span class="comment">  *               - I2C_ITPENDINGBIT_ACKNOWLEDGEFAILURE: Acknowledge failure flag</span>
<a name="l00778"></a>00778 <span class="comment">  *               - I2C_ITPENDINGBIT_ARBITRATIONLOSS: Arbitration lost flag (Master mode)</span>
<a name="l00779"></a>00779 <span class="comment">  *               - I2C_ITPENDINGBIT_BUSERROR: Bus error flag</span>
<a name="l00780"></a>00780 <span class="comment">  *               - I2C_ITPENDINGBIT_TXEMPTY: Data register empty flag (Transmitter)</span>
<a name="l00781"></a>00781 <span class="comment">  *               - I2C_ITPENDINGBIT_RXNOTEMPTY: Data register not empty (Receiver) flag</span>
<a name="l00782"></a>00782 <span class="comment">  *               - I2C_ITPENDINGBIT_STOPDETECTION: Stop detection flag (Slave mode)</span>
<a name="l00783"></a>00783 <span class="comment">  *               - I2C_ITPENDINGBIT_HEADERSENT: 10-bit header sent flag (Master mode)</span>
<a name="l00784"></a>00784 <span class="comment">  *               - I2C_ITPENDINGBIT_TRANSFERFINISHED: Byte transfer finished flag</span>
<a name="l00785"></a>00785 <span class="comment">  *               - I2C_ITPENDINGBIT_ADDRESSSENTMATCHED: Address sent flag (Master mode) ADSL</span>
<a name="l00786"></a>00786 <span class="comment">  *                              Address matched flag (Slave mode)ENDAD</span>
<a name="l00787"></a>00787 <span class="comment">  *               - I2C_ITPENDINGBIT_STARTDETECTION: Start bit flag (Master mode)</span>
<a name="l00788"></a>00788 <span class="comment">  * @retval The new state of I2C_ITPendingBit</span>
<a name="l00789"></a>00789 <span class="comment">  *   This parameter can be any of the @ref ITStatus enumeration.</span>
<a name="l00790"></a>00790 <span class="comment">  */</span>
<a name="l00791"></a><a class="code" href="group__i2c__public__functions.html#ga2854c7eb7f8b23ccdf7df7e69beebe92">00791</a> <a class="code" href="group__exported__types.html#gaacbd7ed539db0aacd973a0f6eca34074">ITStatus</a> <a class="code" href="group__i2c__exported__functions.html#ga2854c7eb7f8b23ccdf7df7e69beebe92" title="Checks whether the specified I2C interrupt has occurred or not.">I2C_GetITStatus</a>(<a class="code" href="group__i2c__exported__types.html#ga073a1d724d4d4804dc509795a7c06329" title="I2C Pending bits Elements values convention: 0xXYZZ X = SRx registers index X = 1 : SR1 X = 2 : SR2 Y...">I2C_ITPendingBit_TypeDef</a> I2C_ITPendingBit)
<a name="l00792"></a>00792 {
<a name="l00793"></a>00793   <a class="code" href="group__exported__types.html#gaacbd7ed539db0aacd973a0f6eca34074">ITStatus</a> bitstatus = <a class="code" href="group__exported__types.html#gga89136caac2e14c55151f527ac02daaffa589b7d94a3d91d145720e2fed0eb3a05">RESET</a>;
<a name="l00794"></a>00794   <a class="code" href="group__exported__types.html#gaec43007d9998a0a0e01faede4133d6be">__IO</a> <a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> enablestatus = 0;
<a name="l00795"></a>00795   <a class="code" href="group__exported__types.html#ga273cf69d639a59973b6019625df33e30">uint16_t</a> tempregister = 0;
<a name="l00796"></a>00796 
<a name="l00797"></a>00797     <span class="comment">/* Check the parameters */</span>
<a name="l00798"></a>00798     <a class="code" href="stm8s__stdperiph__examples_2adc2_2adc2__continuousconversion_2stm8s__conf_8h.html#a631dea7b230e600555f979c62af1de21" title="The assert_param macro is used for function&#39;s parameters check.">assert_param</a>(<a class="code" href="group__i2c__private__macros.html#gacd541ed3eeb8e3224cf31808e6afc7d3" title="Macro used by the assert function to check the different I2C possible pending bits.">IS_I2C_ITPENDINGBIT_OK</a>(I2C_ITPendingBit));
<a name="l00799"></a>00799 
<a name="l00800"></a>00800   tempregister = (<a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>)( ((<a class="code" href="group__exported__types.html#ga273cf69d639a59973b6019625df33e30">uint16_t</a>)((<a class="code" href="group__exported__types.html#ga273cf69d639a59973b6019625df33e30">uint16_t</a>)I2C_ITPendingBit &amp; <a class="code" href="group__i2c__private__defines.html#gab99e12994e073c2a681a6cf68492b3e2">ITEN_Mask</a>)) &gt;&gt; 8);
<a name="l00801"></a>00801 
<a name="l00802"></a>00802   <span class="comment">/* Check if the interrupt source is enabled or not */</span>
<a name="l00803"></a>00803   enablestatus = (<a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>)(<a class="code" href="stm8s_8h.html#a457a9aa93dbb216459873a30bdb4d84a">I2C</a>-&gt;ITR &amp; ( <a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>)tempregister);
<a name="l00804"></a>00804 
<a name="l00805"></a>00805   <span class="keywordflow">if</span> ((<a class="code" href="group__exported__types.html#ga273cf69d639a59973b6019625df33e30">uint16_t</a>)((<a class="code" href="group__exported__types.html#ga273cf69d639a59973b6019625df33e30">uint16_t</a>)I2C_ITPendingBit &amp; <a class="code" href="group__i2c__private__defines.html#gabe83f294561a64ea986ec4f2fef39b0a">REGISTER_Mask</a>) == <a class="code" href="group__i2c__private__defines.html#gab05825bbf266abde5a7875b167c67c01">REGISTER_SR1_Index</a>)
<a name="l00806"></a>00806   {
<a name="l00807"></a>00807     <span class="comment">/* Check the status of the specified I2C flag */</span>
<a name="l00808"></a>00808     <span class="keywordflow">if</span> (((<a class="code" href="stm8s_8h.html#a457a9aa93dbb216459873a30bdb4d84a">I2C</a>-&gt;SR1 &amp; (<a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>)I2C_ITPendingBit) != <a class="code" href="group__exported__types.html#gga89136caac2e14c55151f527ac02daaffa589b7d94a3d91d145720e2fed0eb3a05">RESET</a>) &amp;&amp; enablestatus)
<a name="l00809"></a>00809     {
<a name="l00810"></a>00810       <span class="comment">/* I2C_IT is set */</span>
<a name="l00811"></a>00811       bitstatus = <a class="code" href="group__exported__types.html#gga89136caac2e14c55151f527ac02daaffab44c8101cc294c074709ec1b14211792">SET</a>;
<a name="l00812"></a>00812     }
<a name="l00813"></a>00813     <span class="keywordflow">else</span>
<a name="l00814"></a>00814     {
<a name="l00815"></a>00815       <span class="comment">/* I2C_IT is reset */</span>
<a name="l00816"></a>00816       bitstatus = <a class="code" href="group__exported__types.html#gga89136caac2e14c55151f527ac02daaffa589b7d94a3d91d145720e2fed0eb3a05">RESET</a>;
<a name="l00817"></a>00817     }
<a name="l00818"></a>00818   }
<a name="l00819"></a>00819   <span class="keywordflow">else</span>
<a name="l00820"></a>00820   {
<a name="l00821"></a>00821     <span class="comment">/* Check the status of the specified I2C flag */</span>
<a name="l00822"></a>00822     <span class="keywordflow">if</span> (((<a class="code" href="stm8s_8h.html#a457a9aa93dbb216459873a30bdb4d84a">I2C</a>-&gt;SR2 &amp; (<a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>)I2C_ITPendingBit) != <a class="code" href="group__exported__types.html#gga89136caac2e14c55151f527ac02daaffa589b7d94a3d91d145720e2fed0eb3a05">RESET</a>) &amp;&amp; enablestatus)
<a name="l00823"></a>00823     {
<a name="l00824"></a>00824       <span class="comment">/* I2C_IT is set */</span>
<a name="l00825"></a>00825       bitstatus = <a class="code" href="group__exported__types.html#gga89136caac2e14c55151f527ac02daaffab44c8101cc294c074709ec1b14211792">SET</a>;
<a name="l00826"></a>00826     }
<a name="l00827"></a>00827     <span class="keywordflow">else</span>
<a name="l00828"></a>00828     {
<a name="l00829"></a>00829       <span class="comment">/* I2C_IT is reset */</span>
<a name="l00830"></a>00830       bitstatus = <a class="code" href="group__exported__types.html#gga89136caac2e14c55151f527ac02daaffa589b7d94a3d91d145720e2fed0eb3a05">RESET</a>;
<a name="l00831"></a>00831     }
<a name="l00832"></a>00832   }
<a name="l00833"></a>00833   <span class="comment">/* Return the I2C_IT status */</span>
<a name="l00834"></a>00834   <span class="keywordflow">return</span>  bitstatus;
<a name="l00835"></a>00835 }
<a name="l00836"></a>00836 <span class="comment"></span>
<a name="l00837"></a>00837 <span class="comment">/**</span>
<a name="l00838"></a>00838 <span class="comment">  * @brief  Clear IT pending bit</span>
<a name="l00839"></a>00839 <span class="comment">  * @param  I2C_ITPendingBit : specifies the interrupt pending bit to clear.</span>
<a name="l00840"></a>00840 <span class="comment">  *            This parameter can be any combination of the following values:</span>
<a name="l00841"></a>00841 <span class="comment">  *                 - I2C_ITPENDINGBIT_WAKEUPFROMHALT: Wakeup from Halt</span>
<a name="l00842"></a>00842 <span class="comment">  *                 - I2C_ITPENDINGBIT_OVERRUNUNDERRUN: Overrun/Underrun interrupt (Slave mode)</span>
<a name="l00843"></a>00843 <span class="comment">  *                 - I2C_ITPENDINGBIT_ACKNOWLEDGEFAILURE: Acknowledge failure interrupt</span>
<a name="l00844"></a>00844 <span class="comment">  *                 - I2C_ITPENDINGBIT_ARBITRATIONLOSS: Arbitration lost interrupt (Master mode)</span>
<a name="l00845"></a>00845 <span class="comment">  *                 - I2C_ITPENDINGBIT_BUSERROR: Bus error interrupt</span>
<a name="l00846"></a>00846 <span class="comment">  *</span>
<a name="l00847"></a>00847 <span class="comment">  *             Notes:</span>
<a name="l00848"></a>00848 <span class="comment">  *                  - STOPF (STOP detection) is cleared by software</span>
<a name="l00849"></a>00849 <span class="comment">  *                    sequence: a read operation to I2C_SR1 register</span>
<a name="l00850"></a>00850 <span class="comment">  *                    (I2C_GetITStatus()) followed by a write operation to</span>
<a name="l00851"></a>00851 <span class="comment">  *                    I2C_CR2 register (I2C_AcknowledgeConfig() to configure</span>
<a name="l00852"></a>00852 <span class="comment">  *                    the I2C peripheral Acknowledge).</span>
<a name="l00853"></a>00853 <span class="comment">  *                  - ADD10 (10-bit header sent) is cleared by software</span>
<a name="l00854"></a>00854 <span class="comment">  *                    sequence: a read operation to I2C_SR1</span>
<a name="l00855"></a>00855 <span class="comment">  *                    (I2C_GetITStatus()) followed by writing the second</span>
<a name="l00856"></a>00856 <span class="comment">  *                    byte of the address in I2C_DR register.</span>
<a name="l00857"></a>00857 <span class="comment">  *                  - BTF (Byte Transfer Finished) is cleared by software</span>
<a name="l00858"></a>00858 <span class="comment">  *                    sequence: a read operation to I2C_SR1 register</span>
<a name="l00859"></a>00859 <span class="comment">  *                    (I2C_GetITStatus()) followed by a read/write to</span>
<a name="l00860"></a>00860 <span class="comment">  *                    I2C_DR register (I2C_SendData()).</span>
<a name="l00861"></a>00861 <span class="comment">  *                  - ADDR (Address sent) is cleared by software sequence:</span>
<a name="l00862"></a>00862 <span class="comment">  *                    a read operation to I2C_SR1 register (I2C_GetITStatus())</span>
<a name="l00863"></a>00863 <span class="comment">  *                    followed by a read operation to I2C_SR3 register</span>
<a name="l00864"></a>00864 <span class="comment">  *                    ((void)(I2C-&gt;SR3)).</span>
<a name="l00865"></a>00865 <span class="comment">  *                  - SB (Start Bit) is cleared by software sequence: a</span>
<a name="l00866"></a>00866 <span class="comment">  *                    read operation to I2C_SR1 register (I2C_GetITStatus())</span>
<a name="l00867"></a>00867 <span class="comment">  *                    followed by a write operation to I2C_DR register</span>
<a name="l00868"></a>00868 <span class="comment">  *                    (I2C_SendData()).</span>
<a name="l00869"></a>00869 <span class="comment">  * @retval None</span>
<a name="l00870"></a>00870 <span class="comment">  */</span>
<a name="l00871"></a><a class="code" href="group__i2c__public__functions.html#gaadda9efbdbfc3651dbe735f25d2e529d">00871</a> <span class="keywordtype">void</span> <a class="code" href="group__i2c__exported__functions.html#gaadda9efbdbfc3651dbe735f25d2e529d" title="Clear IT pending bit.">I2C_ClearITPendingBit</a>(<a class="code" href="group__i2c__exported__types.html#ga073a1d724d4d4804dc509795a7c06329" title="I2C Pending bits Elements values convention: 0xXYZZ X = SRx registers index X = 1 : SR1 X = 2 : SR2 Y...">I2C_ITPendingBit_TypeDef</a> I2C_ITPendingBit)
<a name="l00872"></a>00872 {
<a name="l00873"></a>00873   <a class="code" href="group__exported__types.html#ga273cf69d639a59973b6019625df33e30">uint16_t</a> flagpos = 0;
<a name="l00874"></a>00874 
<a name="l00875"></a>00875   <span class="comment">/* Check the parameters */</span>
<a name="l00876"></a>00876   <a class="code" href="stm8s__stdperiph__examples_2adc2_2adc2__continuousconversion_2stm8s__conf_8h.html#a631dea7b230e600555f979c62af1de21" title="The assert_param macro is used for function&#39;s parameters check.">assert_param</a>(<a class="code" href="group__i2c__private__macros.html#gadc034d46f457a6b8e1513dad2bf3853c" title="Macro used by the assert function to check the different I2C possible pending bits to clear by writin...">IS_I2C_CLEAR_ITPENDINGBIT_OK</a>(I2C_ITPendingBit));
<a name="l00877"></a>00877 
<a name="l00878"></a>00878   <span class="comment">/* Get the I2C flag position */</span>
<a name="l00879"></a>00879   flagpos = (<a class="code" href="group__exported__types.html#ga273cf69d639a59973b6019625df33e30">uint16_t</a>)I2C_ITPendingBit &amp; <a class="code" href="group__i2c__private__defines.html#ga2be62bf481cd44de9ab604efe5595ff6">FLAG_Mask</a>;
<a name="l00880"></a>00880 
<a name="l00881"></a>00881   <span class="comment">/* Clear the selected I2C flag */</span>
<a name="l00882"></a>00882   <a class="code" href="stm8s_8h.html#a457a9aa93dbb216459873a30bdb4d84a">I2C</a>-&gt;SR2 = (<a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>)((<a class="code" href="group__exported__types.html#ga273cf69d639a59973b6019625df33e30">uint16_t</a>)~flagpos);
<a name="l00883"></a>00883 }
<a name="l00884"></a>00884 <span class="comment"></span>
<a name="l00885"></a>00885 <span class="comment">/**</span>
<a name="l00886"></a>00886 <span class="comment">  * @}</span>
<a name="l00887"></a>00887 <span class="comment">  */</span>
<a name="l00888"></a>00888 <span class="comment"></span>
<a name="l00889"></a>00889 <span class="comment">/**</span>
<a name="l00890"></a>00890 <span class="comment">  * @}</span>
<a name="l00891"></a>00891 <span class="comment">  */</span>
<a name="l00892"></a>00892 
<a name="l00893"></a>00893 <span class="comment">/************************ (C) COPYRIGHT STMicroelectronics *****END OF FILE****/</span>
</pre></div></div>
</div>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html xmlns:v="urn:schemas-microsoft-com:vml" xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:w="urn:schemas-microsoft-com:office:word" xmlns="http://www.w3.org/TR/REC-html40"><head>

<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<link rel="File-List" href="footer_files/filelist.xml"><title>STM8 Standard Peripherals Library: Footer</title><!--[if gte mso 9]><xml>
 <o:DocumentProperties>
  <o:Author>STMicroelectronics</o:Author>
  <o:LastAuthor>STMicroelectronics</o:LastAuthor>
  <o:Revision>96</o:Revision>
  <o:TotalTime>61</o:TotalTime>
  <o:Created>2009-02-27T18:59:00Z</o:Created>
  <o:LastSaved>2009-03-01T17:58:00Z</o:LastSaved>
  <o:Pages>1</o:Pages>
  <o:Words>25</o:Words>
  <o:Characters>149</o:Characters>
  <o:Company>STMicroelectronics</o:Company>
  <o:Lines>1</o:Lines>
  <o:Paragraphs>1</o:Paragraphs>
  <o:CharactersWithSpaces>173</o:CharactersWithSpaces>
  <o:Version>11.6568</o:Version>
 </o:DocumentProperties>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:WordDocument>
  <w:Zoom>110</w:Zoom>
  <w:SpellingState>Clean</w:SpellingState>
  <w:GrammarState>Clean</w:GrammarState>
  <w:ValidateAgainstSchemas/>
  <w:SaveIfXMLInvalid>false</w:SaveIfXMLInvalid>
  <w:IgnoreMixedContent>false</w:IgnoreMixedContent>
  <w:AlwaysShowPlaceholderText>false</w:AlwaysShowPlaceholderText>
  <w:BrowserLevel>MicrosoftInternetExplorer4</w:BrowserLevel>
 </w:WordDocument>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:LatentStyles DefLockedState="false" LatentStyleCount="156">
 </w:LatentStyles>
</xml><![endif]-->


<style>
<!--
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
	{mso-style-parent:"";
	margin:0in;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";}
h1
	{mso-margin-top-alt:auto;
	margin-right:0in;
	mso-margin-bottom-alt:auto;
	margin-left:0in;
	mso-pagination:widow-orphan;
	mso-outline-level:1;
	font-size:24.0pt;
	font-family:"Times New Roman";
	font-weight:bold;}
h2
	{mso-style-next:Normal;
	margin-top:12.0pt;
	margin-right:0in;
	margin-bottom:3.0pt;
	margin-left:0in;
	mso-pagination:widow-orphan;
	page-break-after:avoid;
	mso-outline-level:2;
	font-size:14.0pt;
	font-family:Arial;
	font-weight:bold;
	font-style:italic;}
p.MsoCaption, li.MsoCaption, div.MsoCaption
	{mso-style-noshow:yes;
	mso-style-next:Normal;
	margin:0in;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:10.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";
	font-weight:bold;}
a:link, span.MsoHyperlink
	{color:blue;
	text-decoration:underline;
	text-underline:single;}
a:visited, span.MsoHyperlinkFollowed
	{color:#606420;
	text-decoration:underline;
	text-underline:single;}
p
	{mso-margin-top-alt:auto;
	margin-right:0in;
	mso-margin-bottom-alt:auto;
	margin-left:0in;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";}
p.StyleHeading1Arial135ptItalicBlack, li.StyleHeading1Arial135ptItalicBlack, div.StyleHeading1Arial135ptItalicBlack
	{mso-style-name:"Style Heading 1 + Arial 13\.5 pt Italic Black";
	mso-style-parent:"Heading 1";
	mso-margin-top-alt:auto;
	margin-right:0in;
	mso-margin-bottom-alt:auto;
	margin-left:0in;
	mso-pagination:widow-orphan;
	mso-outline-level:1;
	font-size:16.0pt;
	mso-bidi-font-size:24.0pt;
	font-family:Arial;
	mso-fareast-font-family:"Times New Roman";
	mso-bidi-font-family:"Times New Roman";
	color:black;
	mso-font-kerning:18.0pt;
	font-weight:bold;
	font-style:italic;}
@page Section1
	{size:8.5in 11.0in;
	margin:1.0in 1.25in 1.0in 1.25in;
	mso-header-margin:.5in;
	mso-footer-margin:.5in;
	mso-paper-source:0;}
div.Section1
	{page:Section1;}
-->
</style><!--[if gte mso 10]>
<style>
 /* Style Definitions */
 table.MsoNormalTable
	{mso-style-name:"Table Normal";
	mso-tstyle-rowband-size:0;
	mso-tstyle-colband-size:0;
	mso-style-noshow:yes;
	mso-style-parent:"";
	mso-padding-alt:0in 5.4pt 0in 5.4pt;
	mso-para-margin:0in;
	mso-para-margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:10.0pt;
	font-family:"Times New Roman";
	mso-ansi-language:#0400;
	mso-fareast-language:#0400;
	mso-bidi-language:#0400;}
</style>
<![endif]--><!--[if gte mso 9]><xml>
 <o:shapedefaults v:ext="edit" spidmax="23554"/>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <o:shapelayout v:ext="edit">
  <o:idmap v:ext="edit" data="1"/>
 </o:shapelayout></xml><![endif]--></head>
<body style="" link="blue" vlink="#606420">

<div class="Section1">

<p style="margin-top: 13px; height: 7px;" class="MsoNormal"><o:p>&nbsp;</o:p></p>

<div align="center">

<table class="MsoNormalTable" style="width: 903px; height: 120px;" border="0" cellpadding="0" cellspacing="0">
 <tbody><tr style="">
  <td style="padding: 0in;" valign="top">
  <p style="height: 13px;" class="MsoNormal"><span style="display: none;"><o:p>&nbsp;</o:p></span></p>
  <table class="MsoNormalTable" style="width: 675pt;" border="0" cellpadding="0" width="900">
   <tbody><tr style="">
    <td style="padding: 0in;" valign="top">
    <table class="MsoNormalTable" style="width: 864px; height: 53px;" border="0" cellpadding="0" cellspacing="5">
     <tbody><tr style="">
      <td style="border-style: solid none none; border-color: windowtext -moz-use-text-color -moz-use-text-color; border-width: 1pt medium medium; padding: 0in; width: 98.86%; height: 61px;" width="98%">
      
      <p class="MsoNormal" style="text-align: center; height: 10px;" align="center"><span style="font-size: 10pt; font-family: Arial;"><o:p>&nbsp;</o:p></span></p>
<span style="font-size: 10pt; font-family: Arial;">&nbsp; &nbsp; &nbsp; For complete
documentation on STM8 8-bit Microcontrollers platform visit&nbsp;<span style="color: blue;"><a href="http://www.st.com/internet/mcu/family/141.jsp" target="_blank">www.st.com</a></span></span><p class="MsoNormal" style="text-align: center; margin-top: 0px; height: 5px;" align="center"></p>
      </td>
     </tr>
    </tbody></table>
    <p style="height: 12px;" class="MsoNormal"><span style="font-size: 10pt;"><o:p></o:p></span></p>
    </td>
   </tr>
  </tbody></table>
  <p class="MsoNormal"><span style="font-size: 10pt;"><o:p></o:p></span></p>
  </td>
 </tr>
</tbody></table>

</div>

<p class="MsoNormal"><o:p>&nbsp;</o:p></p>

</div>

</body></html>
