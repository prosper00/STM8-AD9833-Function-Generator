<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>STM8S/A Standard Peripherals Firmware Library: stm8s_flash.c Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />



</head>
<body><script language="javascript">
if (window.name != "content")
    document.write("<center><a href='index.html?page=stm8s__flash_8c_source.html'>show framing</a></center>")
</script>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">STM8S/A Standard Peripherals Firmware Library
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.5.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="dir_99fee8dcdd0167cb7ca79288e08b10f1.html">STM8S_StdPeriph_Lib_V2.3.0</a>      </li>
      <li class="navelem"><a class="el" href="dir_f5da7e899866e3fe224c5708fd2dd723.html">Libraries</a>      </li>
      <li class="navelem"><a class="el" href="dir_c53ce1dacb9f624efb36b49d8509ea3b.html">STM8S_StdPeriph_Driver</a>      </li>
      <li class="navelem"><a class="el" href="dir_52950623546e9b39c79b5c109bbbfc22.html">src</a>      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">stm8s_flash.c</div>  </div>
</div>
<div class="contents">
<a href="stm8s__flash_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/**</span>
<a name="l00002"></a>00002 <span class="comment">  ******************************************************************************</span>
<a name="l00003"></a>00003 <span class="comment">  * @file    stm8s_flash.c</span>
<a name="l00004"></a>00004 <span class="comment">  * @author  MCD Application Team</span>
<a name="l00005"></a>00005 <span class="comment">  * @version V2.3.0</span>
<a name="l00006"></a>00006 <span class="comment">  * @date    16-June-2017</span>
<a name="l00007"></a>00007 <span class="comment">  * @brief   This file contains all the functions for the FLASH peripheral.</span>
<a name="l00008"></a>00008 <span class="comment">   ******************************************************************************</span>
<a name="l00009"></a>00009 <span class="comment">  * @attention</span>
<a name="l00010"></a>00010 <span class="comment">  *</span>
<a name="l00011"></a>00011 <span class="comment">  * &lt;h2&gt;&lt;center&gt;&amp;copy; COPYRIGHT 2014 STMicroelectronics&lt;/center&gt;&lt;/h2&gt;</span>
<a name="l00012"></a>00012 <span class="comment">  *</span>
<a name="l00013"></a>00013 <span class="comment">  * Licensed under MCD-ST Liberty SW License Agreement V2, (the &quot;License&quot;);</span>
<a name="l00014"></a>00014 <span class="comment">  * You may not use this file except in compliance with the License.</span>
<a name="l00015"></a>00015 <span class="comment">  * You may obtain a copy of the License at:</span>
<a name="l00016"></a>00016 <span class="comment">  *</span>
<a name="l00017"></a>00017 <span class="comment">  *        http://www.st.com/software_license_agreement_liberty_v2</span>
<a name="l00018"></a>00018 <span class="comment">  *</span>
<a name="l00019"></a>00019 <span class="comment">  * Unless required by applicable law or agreed to in writing, software </span>
<a name="l00020"></a>00020 <span class="comment">  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS, </span>
<a name="l00021"></a>00021 <span class="comment">  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<a name="l00022"></a>00022 <span class="comment">  * See the License for the specific language governing permissions and</span>
<a name="l00023"></a>00023 <span class="comment">  * limitations under the License.</span>
<a name="l00024"></a>00024 <span class="comment">  *</span>
<a name="l00025"></a>00025 <span class="comment">  ******************************************************************************</span>
<a name="l00026"></a>00026 <span class="comment">  */</span>
<a name="l00027"></a>00027 
<a name="l00028"></a>00028 <span class="comment">/* Includes ------------------------------------------------------------------*/</span>
<a name="l00029"></a>00029 <span class="preprocessor">#include &quot;<a class="code" href="stm8s__flash_8h.html" title="This file contains all functions prototype and macros for the FLASH peripheral.">stm8s_flash.h</a>&quot;</span>
<a name="l00030"></a>00030 <span class="comment"></span>
<a name="l00031"></a>00031 <span class="comment">/** @addtogroup STM8S_StdPeriph_Driver</span>
<a name="l00032"></a>00032 <span class="comment">  * @{</span>
<a name="l00033"></a>00033 <span class="comment">  */</span><span class="comment"></span>
<a name="l00034"></a>00034 <span class="comment">/**</span>
<a name="l00035"></a>00035 <span class="comment">@code</span>
<a name="l00036"></a>00036 <span class="comment"> This driver provides functions to configure and program the Flash memory of all</span>
<a name="l00037"></a>00037 <span class="comment"> STM8S devices.</span>
<a name="l00038"></a>00038 <span class="comment"></span>
<a name="l00039"></a>00039 <span class="comment"> It includes as well functions that can be either executed from RAM or not, and</span>
<a name="l00040"></a>00040 <span class="comment"> other functions that must be executed from RAM otherwise useless.</span>
<a name="l00041"></a>00041 <span class="comment"></span>
<a name="l00042"></a>00042 <span class="comment"> The table below lists the functions that can be executed from RAM.</span>
<a name="l00043"></a>00043 <span class="comment"></span>
<a name="l00044"></a>00044 <span class="comment"> +--------------------------------------------------------------------------------|</span>
<a name="l00045"></a>00045 <span class="comment"> |   Functions prototypes      |    RAM execution            |     Comments       |</span>
<a name="l00046"></a>00046 <span class="comment"> ---------------------------------------------------------------------------------|</span>
<a name="l00047"></a>00047 <span class="comment"> |                             | Mandatory in case of block  | Can be executed    |</span>
<a name="l00048"></a>00048 <span class="comment"> | FLASH_WaitForLastOperation  | Operation:                  | from Flash in case |</span>
<a name="l00049"></a>00049 <span class="comment"> |                             | - Block programming         | of byte and word   |</span>
<a name="l00050"></a>00050 <span class="comment"> |                             | - Block erase               | Operations         |</span>
<a name="l00051"></a>00051 <span class="comment"> |--------------------------------------------------------------------------------|</span>
<a name="l00052"></a>00052 <span class="comment"> | FLASH_ProgramBlock          |       Exclusively           | useless from Flash |</span>
<a name="l00053"></a>00053 <span class="comment"> |--------------------------------------------------------------------------------|</span>
<a name="l00054"></a>00054 <span class="comment"> | FLASH_EraseBlock            |       Exclusively           | useless from Flash |</span>
<a name="l00055"></a>00055 <span class="comment"> |--------------------------------------------------------------------------------|</span>
<a name="l00056"></a>00056 <span class="comment"></span>
<a name="l00057"></a>00057 <span class="comment"> To be able to execute functions from RAM several steps have to be followed.</span>
<a name="l00058"></a>00058 <span class="comment"> These steps may differ from one toolchain to another.</span>
<a name="l00059"></a>00059 <span class="comment"> A detailed description is available below within this driver.</span>
<a name="l00060"></a>00060 <span class="comment"> You can also refer to the FLASH examples provided within the</span>
<a name="l00061"></a>00061 <span class="comment"> STM8S_StdPeriph_Lib package.</span>
<a name="l00062"></a>00062 <span class="comment"></span>
<a name="l00063"></a>00063 <span class="comment">@endcode</span>
<a name="l00064"></a>00064 <span class="comment">*/</span>
<a name="l00065"></a>00065 
<a name="l00066"></a>00066 
<a name="l00067"></a>00067 <span class="comment">/* Private typedef -----------------------------------------------------------*/</span>
<a name="l00068"></a>00068 <span class="comment">/* Private define ------------------------------------------------------------*/</span>
<a name="l00069"></a><a class="code" href="group__stm8s__stdperiph__driver.html#ga4ed67c8b1a35340c79c45e2a33929b78">00069</a> <span class="preprocessor">#define FLASH_CLEAR_BYTE    ((uint8_t)0x00)</span>
<a name="l00070"></a><a class="code" href="group__stm8s__stdperiph__driver.html#ga3fdab1bd900807c8a27910521c89ba3b">00070</a> <span class="preprocessor"></span><span class="preprocessor">#define FLASH_SET_BYTE      ((uint8_t)0xFF)</span>
<a name="l00071"></a><a class="code" href="group__stm8s__stdperiph__driver.html#ga89727fe5caa11ee1ba6afe3b11d8808d">00071</a> <span class="preprocessor"></span><span class="preprocessor">#define OPERATION_TIMEOUT   ((uint16_t)0xFFFF)</span>
<a name="l00072"></a>00072 <span class="preprocessor"></span><span class="comment">/* Private macro -------------------------------------------------------------*/</span>
<a name="l00073"></a>00073 <span class="comment">/* Private variables ---------------------------------------------------------*/</span>
<a name="l00074"></a>00074 <span class="comment">/* Private function prototypes -----------------------------------------------*/</span>
<a name="l00075"></a>00075 <span class="comment">/* Private Constants ---------------------------------------------------------*/</span>
<a name="l00076"></a>00076 <span class="comment"></span>
<a name="l00077"></a>00077 <span class="comment">/** @addtogroup FLASH_Public_functions</span>
<a name="l00078"></a>00078 <span class="comment">  * @{</span>
<a name="l00079"></a>00079 <span class="comment">  */</span>
<a name="l00080"></a>00080 <span class="comment"></span>
<a name="l00081"></a>00081 <span class="comment">/**</span>
<a name="l00082"></a>00082 <span class="comment">  * @brief  Unlocks the program or data EEPROM memory</span>
<a name="l00083"></a>00083 <span class="comment">  * @param  FLASH_MemType : Memory type to unlock</span>
<a name="l00084"></a>00084 <span class="comment">  *         This parameter can be a value of @ref FLASH_MemType_TypeDef</span>
<a name="l00085"></a>00085 <span class="comment">  * @retval None</span>
<a name="l00086"></a>00086 <span class="comment">  */</span>
<a name="l00087"></a><a class="code" href="group__flash__public__functions.html#gad4100201744f55e313d155d9f94dc1a1">00087</a> <span class="keywordtype">void</span> <a class="code" href="group__flash__exported__functions.html#gad4100201744f55e313d155d9f94dc1a1" title="Unlocks the program or data EEPROM memory.">FLASH_Unlock</a>(<a class="code" href="group__flash__exported__types.html#ga2a698e5fed2b9738cfce0ef44c109e58" title="FLASH Memory types.">FLASH_MemType_TypeDef</a> <a class="code" href="tags_8txt.html#acc4b570ade7920d0ab49105dd5d50219">FLASH_MemType</a>)
<a name="l00088"></a>00088 {
<a name="l00089"></a>00089   <span class="comment">/* Check parameter */</span>
<a name="l00090"></a>00090   <a class="code" href="stm8s__stdperiph__examples_2adc2_2adc2__continuousconversion_2stm8s__conf_8h.html#a631dea7b230e600555f979c62af1de21" title="The assert_param macro is used for function&#39;s parameters check.">assert_param</a>(<a class="code" href="group__flash__private__macros.html#gaae738a21b75a1af104e567a3918aaef9" title="Macro used by the assert function in order to check the different sensitivity values for the flash me...">IS_MEMORY_TYPE_OK</a>(FLASH_MemType));
<a name="l00091"></a>00091   
<a name="l00092"></a>00092   <span class="comment">/* Unlock program memory */</span>
<a name="l00093"></a>00093   <span class="keywordflow">if</span>(FLASH_MemType == <a class="code" href="group__flash__exported__types.html#gga2a698e5fed2b9738cfce0ef44c109e58a1c8f4134115522bc662131cf3d4a9009">FLASH_MEMTYPE_PROG</a>)
<a name="l00094"></a>00094   {
<a name="l00095"></a>00095     <a class="code" href="stm8s_8h.html#a844ea28ba1e0a5a0e497f16b61ea306b">FLASH</a>-&gt;PUKR = <a class="code" href="group__flash__exported__constants.html#ga44649d162768956694d3f2e743a825c2">FLASH_RASS_KEY1</a>;
<a name="l00096"></a>00096     <a class="code" href="stm8s_8h.html#a844ea28ba1e0a5a0e497f16b61ea306b">FLASH</a>-&gt;PUKR = <a class="code" href="group__flash__exported__constants.html#gabaa37e86a7fc002324cad016b987cb79">FLASH_RASS_KEY2</a>;
<a name="l00097"></a>00097   }
<a name="l00098"></a>00098   <span class="comment">/* Unlock data memory */</span>
<a name="l00099"></a>00099   <span class="keywordflow">else</span>
<a name="l00100"></a>00100   {
<a name="l00101"></a>00101     <a class="code" href="stm8s_8h.html#a844ea28ba1e0a5a0e497f16b61ea306b">FLASH</a>-&gt;DUKR = <a class="code" href="group__flash__exported__constants.html#gabaa37e86a7fc002324cad016b987cb79">FLASH_RASS_KEY2</a>; <span class="comment">/* Warning: keys are reversed on data memory !!! */</span>
<a name="l00102"></a>00102     <a class="code" href="stm8s_8h.html#a844ea28ba1e0a5a0e497f16b61ea306b">FLASH</a>-&gt;DUKR = <a class="code" href="group__flash__exported__constants.html#ga44649d162768956694d3f2e743a825c2">FLASH_RASS_KEY1</a>;
<a name="l00103"></a>00103   }
<a name="l00104"></a>00104 }
<a name="l00105"></a>00105 <span class="comment"></span>
<a name="l00106"></a>00106 <span class="comment">/**</span>
<a name="l00107"></a>00107 <span class="comment">  * @brief  Locks the program or data EEPROM memory</span>
<a name="l00108"></a>00108 <span class="comment">  * @param  FLASH_MemType : Memory type</span>
<a name="l00109"></a>00109 <span class="comment">  *         This parameter can be a value of @ref FLASH_MemType_TypeDef</span>
<a name="l00110"></a>00110 <span class="comment">  * @retval None</span>
<a name="l00111"></a>00111 <span class="comment">  */</span>
<a name="l00112"></a><a class="code" href="group__flash__public__functions.html#gad3bb74434cacca6fef20f9558089c404">00112</a> <span class="keywordtype">void</span> <a class="code" href="group__flash__exported__functions.html#gad3bb74434cacca6fef20f9558089c404" title="Locks the program or data EEPROM memory.">FLASH_Lock</a>(<a class="code" href="group__flash__exported__types.html#ga2a698e5fed2b9738cfce0ef44c109e58" title="FLASH Memory types.">FLASH_MemType_TypeDef</a> <a class="code" href="tags_8txt.html#acc4b570ade7920d0ab49105dd5d50219">FLASH_MemType</a>)
<a name="l00113"></a>00113 {
<a name="l00114"></a>00114   <span class="comment">/* Check parameter */</span>
<a name="l00115"></a>00115   <a class="code" href="stm8s__stdperiph__examples_2adc2_2adc2__continuousconversion_2stm8s__conf_8h.html#a631dea7b230e600555f979c62af1de21" title="The assert_param macro is used for function&#39;s parameters check.">assert_param</a>(<a class="code" href="group__flash__private__macros.html#gaae738a21b75a1af104e567a3918aaef9" title="Macro used by the assert function in order to check the different sensitivity values for the flash me...">IS_MEMORY_TYPE_OK</a>(FLASH_MemType));
<a name="l00116"></a>00116   
<a name="l00117"></a>00117   <span class="comment">/* Lock memory */</span>
<a name="l00118"></a>00118   <a class="code" href="stm8s_8h.html#a844ea28ba1e0a5a0e497f16b61ea306b">FLASH</a>-&gt;IAPSR &amp;= (<a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>)FLASH_MemType;
<a name="l00119"></a>00119 }
<a name="l00120"></a>00120 <span class="comment"></span>
<a name="l00121"></a>00121 <span class="comment">/**</span>
<a name="l00122"></a>00122 <span class="comment">  * @brief  DeInitializes the FLASH registers to their default reset values.</span>
<a name="l00123"></a>00123 <span class="comment">  * @param  None</span>
<a name="l00124"></a>00124 <span class="comment">  * @retval None</span>
<a name="l00125"></a>00125 <span class="comment">  */</span>
<a name="l00126"></a><a class="code" href="group__flash__public__functions.html#gae3207ac8af8b3bece7a6414d08258ea5">00126</a> <span class="keywordtype">void</span> <a class="code" href="group__flash__exported__functions.html#gae3207ac8af8b3bece7a6414d08258ea5" title="DeInitializes the FLASH registers to their default reset values.">FLASH_DeInit</a>(<span class="keywordtype">void</span>)
<a name="l00127"></a>00127 {
<a name="l00128"></a>00128   <a class="code" href="stm8s_8h.html#a844ea28ba1e0a5a0e497f16b61ea306b">FLASH</a>-&gt;CR1 = <a class="code" href="group__flash__registers__reset__value.html#gaa37f9020d4e03b3d6744aa8a34ae750c">FLASH_CR1_RESET_VALUE</a>;
<a name="l00129"></a>00129   <a class="code" href="stm8s_8h.html#a844ea28ba1e0a5a0e497f16b61ea306b">FLASH</a>-&gt;CR2 = <a class="code" href="group__flash__registers__reset__value.html#ga78f62fe704bedb583219c0ca5f26c2e2">FLASH_CR2_RESET_VALUE</a>;
<a name="l00130"></a>00130   <a class="code" href="stm8s_8h.html#a844ea28ba1e0a5a0e497f16b61ea306b">FLASH</a>-&gt;NCR2 = <a class="code" href="group__flash__registers__reset__value.html#ga157b511c81a19fd4196749a1402c09e1">FLASH_NCR2_RESET_VALUE</a>;
<a name="l00131"></a>00131   <a class="code" href="stm8s_8h.html#a844ea28ba1e0a5a0e497f16b61ea306b">FLASH</a>-&gt;IAPSR &amp;= (<a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>)(~<a class="code" href="group__flash__registers__bits__definition.html#ga36d7577be0e1226b732670e7a94d3752">FLASH_IAPSR_DUL</a>);
<a name="l00132"></a>00132   <a class="code" href="stm8s_8h.html#a844ea28ba1e0a5a0e497f16b61ea306b">FLASH</a>-&gt;IAPSR &amp;= (<a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>)(~<a class="code" href="group__flash__registers__bits__definition.html#ga5308b7bb2ce9565616d5b1c2a52d516d">FLASH_IAPSR_PUL</a>);
<a name="l00133"></a>00133   (void) <a class="code" href="stm8s_8h.html#a844ea28ba1e0a5a0e497f16b61ea306b">FLASH</a>-&gt;IAPSR; <span class="comment">/* Reading of this register causes the clearing of status flags */</span>
<a name="l00134"></a>00134 }
<a name="l00135"></a>00135 <span class="comment"></span>
<a name="l00136"></a>00136 <span class="comment">/**</span>
<a name="l00137"></a>00137 <span class="comment">  * @brief  Enables or Disables the Flash interrupt mode</span>
<a name="l00138"></a>00138 <span class="comment">  * @param  NewState : The new state of the flash interrupt mode</span>
<a name="l00139"></a>00139 <span class="comment">  *         This parameter can be a value of @ref FunctionalState enumeration.</span>
<a name="l00140"></a>00140 <span class="comment">  * @retval None</span>
<a name="l00141"></a>00141 <span class="comment">  */</span>
<a name="l00142"></a><a class="code" href="group__flash__public__functions.html#ga1cb6c783c327fdd5ce5e2bc5373440d2">00142</a> <span class="keywordtype">void</span> <a class="code" href="group__flash__exported__functions.html#ga1cb6c783c327fdd5ce5e2bc5373440d2" title="Enables or Disables the Flash interrupt mode.">FLASH_ITConfig</a>(<a class="code" href="group__exported__types.html#gac9a7e9a35d2513ec15c3b537aaa4fba1">FunctionalState</a> NewState)
<a name="l00143"></a>00143 {
<a name="l00144"></a>00144   <span class="comment">/* Check parameter */</span>
<a name="l00145"></a>00145   <a class="code" href="stm8s__stdperiph__examples_2adc2_2adc2__continuousconversion_2stm8s__conf_8h.html#a631dea7b230e600555f979c62af1de21" title="The assert_param macro is used for function&#39;s parameters check.">assert_param</a>(<a class="code" href="group__exported__types.html#gafda1b4aabfd993b1e9e0945008fe00a8">IS_FUNCTIONALSTATE_OK</a>(NewState));
<a name="l00146"></a>00146   
<a name="l00147"></a>00147   <span class="keywordflow">if</span>(NewState != <a class="code" href="group__exported__types.html#ggac9a7e9a35d2513ec15c3b537aaa4fba1ad3a9df141be0ccf10389b640f492b26d">DISABLE</a>)
<a name="l00148"></a>00148   {
<a name="l00149"></a>00149     <a class="code" href="stm8s_8h.html#a844ea28ba1e0a5a0e497f16b61ea306b">FLASH</a>-&gt;CR1 |= <a class="code" href="group__flash__registers__bits__definition.html#gaffc91d29fd8e0a7e7b738addf194b840">FLASH_CR1_IE</a>; <span class="comment">/* Enables the interrupt sources */</span>
<a name="l00150"></a>00150   }
<a name="l00151"></a>00151   <span class="keywordflow">else</span>
<a name="l00152"></a>00152   {
<a name="l00153"></a>00153     <a class="code" href="stm8s_8h.html#a844ea28ba1e0a5a0e497f16b61ea306b">FLASH</a>-&gt;CR1 &amp;= (<a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>)(~<a class="code" href="group__flash__registers__bits__definition.html#gaffc91d29fd8e0a7e7b738addf194b840">FLASH_CR1_IE</a>); <span class="comment">/* Disables the interrupt sources */</span>
<a name="l00154"></a>00154   }
<a name="l00155"></a>00155 }
<a name="l00156"></a>00156 <span class="comment"></span>
<a name="l00157"></a>00157 <span class="comment">/**</span>
<a name="l00158"></a>00158 <span class="comment">  * @brief  Erases one byte in the program or data EEPROM memory</span>
<a name="l00159"></a>00159 <span class="comment">  * @note   PointerAttr define is declared in the stm8s.h file to select if </span>
<a name="l00160"></a>00160 <span class="comment">  *         the pointer will be declared as near (2 bytes) or far (3 bytes).</span>
<a name="l00161"></a>00161 <span class="comment">  * @param  Address : Address of the byte to erase</span>
<a name="l00162"></a>00162 <span class="comment">  * @retval None</span>
<a name="l00163"></a>00163 <span class="comment">  */</span>
<a name="l00164"></a><a class="code" href="group__flash__public__functions.html#ga4e9867ea0696794beb029d98d69d189d">00164</a> <span class="keywordtype">void</span> <a class="code" href="group__flash__exported__functions.html#ga4e9867ea0696794beb029d98d69d189d" title="Erases one byte in the program or data EEPROM memory.">FLASH_EraseByte</a>(<a class="code" href="group__exported__types.html#ga06896e8c53f721507066c079052171f8">uint32_t</a> Address)
<a name="l00165"></a>00165 {
<a name="l00166"></a>00166   <span class="comment">/* Check parameter */</span>
<a name="l00167"></a>00167   <a class="code" href="stm8s__stdperiph__examples_2adc2_2adc2__continuousconversion_2stm8s__conf_8h.html#a631dea7b230e600555f979c62af1de21" title="The assert_param macro is used for function&#39;s parameters check.">assert_param</a>(<a class="code" href="group__flash__private__macros.html#gafd7cc03186bc7a4b1c285904a39fa3ff" title="Macro used by the assert function in order to check the different sensitivity values for the data eep...">IS_FLASH_ADDRESS_OK</a>(Address));
<a name="l00168"></a>00168   
<a name="l00169"></a>00169   <span class="comment">/* Erase byte */</span>
<a name="l00170"></a>00170   *(<a class="code" href="group__stm8s__stdperiph__driver.html#ga1e44c0b03b9a8fa8fca626d23bd66851">PointerAttr</a> <a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>*) (<a class="code" href="group__stm8s__stdperiph__driver.html#ga28ff3e784e008f7e7c75cd51df83920d">MemoryAddressCast</a>)Address = <a class="code" href="group__stm8s__stdperiph__driver.html#ga4ed67c8b1a35340c79c45e2a33929b78">FLASH_CLEAR_BYTE</a>; 
<a name="l00171"></a>00171 }
<a name="l00172"></a>00172 <span class="comment"></span>
<a name="l00173"></a>00173 <span class="comment">/**</span>
<a name="l00174"></a>00174 <span class="comment">  * @brief  Programs one byte in program or data EEPROM memory</span>
<a name="l00175"></a>00175 <span class="comment">  * @note   PointerAttr define is declared in the stm8s.h file to select if </span>
<a name="l00176"></a>00176 <span class="comment">  *         the pointer will be declared as near (2 bytes) or far (3 bytes).</span>
<a name="l00177"></a>00177 <span class="comment">  * @param  Address : Address where the byte will be programmed</span>
<a name="l00178"></a>00178 <span class="comment">  * @param  Data : Value to be programmed</span>
<a name="l00179"></a>00179 <span class="comment">  * @retval None</span>
<a name="l00180"></a>00180 <span class="comment">  */</span>
<a name="l00181"></a><a class="code" href="group__flash__public__functions.html#gad66e105baffe3d005485857a4325a983">00181</a> <span class="keywordtype">void</span> <a class="code" href="group__flash__exported__functions.html#gad66e105baffe3d005485857a4325a983" title="Programs one byte in program or data EEPROM memory.">FLASH_ProgramByte</a>(<a class="code" href="group__exported__types.html#ga06896e8c53f721507066c079052171f8">uint32_t</a> Address, <a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> Data)
<a name="l00182"></a>00182 {
<a name="l00183"></a>00183   <span class="comment">/* Check parameters */</span>
<a name="l00184"></a>00184   <a class="code" href="stm8s__stdperiph__examples_2adc2_2adc2__continuousconversion_2stm8s__conf_8h.html#a631dea7b230e600555f979c62af1de21" title="The assert_param macro is used for function&#39;s parameters check.">assert_param</a>(<a class="code" href="group__flash__private__macros.html#gafd7cc03186bc7a4b1c285904a39fa3ff" title="Macro used by the assert function in order to check the different sensitivity values for the data eep...">IS_FLASH_ADDRESS_OK</a>(Address));
<a name="l00185"></a>00185   *(<a class="code" href="group__stm8s__stdperiph__driver.html#ga1e44c0b03b9a8fa8fca626d23bd66851">PointerAttr</a> <a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>*) (<a class="code" href="group__stm8s__stdperiph__driver.html#ga28ff3e784e008f7e7c75cd51df83920d">MemoryAddressCast</a>)Address = Data;
<a name="l00186"></a>00186 }
<a name="l00187"></a>00187 <span class="comment"></span>
<a name="l00188"></a>00188 <span class="comment">/**</span>
<a name="l00189"></a>00189 <span class="comment">  * @brief  Reads any byte from flash memory</span>
<a name="l00190"></a>00190 <span class="comment">  * @note   PointerAttr define is declared in the stm8s.h file to select if </span>
<a name="l00191"></a>00191 <span class="comment">  *         the pointer will be declared as near (2 bytes) or far (3 bytes).</span>
<a name="l00192"></a>00192 <span class="comment">  * @param  Address : Address to read</span>
<a name="l00193"></a>00193 <span class="comment">  * @retval Value of the byte</span>
<a name="l00194"></a>00194 <span class="comment">  */</span>
<a name="l00195"></a><a class="code" href="group__flash__public__functions.html#ga4a1e1ba6b5de25726d7460e03dcf377e">00195</a> <a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> <a class="code" href="group__flash__exported__functions.html#ga4a1e1ba6b5de25726d7460e03dcf377e" title="Reads any byte from flash memory.">FLASH_ReadByte</a>(<a class="code" href="group__exported__types.html#ga06896e8c53f721507066c079052171f8">uint32_t</a> Address)
<a name="l00196"></a>00196 {
<a name="l00197"></a>00197   <span class="comment">/* Check parameter */</span>
<a name="l00198"></a>00198   <a class="code" href="stm8s__stdperiph__examples_2adc2_2adc2__continuousconversion_2stm8s__conf_8h.html#a631dea7b230e600555f979c62af1de21" title="The assert_param macro is used for function&#39;s parameters check.">assert_param</a>(<a class="code" href="group__flash__private__macros.html#gafd7cc03186bc7a4b1c285904a39fa3ff" title="Macro used by the assert function in order to check the different sensitivity values for the data eep...">IS_FLASH_ADDRESS_OK</a>(Address));
<a name="l00199"></a>00199   
<a name="l00200"></a>00200   <span class="comment">/* Read byte */</span>
<a name="l00201"></a>00201   <span class="keywordflow">return</span>(*(<a class="code" href="group__stm8s__stdperiph__driver.html#ga1e44c0b03b9a8fa8fca626d23bd66851">PointerAttr</a> <a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> *) (<a class="code" href="group__stm8s__stdperiph__driver.html#ga28ff3e784e008f7e7c75cd51df83920d">MemoryAddressCast</a>)Address); 
<a name="l00202"></a>00202 }
<a name="l00203"></a>00203 <span class="comment"></span>
<a name="l00204"></a>00204 <span class="comment">/**</span>
<a name="l00205"></a>00205 <span class="comment">  * @brief  Programs one word (4 bytes) in program or data EEPROM memory</span>
<a name="l00206"></a>00206 <span class="comment">  * @note   PointerAttr define is declared in the stm8s.h file to select if </span>
<a name="l00207"></a>00207 <span class="comment">  *         the pointer will be declared as near (2 bytes) or far (3 bytes).</span>
<a name="l00208"></a>00208 <span class="comment">  * @param  Address : The address where the data will be programmed</span>
<a name="l00209"></a>00209 <span class="comment">  * @param  Data : Value to be programmed</span>
<a name="l00210"></a>00210 <span class="comment">  * @retval None</span>
<a name="l00211"></a>00211 <span class="comment">  */</span>
<a name="l00212"></a><a class="code" href="group__flash__public__functions.html#ga51cf5c75a6d09c4959aa86c69b26cf79">00212</a> <span class="keywordtype">void</span> <a class="code" href="group__flash__exported__functions.html#ga51cf5c75a6d09c4959aa86c69b26cf79" title="Programs one word (4 bytes) in program or data EEPROM memory.">FLASH_ProgramWord</a>(<a class="code" href="group__exported__types.html#ga06896e8c53f721507066c079052171f8">uint32_t</a> Address, <a class="code" href="group__exported__types.html#ga06896e8c53f721507066c079052171f8">uint32_t</a> Data)
<a name="l00213"></a>00213 {
<a name="l00214"></a>00214   <span class="comment">/* Check parameters */</span>
<a name="l00215"></a>00215   <a class="code" href="stm8s__stdperiph__examples_2adc2_2adc2__continuousconversion_2stm8s__conf_8h.html#a631dea7b230e600555f979c62af1de21" title="The assert_param macro is used for function&#39;s parameters check.">assert_param</a>(<a class="code" href="group__flash__private__macros.html#gafd7cc03186bc7a4b1c285904a39fa3ff" title="Macro used by the assert function in order to check the different sensitivity values for the data eep...">IS_FLASH_ADDRESS_OK</a>(Address));
<a name="l00216"></a>00216   
<a name="l00217"></a>00217   <span class="comment">/* Enable Word Write Once */</span>
<a name="l00218"></a>00218   <a class="code" href="stm8s_8h.html#a844ea28ba1e0a5a0e497f16b61ea306b">FLASH</a>-&gt;CR2 |= <a class="code" href="group__flash__registers__bits__definition.html#gad6c0f3117c3a8b473387f1b6bd76d5e9">FLASH_CR2_WPRG</a>;
<a name="l00219"></a>00219   <a class="code" href="stm8s_8h.html#a844ea28ba1e0a5a0e497f16b61ea306b">FLASH</a>-&gt;NCR2 &amp;= (<a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>)(~<a class="code" href="group__flash__registers__bits__definition.html#ga40befef6db280e8726e8d560e8ecf90d">FLASH_NCR2_NWPRG</a>);
<a name="l00220"></a>00220   
<a name="l00221"></a>00221   <span class="comment">/* Write one byte - from lowest address*/</span>
<a name="l00222"></a>00222   *((<a class="code" href="group__stm8s__stdperiph__driver.html#ga1e44c0b03b9a8fa8fca626d23bd66851">PointerAttr</a> <a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>*)(<a class="code" href="group__stm8s__stdperiph__driver.html#ga28ff3e784e008f7e7c75cd51df83920d">MemoryAddressCast</a>)Address)       = *((<a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>*)(&amp;Data));
<a name="l00223"></a>00223   <span class="comment">/* Write one byte*/</span>
<a name="l00224"></a>00224   *(((<a class="code" href="group__stm8s__stdperiph__driver.html#ga1e44c0b03b9a8fa8fca626d23bd66851">PointerAttr</a> <a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>*)(<a class="code" href="group__stm8s__stdperiph__driver.html#ga28ff3e784e008f7e7c75cd51df83920d">MemoryAddressCast</a>)Address) + 1) = *((<a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>*)(&amp;Data)+1); 
<a name="l00225"></a>00225   <span class="comment">/* Write one byte*/</span>    
<a name="l00226"></a>00226   *(((<a class="code" href="group__stm8s__stdperiph__driver.html#ga1e44c0b03b9a8fa8fca626d23bd66851">PointerAttr</a> <a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>*)(<a class="code" href="group__stm8s__stdperiph__driver.html#ga28ff3e784e008f7e7c75cd51df83920d">MemoryAddressCast</a>)Address) + 2) = *((<a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>*)(&amp;Data)+2); 
<a name="l00227"></a>00227   <span class="comment">/* Write one byte - from higher address*/</span>
<a name="l00228"></a>00228   *(((<a class="code" href="group__stm8s__stdperiph__driver.html#ga1e44c0b03b9a8fa8fca626d23bd66851">PointerAttr</a> <a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>*)(<a class="code" href="group__stm8s__stdperiph__driver.html#ga28ff3e784e008f7e7c75cd51df83920d">MemoryAddressCast</a>)Address) + 3) = *((<a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>*)(&amp;Data)+3); 
<a name="l00229"></a>00229 }
<a name="l00230"></a>00230 <span class="comment"></span>
<a name="l00231"></a>00231 <span class="comment">/**</span>
<a name="l00232"></a>00232 <span class="comment">  * @brief  Programs option byte</span>
<a name="l00233"></a>00233 <span class="comment">  * @param  Address : option byte address to program</span>
<a name="l00234"></a>00234 <span class="comment">  * @param  Data : Value to write</span>
<a name="l00235"></a>00235 <span class="comment">  * @retval None</span>
<a name="l00236"></a>00236 <span class="comment">  */</span>
<a name="l00237"></a><a class="code" href="group__flash__public__functions.html#ga0605e2589b4e10801cceccb26682dd0f">00237</a> <span class="keywordtype">void</span> <a class="code" href="group__flash__exported__functions.html#ga0605e2589b4e10801cceccb26682dd0f" title="Programs option byte.">FLASH_ProgramOptionByte</a>(<a class="code" href="group__exported__types.html#ga273cf69d639a59973b6019625df33e30">uint16_t</a> Address, <a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> Data)
<a name="l00238"></a>00238 {
<a name="l00239"></a>00239   <span class="comment">/* Check parameter */</span>
<a name="l00240"></a>00240   <a class="code" href="stm8s__stdperiph__examples_2adc2_2adc2__continuousconversion_2stm8s__conf_8h.html#a631dea7b230e600555f979c62af1de21" title="The assert_param macro is used for function&#39;s parameters check.">assert_param</a>(<a class="code" href="group__flash__private__macros.html#ga619d7cdf487150e3498bf3e0c3af5ab5" title="Macro used by the assert function in order to check the different sensitivity values for the option b...">IS_OPTION_BYTE_ADDRESS_OK</a>(Address));
<a name="l00241"></a>00241   
<a name="l00242"></a>00242   <span class="comment">/* Enable write access to option bytes */</span>
<a name="l00243"></a>00243   <a class="code" href="stm8s_8h.html#a844ea28ba1e0a5a0e497f16b61ea306b">FLASH</a>-&gt;CR2 |= <a class="code" href="group__flash__registers__bits__definition.html#ga211240524e870d3854e538a06047d9db">FLASH_CR2_OPT</a>;
<a name="l00244"></a>00244   <a class="code" href="stm8s_8h.html#a844ea28ba1e0a5a0e497f16b61ea306b">FLASH</a>-&gt;NCR2 &amp;= (<a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>)(~<a class="code" href="group__flash__registers__bits__definition.html#ga5d8566e2427e4f997095afa6afec3f8e">FLASH_NCR2_NOPT</a>);
<a name="l00245"></a>00245   
<a name="l00246"></a>00246   <span class="comment">/* check if the option byte to program is ROP*/</span>
<a name="l00247"></a>00247   <span class="keywordflow">if</span>(Address == 0x4800)
<a name="l00248"></a>00248   {
<a name="l00249"></a>00249     <span class="comment">/* Program option byte*/</span>
<a name="l00250"></a>00250     *((<a class="code" href="group__stm8s__stdperiph__driver.html#ga8d0baede67fec569c56e8394694570b4">NEAR</a> <a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>*)Address) = Data;
<a name="l00251"></a>00251   }
<a name="l00252"></a>00252   <span class="keywordflow">else</span>
<a name="l00253"></a>00253   {
<a name="l00254"></a>00254     <span class="comment">/* Program option byte and his complement */</span>
<a name="l00255"></a>00255     *((<a class="code" href="group__stm8s__stdperiph__driver.html#ga8d0baede67fec569c56e8394694570b4">NEAR</a> <a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>*)Address) = Data;
<a name="l00256"></a>00256     *((<a class="code" href="group__stm8s__stdperiph__driver.html#ga8d0baede67fec569c56e8394694570b4">NEAR</a> <a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>*)((<a class="code" href="group__exported__types.html#ga273cf69d639a59973b6019625df33e30">uint16_t</a>)(Address + 1))) = (<a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>)(~Data);
<a name="l00257"></a>00257   }
<a name="l00258"></a>00258   FLASH_WaitForLastOperation(<a class="code" href="group__flash__exported__types.html#gga2a698e5fed2b9738cfce0ef44c109e58a1c8f4134115522bc662131cf3d4a9009">FLASH_MEMTYPE_PROG</a>);
<a name="l00259"></a>00259   
<a name="l00260"></a>00260   <span class="comment">/* Disable write access to option bytes */</span>
<a name="l00261"></a>00261   <a class="code" href="stm8s_8h.html#a844ea28ba1e0a5a0e497f16b61ea306b">FLASH</a>-&gt;CR2 &amp;= (<a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>)(~<a class="code" href="group__flash__registers__bits__definition.html#ga211240524e870d3854e538a06047d9db">FLASH_CR2_OPT</a>);
<a name="l00262"></a>00262   <a class="code" href="stm8s_8h.html#a844ea28ba1e0a5a0e497f16b61ea306b">FLASH</a>-&gt;NCR2 |= <a class="code" href="group__flash__registers__bits__definition.html#ga5d8566e2427e4f997095afa6afec3f8e">FLASH_NCR2_NOPT</a>;
<a name="l00263"></a>00263 }
<a name="l00264"></a>00264 <span class="comment"></span>
<a name="l00265"></a>00265 <span class="comment">/**</span>
<a name="l00266"></a>00266 <span class="comment">  * @brief  Erases option byte</span>
<a name="l00267"></a>00267 <span class="comment">  * @param  Address : Option byte address to erase</span>
<a name="l00268"></a>00268 <span class="comment">  * @retval None</span>
<a name="l00269"></a>00269 <span class="comment">  */</span>
<a name="l00270"></a><a class="code" href="group__flash__public__functions.html#ga534f25a4645a0a408f1f867aa38a723f">00270</a> <span class="keywordtype">void</span> <a class="code" href="group__flash__exported__functions.html#ga534f25a4645a0a408f1f867aa38a723f" title="Erases option byte.">FLASH_EraseOptionByte</a>(<a class="code" href="group__exported__types.html#ga273cf69d639a59973b6019625df33e30">uint16_t</a> Address)
<a name="l00271"></a>00271 {
<a name="l00272"></a>00272   <span class="comment">/* Check parameter */</span>
<a name="l00273"></a>00273   <a class="code" href="stm8s__stdperiph__examples_2adc2_2adc2__continuousconversion_2stm8s__conf_8h.html#a631dea7b230e600555f979c62af1de21" title="The assert_param macro is used for function&#39;s parameters check.">assert_param</a>(<a class="code" href="group__flash__private__macros.html#ga619d7cdf487150e3498bf3e0c3af5ab5" title="Macro used by the assert function in order to check the different sensitivity values for the option b...">IS_OPTION_BYTE_ADDRESS_OK</a>(Address));
<a name="l00274"></a>00274   
<a name="l00275"></a>00275   <span class="comment">/* Enable write access to option bytes */</span>
<a name="l00276"></a>00276   <a class="code" href="stm8s_8h.html#a844ea28ba1e0a5a0e497f16b61ea306b">FLASH</a>-&gt;CR2 |= <a class="code" href="group__flash__registers__bits__definition.html#ga211240524e870d3854e538a06047d9db">FLASH_CR2_OPT</a>;
<a name="l00277"></a>00277   <a class="code" href="stm8s_8h.html#a844ea28ba1e0a5a0e497f16b61ea306b">FLASH</a>-&gt;NCR2 &amp;= (<a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>)(~<a class="code" href="group__flash__registers__bits__definition.html#ga5d8566e2427e4f997095afa6afec3f8e">FLASH_NCR2_NOPT</a>);
<a name="l00278"></a>00278   
<a name="l00279"></a>00279   <span class="comment">/* check if the option byte to erase is ROP */</span>
<a name="l00280"></a>00280   <span class="keywordflow">if</span>(Address == 0x4800)
<a name="l00281"></a>00281   {
<a name="l00282"></a>00282     <span class="comment">/* Erase option byte */</span>
<a name="l00283"></a>00283     *((<a class="code" href="group__stm8s__stdperiph__driver.html#ga8d0baede67fec569c56e8394694570b4">NEAR</a> <a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>*)Address) = <a class="code" href="group__stm8s__stdperiph__driver.html#ga4ed67c8b1a35340c79c45e2a33929b78">FLASH_CLEAR_BYTE</a>;
<a name="l00284"></a>00284   }
<a name="l00285"></a>00285   <span class="keywordflow">else</span>
<a name="l00286"></a>00286   {
<a name="l00287"></a>00287     <span class="comment">/* Erase option byte and his complement */</span>
<a name="l00288"></a>00288     *((<a class="code" href="group__stm8s__stdperiph__driver.html#ga8d0baede67fec569c56e8394694570b4">NEAR</a> <a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>*)Address) = <a class="code" href="group__stm8s__stdperiph__driver.html#ga4ed67c8b1a35340c79c45e2a33929b78">FLASH_CLEAR_BYTE</a>;
<a name="l00289"></a>00289     *((<a class="code" href="group__stm8s__stdperiph__driver.html#ga8d0baede67fec569c56e8394694570b4">NEAR</a> <a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>*)((<a class="code" href="group__exported__types.html#ga273cf69d639a59973b6019625df33e30">uint16_t</a>)(Address + (<a class="code" href="group__exported__types.html#ga273cf69d639a59973b6019625df33e30">uint16_t</a>)1 ))) = <a class="code" href="group__stm8s__stdperiph__driver.html#ga3fdab1bd900807c8a27910521c89ba3b">FLASH_SET_BYTE</a>;
<a name="l00290"></a>00290   }
<a name="l00291"></a>00291   FLASH_WaitForLastOperation(<a class="code" href="group__flash__exported__types.html#gga2a698e5fed2b9738cfce0ef44c109e58a1c8f4134115522bc662131cf3d4a9009">FLASH_MEMTYPE_PROG</a>);
<a name="l00292"></a>00292   
<a name="l00293"></a>00293   <span class="comment">/* Disable write access to option bytes */</span>
<a name="l00294"></a>00294   <a class="code" href="stm8s_8h.html#a844ea28ba1e0a5a0e497f16b61ea306b">FLASH</a>-&gt;CR2 &amp;= (<a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>)(~<a class="code" href="group__flash__registers__bits__definition.html#ga211240524e870d3854e538a06047d9db">FLASH_CR2_OPT</a>);
<a name="l00295"></a>00295   <a class="code" href="stm8s_8h.html#a844ea28ba1e0a5a0e497f16b61ea306b">FLASH</a>-&gt;NCR2 |= <a class="code" href="group__flash__registers__bits__definition.html#ga5d8566e2427e4f997095afa6afec3f8e">FLASH_NCR2_NOPT</a>;
<a name="l00296"></a>00296 }
<a name="l00297"></a>00297 <span class="comment"></span>
<a name="l00298"></a>00298 <span class="comment">/**</span>
<a name="l00299"></a>00299 <span class="comment">  * @brief  Reads one option byte</span>
<a name="l00300"></a>00300 <span class="comment">  * @param  Address  option byte address to read.</span>
<a name="l00301"></a>00301 <span class="comment">  * @retval Option byte read value + its complement</span>
<a name="l00302"></a>00302 <span class="comment">  */</span>
<a name="l00303"></a><a class="code" href="group__flash__public__functions.html#ga3abe95d8fe80365a999c9c545bdfe367">00303</a> <a class="code" href="group__exported__types.html#ga273cf69d639a59973b6019625df33e30">uint16_t</a> <a class="code" href="group__flash__exported__functions.html#ga3abe95d8fe80365a999c9c545bdfe367" title="Reads one option byte.">FLASH_ReadOptionByte</a>(<a class="code" href="group__exported__types.html#ga273cf69d639a59973b6019625df33e30">uint16_t</a> Address)
<a name="l00304"></a>00304 {
<a name="l00305"></a>00305   <a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> value_optbyte, value_optbyte_complement = 0;
<a name="l00306"></a>00306   <a class="code" href="group__exported__types.html#ga273cf69d639a59973b6019625df33e30">uint16_t</a> res_value = 0;
<a name="l00307"></a>00307   
<a name="l00308"></a>00308   <span class="comment">/* Check parameter */</span>
<a name="l00309"></a>00309   <a class="code" href="stm8s__stdperiph__examples_2adc2_2adc2__continuousconversion_2stm8s__conf_8h.html#a631dea7b230e600555f979c62af1de21" title="The assert_param macro is used for function&#39;s parameters check.">assert_param</a>(<a class="code" href="group__flash__private__macros.html#ga619d7cdf487150e3498bf3e0c3af5ab5" title="Macro used by the assert function in order to check the different sensitivity values for the option b...">IS_OPTION_BYTE_ADDRESS_OK</a>(Address));
<a name="l00310"></a>00310     
<a name="l00311"></a>00311   value_optbyte = *((<a class="code" href="group__stm8s__stdperiph__driver.html#ga8d0baede67fec569c56e8394694570b4">NEAR</a> <a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>*)Address); <span class="comment">/* Read option byte */</span>
<a name="l00312"></a>00312   value_optbyte_complement = *(((<a class="code" href="group__stm8s__stdperiph__driver.html#ga8d0baede67fec569c56e8394694570b4">NEAR</a> <a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>*)Address) + 1); <span class="comment">/* Read option byte complement */</span>
<a name="l00313"></a>00313   
<a name="l00314"></a>00314   <span class="comment">/* Read-out protection option byte */</span>
<a name="l00315"></a>00315   <span class="keywordflow">if</span>(Address == 0x4800)  
<a name="l00316"></a>00316   {
<a name="l00317"></a>00317     res_value =  value_optbyte;
<a name="l00318"></a>00318   }
<a name="l00319"></a>00319   <span class="keywordflow">else</span>
<a name="l00320"></a>00320   {
<a name="l00321"></a>00321     <span class="keywordflow">if</span>(value_optbyte == (<a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>)(~value_optbyte_complement))
<a name="l00322"></a>00322     {
<a name="l00323"></a>00323       res_value = (<a class="code" href="group__exported__types.html#ga273cf69d639a59973b6019625df33e30">uint16_t</a>)((<a class="code" href="group__exported__types.html#ga273cf69d639a59973b6019625df33e30">uint16_t</a>)value_optbyte &lt;&lt; 8);
<a name="l00324"></a>00324       res_value = res_value | (<a class="code" href="group__exported__types.html#ga273cf69d639a59973b6019625df33e30">uint16_t</a>)value_optbyte_complement;
<a name="l00325"></a>00325     }
<a name="l00326"></a>00326     <span class="keywordflow">else</span>
<a name="l00327"></a>00327     {
<a name="l00328"></a>00328       res_value = <a class="code" href="group__flash__exported__constants.html#gaa6bcacd968e7186198663ccba5f496e3">FLASH_OPTIONBYTE_ERROR</a>;
<a name="l00329"></a>00329     }
<a name="l00330"></a>00330   }
<a name="l00331"></a>00331   <span class="keywordflow">return</span>(res_value);
<a name="l00332"></a>00332 }
<a name="l00333"></a>00333 <span class="comment"></span>
<a name="l00334"></a>00334 <span class="comment">/**</span>
<a name="l00335"></a>00335 <span class="comment">  * @brief  Select the Flash behaviour in low power mode</span>
<a name="l00336"></a>00336 <span class="comment">  * @param  FLASH_LPMode Low power mode selection</span>
<a name="l00337"></a>00337 <span class="comment">  *         This parameter can be any of the @ref FLASH_LPMode_TypeDef values.</span>
<a name="l00338"></a>00338 <span class="comment">  * @retval None</span>
<a name="l00339"></a>00339 <span class="comment">  */</span>
<a name="l00340"></a><a class="code" href="group__flash__public__functions.html#gaed7ac730ca16a66132df5483925781f4">00340</a> <span class="keywordtype">void</span> <a class="code" href="group__flash__exported__functions.html#gaed7ac730ca16a66132df5483925781f4" title="Select the Flash behaviour in low power mode.">FLASH_SetLowPowerMode</a>(<a class="code" href="group__flash__exported__types.html#ga5842482b60c5a4a1bc16a77525a0c2c3" title="FLASH Low Power mode select.">FLASH_LPMode_TypeDef</a> FLASH_LPMode)
<a name="l00341"></a>00341 {
<a name="l00342"></a>00342   <span class="comment">/* Check parameter */</span>
<a name="l00343"></a>00343   <a class="code" href="stm8s__stdperiph__examples_2adc2_2adc2__continuousconversion_2stm8s__conf_8h.html#a631dea7b230e600555f979c62af1de21" title="The assert_param macro is used for function&#39;s parameters check.">assert_param</a>(<a class="code" href="group__flash__private__macros.html#ga9109a13d96a4c0099490a243f32bfd8e" title="Macro used by the assert function in order to check the different sensitivity values for the low powe...">IS_FLASH_LOW_POWER_MODE_OK</a>(FLASH_LPMode));
<a name="l00344"></a>00344   
<a name="l00345"></a>00345   <span class="comment">/* Clears the two bits */</span>
<a name="l00346"></a>00346   <a class="code" href="stm8s_8h.html#a844ea28ba1e0a5a0e497f16b61ea306b">FLASH</a>-&gt;CR1 &amp;= (<a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>)(~(<a class="code" href="group__flash__registers__bits__definition.html#ga6be8602a798fbe6865d0570cdb34e7ab">FLASH_CR1_HALT</a> | <a class="code" href="group__flash__registers__bits__definition.html#ga83d7dc756287426807fd1af18894b16c">FLASH_CR1_AHALT</a>)); 
<a name="l00347"></a>00347   
<a name="l00348"></a>00348   <span class="comment">/* Sets the new mode */</span>
<a name="l00349"></a>00349   <a class="code" href="stm8s_8h.html#a844ea28ba1e0a5a0e497f16b61ea306b">FLASH</a>-&gt;CR1 |= (<a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>)FLASH_LPMode; 
<a name="l00350"></a>00350 }
<a name="l00351"></a>00351 <span class="comment"></span>
<a name="l00352"></a>00352 <span class="comment">/**</span>
<a name="l00353"></a>00353 <span class="comment">  * @brief  Sets the fixed programming time</span>
<a name="l00354"></a>00354 <span class="comment">  * @param  FLASH_ProgTime Indicates the programming time to be fixed</span>
<a name="l00355"></a>00355 <span class="comment">  *         This parameter can be any of the @ref FLASH_ProgramTime_TypeDef values.</span>
<a name="l00356"></a>00356 <span class="comment">  * @retval None</span>
<a name="l00357"></a>00357 <span class="comment">  */</span>
<a name="l00358"></a><a class="code" href="group__flash__public__functions.html#ga86c8df9d158f998c6afeef80a0542ce3">00358</a> <span class="keywordtype">void</span> <a class="code" href="group__flash__exported__functions.html#ga86c8df9d158f998c6afeef80a0542ce3" title="Sets the fixed programming time.">FLASH_SetProgrammingTime</a>(<a class="code" href="group__flash__exported__types.html#ga8ad12cc2599e8e65218df92e0804b296" title="FLASH fixed programming time.">FLASH_ProgramTime_TypeDef</a> FLASH_ProgTime)
<a name="l00359"></a>00359 {
<a name="l00360"></a>00360   <span class="comment">/* Check parameter */</span>
<a name="l00361"></a>00361   <a class="code" href="stm8s__stdperiph__examples_2adc2_2adc2__continuousconversion_2stm8s__conf_8h.html#a631dea7b230e600555f979c62af1de21" title="The assert_param macro is used for function&#39;s parameters check.">assert_param</a>(<a class="code" href="group__flash__private__macros.html#gaf2aa0254e89f64478fc056224d86fb9c" title="Macro used by the assert function in order to check the program time mode.">IS_FLASH_PROGRAM_TIME_OK</a>(FLASH_ProgTime));
<a name="l00362"></a>00362   
<a name="l00363"></a>00363   <a class="code" href="stm8s_8h.html#a844ea28ba1e0a5a0e497f16b61ea306b">FLASH</a>-&gt;CR1 &amp;= (<a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>)(~<a class="code" href="group__flash__registers__bits__definition.html#ga776a20d840106286345d3960b067776b">FLASH_CR1_FIX</a>);
<a name="l00364"></a>00364   <a class="code" href="stm8s_8h.html#a844ea28ba1e0a5a0e497f16b61ea306b">FLASH</a>-&gt;CR1 |= (<a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>)FLASH_ProgTime;
<a name="l00365"></a>00365 }
<a name="l00366"></a>00366 <span class="comment"></span>
<a name="l00367"></a>00367 <span class="comment">/**</span>
<a name="l00368"></a>00368 <span class="comment">  * @brief  Returns the Flash behaviour type in low power mode</span>
<a name="l00369"></a>00369 <span class="comment">  * @param  None</span>
<a name="l00370"></a>00370 <span class="comment">  * @retval FLASH_LPMode_TypeDef Flash behaviour type in low power mode</span>
<a name="l00371"></a>00371 <span class="comment">  */</span>
<a name="l00372"></a><a class="code" href="group__flash__public__functions.html#ga1637ab931d5c480e0b26fb7cfe8a277d">00372</a> <a class="code" href="group__flash__exported__types.html#ga5842482b60c5a4a1bc16a77525a0c2c3" title="FLASH Low Power mode select.">FLASH_LPMode_TypeDef</a> <a class="code" href="group__flash__exported__functions.html#ga1637ab931d5c480e0b26fb7cfe8a277d" title="Returns the Flash behaviour type in low power mode.">FLASH_GetLowPowerMode</a>(<span class="keywordtype">void</span>)
<a name="l00373"></a>00373 {
<a name="l00374"></a>00374   <span class="keywordflow">return</span>((<a class="code" href="group__flash__exported__types.html#ga5842482b60c5a4a1bc16a77525a0c2c3" title="FLASH Low Power mode select.">FLASH_LPMode_TypeDef</a>)(<a class="code" href="stm8s_8h.html#a844ea28ba1e0a5a0e497f16b61ea306b">FLASH</a>-&gt;CR1 &amp; (<a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>)(<a class="code" href="group__flash__registers__bits__definition.html#ga6be8602a798fbe6865d0570cdb34e7ab">FLASH_CR1_HALT</a> | <a class="code" href="group__flash__registers__bits__definition.html#ga83d7dc756287426807fd1af18894b16c">FLASH_CR1_AHALT</a>)));
<a name="l00375"></a>00375 }
<a name="l00376"></a>00376 <span class="comment"></span>
<a name="l00377"></a>00377 <span class="comment">/**</span>
<a name="l00378"></a>00378 <span class="comment">  * @brief  Returns the fixed programming time</span>
<a name="l00379"></a>00379 <span class="comment">  * @param  None</span>
<a name="l00380"></a>00380 <span class="comment">  * @retval FLASH_ProgramTime_TypeDef Fixed programming time value</span>
<a name="l00381"></a>00381 <span class="comment">  */</span>
<a name="l00382"></a><a class="code" href="group__flash__public__functions.html#ga05e755247174e5f2c7a46e6521050533">00382</a> <a class="code" href="group__flash__exported__types.html#ga8ad12cc2599e8e65218df92e0804b296" title="FLASH fixed programming time.">FLASH_ProgramTime_TypeDef</a> <a class="code" href="group__flash__exported__functions.html#ga05e755247174e5f2c7a46e6521050533" title="Returns the fixed programming time.">FLASH_GetProgrammingTime</a>(<span class="keywordtype">void</span>)
<a name="l00383"></a>00383 {
<a name="l00384"></a>00384   <span class="keywordflow">return</span>((<a class="code" href="group__flash__exported__types.html#ga8ad12cc2599e8e65218df92e0804b296" title="FLASH fixed programming time.">FLASH_ProgramTime_TypeDef</a>)(<a class="code" href="stm8s_8h.html#a844ea28ba1e0a5a0e497f16b61ea306b">FLASH</a>-&gt;CR1 &amp; <a class="code" href="group__flash__registers__bits__definition.html#ga776a20d840106286345d3960b067776b">FLASH_CR1_FIX</a>));
<a name="l00385"></a>00385 }
<a name="l00386"></a>00386 <span class="comment"></span>
<a name="l00387"></a>00387 <span class="comment">/**</span>
<a name="l00388"></a>00388 <span class="comment">  * @brief  Returns the Boot memory size in bytes</span>
<a name="l00389"></a>00389 <span class="comment">  * @param  None</span>
<a name="l00390"></a>00390 <span class="comment">  * @retval Boot memory size in bytes</span>
<a name="l00391"></a>00391 <span class="comment">  */</span>
<a name="l00392"></a><a class="code" href="group__flash__public__functions.html#ga89be89293308a5cf6fb77561a9ccbfb9">00392</a> <a class="code" href="group__exported__types.html#ga06896e8c53f721507066c079052171f8">uint32_t</a> <a class="code" href="group__flash__exported__functions.html#ga89be89293308a5cf6fb77561a9ccbfb9" title="Returns the Boot memory size in bytes.">FLASH_GetBootSize</a>(<span class="keywordtype">void</span>)
<a name="l00393"></a>00393 {
<a name="l00394"></a>00394   <a class="code" href="group__exported__types.html#ga06896e8c53f721507066c079052171f8">uint32_t</a> temp = 0;
<a name="l00395"></a>00395   
<a name="l00396"></a>00396   <span class="comment">/* Calculates the number of bytes */</span>
<a name="l00397"></a>00397   temp = (<a class="code" href="group__exported__types.html#ga06896e8c53f721507066c079052171f8">uint32_t</a>)((<a class="code" href="group__exported__types.html#ga06896e8c53f721507066c079052171f8">uint32_t</a>)<a class="code" href="stm8s_8h.html#a844ea28ba1e0a5a0e497f16b61ea306b">FLASH</a>-&gt;FPR * (<a class="code" href="group__exported__types.html#ga06896e8c53f721507066c079052171f8">uint32_t</a>)512);
<a name="l00398"></a>00398   
<a name="l00399"></a>00399   <span class="comment">/* Correction because size of 127.5 kb doesn&#39;t exist */</span>
<a name="l00400"></a>00400   <span class="keywordflow">if</span>(<a class="code" href="stm8s_8h.html#a844ea28ba1e0a5a0e497f16b61ea306b">FLASH</a>-&gt;FPR == 0xFF)
<a name="l00401"></a>00401   {
<a name="l00402"></a>00402     temp += 512;
<a name="l00403"></a>00403   }
<a name="l00404"></a>00404   
<a name="l00405"></a>00405   <span class="comment">/* Return value */</span>
<a name="l00406"></a>00406   <span class="keywordflow">return</span>(temp);
<a name="l00407"></a>00407 }
<a name="l00408"></a>00408 <span class="comment"></span>
<a name="l00409"></a>00409 <span class="comment">/**</span>
<a name="l00410"></a>00410 <span class="comment">  * @brief  Checks whether the specified SPI flag is set or not.</span>
<a name="l00411"></a>00411 <span class="comment">  * @param  FLASH_FLAG : Specifies the flag to check.</span>
<a name="l00412"></a>00412 <span class="comment">  *         This parameter can be any of the @ref FLASH_Flag_TypeDef enumeration.</span>
<a name="l00413"></a>00413 <span class="comment">  * @retval FlagStatus : Indicates the state of FLASH_FLAG.</span>
<a name="l00414"></a>00414 <span class="comment">  *         This parameter can be any of the @ref FlagStatus enumeration.</span>
<a name="l00415"></a>00415 <span class="comment">  * @note   This function can clear the EOP, WR_PG_DIS flags in the IAPSR register.</span>
<a name="l00416"></a>00416 <span class="comment">  */</span>
<a name="l00417"></a><a class="code" href="group__flash__public__functions.html#ga9a077b655d41b8c8058d1d91b5b4d17f">00417</a> <a class="code" href="group__exported__types.html#ga89136caac2e14c55151f527ac02daaff">FlagStatus</a> <a class="code" href="group__flash__exported__functions.html#ga9a077b655d41b8c8058d1d91b5b4d17f" title="Checks whether the specified SPI flag is set or not.">FLASH_GetFlagStatus</a>(<a class="code" href="group__flash__exported__types.html#ga745b516d2ac4f41bb683c72c40cf06bb" title="FLASH flags definition.">FLASH_Flag_TypeDef</a> FLASH_FLAG)
<a name="l00418"></a>00418 {
<a name="l00419"></a>00419   <a class="code" href="group__exported__types.html#ga89136caac2e14c55151f527ac02daaff">FlagStatus</a> status = <a class="code" href="group__exported__types.html#gga89136caac2e14c55151f527ac02daaffa589b7d94a3d91d145720e2fed0eb3a05">RESET</a>;
<a name="l00420"></a>00420   <span class="comment">/* Check parameters */</span>
<a name="l00421"></a>00421   <a class="code" href="stm8s__stdperiph__examples_2adc2_2adc2__continuousconversion_2stm8s__conf_8h.html#a631dea7b230e600555f979c62af1de21" title="The assert_param macro is used for function&#39;s parameters check.">assert_param</a>(<a class="code" href="group__flash__private__macros.html#ga53450091bf65078c079f6f5f407cc9d2" title="Macro used by the assert function in order to check the different flags values.">IS_FLASH_FLAGS_OK</a>(FLASH_FLAG));
<a name="l00422"></a>00422   
<a name="l00423"></a>00423   <span class="comment">/* Check the status of the specified FLASH flag */</span>
<a name="l00424"></a>00424   <span class="keywordflow">if</span>((<a class="code" href="stm8s_8h.html#a844ea28ba1e0a5a0e497f16b61ea306b">FLASH</a>-&gt;IAPSR &amp; (<a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>)FLASH_FLAG) != (<a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>)<a class="code" href="group__exported__types.html#gga89136caac2e14c55151f527ac02daaffa589b7d94a3d91d145720e2fed0eb3a05">RESET</a>)
<a name="l00425"></a>00425   {
<a name="l00426"></a>00426     status = <a class="code" href="group__exported__types.html#gga89136caac2e14c55151f527ac02daaffab44c8101cc294c074709ec1b14211792">SET</a>; <span class="comment">/* FLASH_FLAG is set */</span>
<a name="l00427"></a>00427   }
<a name="l00428"></a>00428   <span class="keywordflow">else</span>
<a name="l00429"></a>00429   {
<a name="l00430"></a>00430     status = <a class="code" href="group__exported__types.html#gga89136caac2e14c55151f527ac02daaffa589b7d94a3d91d145720e2fed0eb3a05">RESET</a>; <span class="comment">/* FLASH_FLAG is reset*/</span>
<a name="l00431"></a>00431   }
<a name="l00432"></a>00432   
<a name="l00433"></a>00433   <span class="comment">/* Return the FLASH_FLAG status */</span>
<a name="l00434"></a>00434   <span class="keywordflow">return</span> status;
<a name="l00435"></a>00435 }
<a name="l00436"></a>00436 <span class="comment"></span>
<a name="l00437"></a>00437 <span class="comment">/**</span>
<a name="l00438"></a>00438 <span class="comment">@code</span>
<a name="l00439"></a>00439 <span class="comment"> All the functions defined below must be executed from RAM exclusively, except</span>
<a name="l00440"></a>00440 <span class="comment"> for the FLASH_WaitForLastOperation function which can be executed from Flash.</span>
<a name="l00441"></a>00441 <span class="comment"></span>
<a name="l00442"></a>00442 <span class="comment"> Steps of the execution from RAM differs from one toolchain to another:</span>
<a name="l00443"></a>00443 <span class="comment"> - For Cosmic Compiler:</span>
<a name="l00444"></a>00444 <span class="comment">    1- Define a segment FLASH_CODE by the mean of &quot; #pragma section (FLASH_CODE)&quot;.</span>
<a name="l00445"></a>00445 <span class="comment">    This segment is defined in the stm8s_flash.c file.</span>
<a name="l00446"></a>00446 <span class="comment">  2- Uncomment the &quot;#define RAM_EXECUTION  (1)&quot; line in the stm8s.h file,</span>
<a name="l00447"></a>00447 <span class="comment">    or define it in Cosmic compiler preprocessor to enable the FLASH_CODE segment</span>
<a name="l00448"></a>00448 <span class="comment">   definition.</span>
<a name="l00449"></a>00449 <span class="comment">  3- In STVD Select Project\Settings\Linker\Category &quot;input&quot; and in the RAM section</span>
<a name="l00450"></a>00450 <span class="comment">    add the FLASH_CODE segment with &quot;-ic&quot; options.</span>
<a name="l00451"></a>00451 <span class="comment">  4- In main.c file call the _fctcpy() function with first segment character as </span>
<a name="l00452"></a>00452 <span class="comment">    parameter &quot;_fctcpy(&#39;F&#39;);&quot; to load the declared moveable code segment</span>
<a name="l00453"></a>00453 <span class="comment">    (FLASH_CODE) in RAM before execution.</span>
<a name="l00454"></a>00454 <span class="comment">  5- By default the _fctcpy function is packaged in the Cosmic machine library,</span>
<a name="l00455"></a>00455 <span class="comment">    so the function prototype &quot;int _fctcopy(char name);&quot; must be added in main.c</span>
<a name="l00456"></a>00456 <span class="comment">    file.</span>
<a name="l00457"></a>00457 <span class="comment"></span>
<a name="l00458"></a>00458 <span class="comment">  - For Raisonance Compiler</span>
<a name="l00459"></a>00459 <span class="comment">   1- Use the inram keyword in the function declaration to specify that it can be</span>
<a name="l00460"></a>00460 <span class="comment">    executed from RAM.</span>
<a name="l00461"></a>00461 <span class="comment">    This is done within the stm8s_flash.c file, and it&#39;s conditioned by </span>
<a name="l00462"></a>00462 <span class="comment">    RAM_EXECUTION definition.</span>
<a name="l00463"></a>00463 <span class="comment">   2- Uncomment the &quot;#define RAM_EXECUTION  (1)&quot; line in the stm8s.h file, or </span>
<a name="l00464"></a>00464 <span class="comment">   define it in Raisonance compiler preprocessor to enable the access for the </span>
<a name="l00465"></a>00465 <span class="comment">   inram functions.</span>
<a name="l00466"></a>00466 <span class="comment">   3- An inram function code is copied from Flash to RAM by the C startup code. </span>
<a name="l00467"></a>00467 <span class="comment">   In some applications, the RAM area where the code was initially stored may be</span>
<a name="l00468"></a>00468 <span class="comment">   erased or corrupted, so it may be desirable to perform the copy again. </span>
<a name="l00469"></a>00469 <span class="comment">   Depending on the application memory model, the memcpy() or fmemcpy() functions</span>
<a name="l00470"></a>00470 <span class="comment">   should be used to perform the copy.</span>
<a name="l00471"></a>00471 <span class="comment">       In case your project uses the SMALL memory model (code smaller than 64K),</span>
<a name="l00472"></a>00472 <span class="comment">       memcpy()function is recommended to perform the copy</span>
<a name="l00473"></a>00473 <span class="comment">       In case your project uses the LARGE memory model, functions can be </span>
<a name="l00474"></a>00474 <span class="comment">      everywhere in the 24-bits address space (not limited to the first 64KB of</span>
<a name="l00475"></a>00475 <span class="comment">      code), In this case, the use of memcpy() function will not be appropriate,</span>
<a name="l00476"></a>00476 <span class="comment">      you need to use the specific fmemcpy() function (which copies objects with</span>
<a name="l00477"></a>00477 <span class="comment">      24-bit addresses).</span>
<a name="l00478"></a>00478 <span class="comment">      - The linker automatically defines 2 symbols for each inram function:</span>
<a name="l00479"></a>00479 <span class="comment">            __address__functionname is a symbol that holds the Flash address </span>
<a name="l00480"></a>00480 <span class="comment">           where the given function code is stored.</span>
<a name="l00481"></a>00481 <span class="comment">            __size__functionname is a symbol that holds the function size in bytes.</span>
<a name="l00482"></a>00482 <span class="comment">     And we already have the function address (which is itself a pointer)</span>
<a name="l00483"></a>00483 <span class="comment">  4- In main.c file these two steps should be performed for each inram function:</span>
<a name="l00484"></a>00484 <span class="comment">      Import the &quot;__address__functionname&quot; and &quot;__size__functionname&quot; symbols</span>
<a name="l00485"></a>00485 <span class="comment">       as global variables:</span>
<a name="l00486"></a>00486 <span class="comment">         extern int __address__functionname; // Symbol holding the flash address</span>
<a name="l00487"></a>00487 <span class="comment">         extern int __size__functionname;    // Symbol holding the function size</span>
<a name="l00488"></a>00488 <span class="comment">      In case of SMALL memory model use, Call the memcpy() function to copy the</span>
<a name="l00489"></a>00489 <span class="comment">      inram function to the RAM destination address:</span>
<a name="l00490"></a>00490 <span class="comment">                memcpy(functionname, // RAM destination address</span>
<a name="l00491"></a>00491 <span class="comment">                      (void*)&amp;__address__functionname, // Flash source address</span>
<a name="l00492"></a>00492 <span class="comment">                      (int)&amp;__size__functionname); // Code size of the function</span>
<a name="l00493"></a>00493 <span class="comment">      In case of LARGE memory model use, call the fmemcpy() function to copy </span>
<a name="l00494"></a>00494 <span class="comment">     the inram function to the RAM destination address:</span>
<a name="l00495"></a>00495 <span class="comment">                 memcpy(functionname, // RAM destination address</span>
<a name="l00496"></a>00496 <span class="comment">                      (void @far*)&amp;__address__functionname, // Flash source address</span>
<a name="l00497"></a>00497 <span class="comment">                      (int)&amp;__size__functionname); // Code size of the function</span>
<a name="l00498"></a>00498 <span class="comment"></span>
<a name="l00499"></a>00499 <span class="comment"> - For IAR Compiler:</span>
<a name="l00500"></a>00500 <span class="comment">    1- Use the __ramfunc keyword in the function declaration to specify that it </span>
<a name="l00501"></a>00501 <span class="comment">    can be executed from RAM.</span>
<a name="l00502"></a>00502 <span class="comment">    This is done within the stm8s_flash.c file, and it&#39;s conditioned by </span>
<a name="l00503"></a>00503 <span class="comment">    RAM_EXECUTION definition.</span>
<a name="l00504"></a>00504 <span class="comment">    2- Uncomment the &quot;#define RAM_EXECUTION  (1)&quot; line in the stm8s.h file, or </span>
<a name="l00505"></a>00505 <span class="comment">   define it in IAR compiler preprocessor to enable the access for the </span>
<a name="l00506"></a>00506 <span class="comment">   __ramfunc functions.</span>
<a name="l00507"></a>00507 <span class="comment"></span>
<a name="l00508"></a>00508 <span class="comment"> - Note: </span>
<a name="l00509"></a>00509 <span class="comment">    1- Ignore the IAR compiler warnings, these warnings don&#39;t impact the FLASH Program/Erase</span>
<a name="l00510"></a>00510 <span class="comment">    operations.</span>
<a name="l00511"></a>00511 <span class="comment">    The code performing the Flash Program/erase must be executed from RAM; the variables</span>
<a name="l00512"></a>00512 <span class="comment">    initializations don&#39;t necessary require the execution from RAM, only CR2/NCR2 registers </span>
<a name="l00513"></a>00513 <span class="comment">    configuration and data programing must be executed from RAM.</span>
<a name="l00514"></a>00514 <span class="comment">    2- These warnings depends on IAR compiler: as the code generation is made using many</span>
<a name="l00515"></a>00515 <span class="comment">    runtime library functions to keep code size to a minimum.</span>
<a name="l00516"></a>00516 <span class="comment">    3- It is recommended to use High Speed Optimization with IAR (-Ohs), in order </span>
<a name="l00517"></a>00517 <span class="comment">    to reduce the runtime library calls in the generated code.</span>
<a name="l00518"></a>00518 <span class="comment"></span>
<a name="l00519"></a>00519 <span class="comment"></span>
<a name="l00520"></a>00520 <span class="comment"></span>
<a name="l00521"></a>00521 <span class="comment"> The FLASH examples given within the STM8S_StdPeriph_Lib package, details all </span>
<a name="l00522"></a>00522 <span class="comment"> the steps described above.</span>
<a name="l00523"></a>00523 <span class="comment"></span>
<a name="l00524"></a>00524 <span class="comment">@endcode</span>
<a name="l00525"></a>00525 <span class="comment">*/</span>
<a name="l00526"></a>00526 <span class="comment"></span>
<a name="l00527"></a>00527 <span class="comment">/**</span>
<a name="l00528"></a>00528 <span class="comment">  * @brief</span>
<a name="l00529"></a>00529 <span class="comment">  *******************************************************************************</span>
<a name="l00530"></a>00530 <span class="comment">  *                         Execution from RAM enable</span>
<a name="l00531"></a>00531 <span class="comment">  *******************************************************************************</span>
<a name="l00532"></a>00532 <span class="comment">  *</span>
<a name="l00533"></a>00533 <span class="comment">  * To enable execution from RAM you can either uncomment the following define </span>
<a name="l00534"></a>00534 <span class="comment">  * in the stm8s.h file or define it in your toolchain compiler preprocessor</span>
<a name="l00535"></a>00535 <span class="comment">  * - #define RAM_EXECUTION  (1) </span>
<a name="l00536"></a>00536 <span class="comment">  */</span>
<a name="l00537"></a>00537   
<a name="l00538"></a>00538 <span class="preprocessor">#if defined (_COSMIC_) &amp;&amp; defined (RAM_EXECUTION)</span>
<a name="l00539"></a>00539 <span class="preprocessor"></span><span class="preprocessor"> #pragma section (FLASH_CODE)</span>
<a name="l00540"></a>00540 <span class="preprocessor"></span><span class="preprocessor">#endif  </span><span class="comment">/* _COSMIC_ &amp;&amp; RAM_EXECUTION */</span>
<a name="l00541"></a>00541 <span class="comment">/**</span>
<a name="l00542"></a>00542 <span class="comment">  * @brief  Wait for a Flash operation to complete.</span>
<a name="l00543"></a>00543 <span class="comment">  * @note   The call and execution of this function must be done from RAM in case</span>
<a name="l00544"></a>00544 <span class="comment">  *         of Block operation.</span>
<a name="l00545"></a>00545 <span class="comment">  * @param  FLASH_MemType : Memory type</span>
<a name="l00546"></a>00546 <span class="comment">  *         This parameter can be a value of @ref FLASH_MemType_TypeDef</span>
<a name="l00547"></a>00547 <span class="comment">  * @retval FLASH status</span>
<a name="l00548"></a>00548 <span class="comment">  */</span>
<a name="l00549"></a>00549 <a class="code" href="group__stm8s__stdperiph__driver.html#ga5a8b983714e65a70c5a6ecf965068654">IN_RAM</a>(<a class="code" href="group__flash__exported__types.html#ga1ef8018415efcf2c925ef84aa24c9541" title="FLASH status of the last operation.">FLASH_Status_TypeDef</a> FLASH_WaitForLastOperation(<a class="code" href="group__flash__exported__types.html#ga2a698e5fed2b9738cfce0ef44c109e58" title="FLASH Memory types.">FLASH_MemType_TypeDef</a> <a class="code" href="tags_8txt.html#acc4b570ade7920d0ab49105dd5d50219">FLASH_MemType</a>)) 
<a name="l00550"></a>00550 {
<a name="l00551"></a>00551   <a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> flagstatus = 0x00;
<a name="l00552"></a>00552   <a class="code" href="group__exported__types.html#ga273cf69d639a59973b6019625df33e30">uint16_t</a> timeout = <a class="code" href="group__stm8s__stdperiph__driver.html#ga89727fe5caa11ee1ba6afe3b11d8808d">OPERATION_TIMEOUT</a>;
<a name="l00553"></a>00553   
<a name="l00554"></a>00554   <span class="comment">/* Wait until operation completion or write protection page occurred */</span>
<a name="l00555"></a>00555 <span class="preprocessor">#if defined (STM8S208) || defined(STM8S207) || defined(STM8S007) || defined(STM8S105) || \</span>
<a name="l00556"></a>00556 <span class="preprocessor">    defined (STM8S005) || defined(STM8AF52Ax) || defined(STM8AF62Ax) || defined(STM8AF626x)  </span>
<a name="l00557"></a>00557 <span class="preprocessor"></span>    <span class="keywordflow">if</span>(FLASH_MemType == <a class="code" href="group__flash__exported__types.html#gga2a698e5fed2b9738cfce0ef44c109e58a1c8f4134115522bc662131cf3d4a9009">FLASH_MEMTYPE_PROG</a>)
<a name="l00558"></a>00558     {
<a name="l00559"></a>00559       <span class="keywordflow">while</span>((flagstatus == 0x00) &amp;&amp; (timeout != 0x00))
<a name="l00560"></a>00560       {
<a name="l00561"></a>00561         flagstatus = (<a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>)(<a class="code" href="stm8s_8h.html#a844ea28ba1e0a5a0e497f16b61ea306b">FLASH</a>-&gt;IAPSR &amp; (<a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>)(<a class="code" href="group__flash__registers__bits__definition.html#ga35a8f94ef216583d9a03a2ea2b20c9f4">FLASH_IAPSR_EOP</a> |
<a name="l00562"></a>00562                                                         <a class="code" href="group__flash__registers__bits__definition.html#gad0dec488d7fd9cc12ab04fe36d60e1c2">FLASH_IAPSR_WR_PG_DIS</a>));
<a name="l00563"></a>00563         timeout--;
<a name="l00564"></a>00564       }
<a name="l00565"></a>00565     }
<a name="l00566"></a>00566     <span class="keywordflow">else</span>
<a name="l00567"></a>00567     {
<a name="l00568"></a>00568       <span class="keywordflow">while</span>((flagstatus == 0x00) &amp;&amp; (timeout != 0x00))
<a name="l00569"></a>00569       {
<a name="l00570"></a>00570         flagstatus = (<a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>)(<a class="code" href="stm8s_8h.html#a844ea28ba1e0a5a0e497f16b61ea306b">FLASH</a>-&gt;IAPSR &amp; (<a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>)(<a class="code" href="group__flash__registers__bits__definition.html#ga462e5681e6b83981a4cb39e005e434b6">FLASH_IAPSR_HVOFF</a> |
<a name="l00571"></a>00571                                                         <a class="code" href="group__flash__registers__bits__definition.html#gad0dec488d7fd9cc12ab04fe36d60e1c2">FLASH_IAPSR_WR_PG_DIS</a>));
<a name="l00572"></a>00572         timeout--;
<a name="l00573"></a>00573       }
<a name="l00574"></a>00574     }
<a name="l00575"></a>00575 <span class="preprocessor">#else </span><span class="comment">/*STM8S103, STM8S001, STM8S903, STM8AF622x */</span>
<a name="l00576"></a>00576   <a class="code" href="stm8s_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(FLASH_MemType);
<a name="l00577"></a>00577   <span class="keywordflow">while</span>((flagstatus == 0x00) &amp;&amp; (timeout != 0x00))
<a name="l00578"></a>00578   {
<a name="l00579"></a>00579     flagstatus = (<a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>)(<a class="code" href="stm8s_8h.html#a844ea28ba1e0a5a0e497f16b61ea306b">FLASH</a>-&gt;IAPSR &amp; (<a class="code" href="group__flash__registers__bits__definition.html#ga35a8f94ef216583d9a03a2ea2b20c9f4">FLASH_IAPSR_EOP</a> | <a class="code" href="group__flash__registers__bits__definition.html#gad0dec488d7fd9cc12ab04fe36d60e1c2">FLASH_IAPSR_WR_PG_DIS</a>));
<a name="l00580"></a>00580     timeout--;
<a name="l00581"></a>00581   }
<a name="l00582"></a>00582 <span class="preprocessor">#endif </span><span class="comment">/* STM8S208, STM8S207, STM8S105, STM8AF52Ax, STM8AF62Ax, STM8AF262x */</span>
<a name="l00583"></a>00583   
<a name="l00584"></a>00584   <span class="keywordflow">if</span>(timeout == 0x00 )
<a name="l00585"></a>00585   {
<a name="l00586"></a>00586     flagstatus = <a class="code" href="group__flash__exported__types.html#gga1ef8018415efcf2c925ef84aa24c9541afd8e3ea8e332f3b66c0e7db8779ea197">FLASH_STATUS_TIMEOUT</a>;
<a name="l00587"></a>00587   }
<a name="l00588"></a>00588   
<a name="l00589"></a>00589   <span class="keywordflow">return</span>((<a class="code" href="group__flash__exported__types.html#ga1ef8018415efcf2c925ef84aa24c9541" title="FLASH status of the last operation.">FLASH_Status_TypeDef</a>)flagstatus);
<a name="l00590"></a>00590 }
<a name="l00591"></a>00591 <span class="comment"></span>
<a name="l00592"></a>00592 <span class="comment">/**</span>
<a name="l00593"></a>00593 <span class="comment">  * @brief  Erases a block in the program or data memory.</span>
<a name="l00594"></a>00594 <span class="comment">  * @note   This function should be executed from RAM.</span>
<a name="l00595"></a>00595 <span class="comment">  * @param  FLASH_MemType :  The type of memory to erase</span>
<a name="l00596"></a>00596 <span class="comment">  * @param  BlockNum : Indicates the block number to erase</span>
<a name="l00597"></a>00597 <span class="comment">  * @retval None.</span>
<a name="l00598"></a>00598 <span class="comment">  */</span>
<a name="l00599"></a>00599 <a class="code" href="group__stm8s__stdperiph__driver.html#ga5a8b983714e65a70c5a6ecf965068654">IN_RAM</a>(<span class="keywordtype">void</span> FLASH_EraseBlock(<a class="code" href="group__exported__types.html#ga273cf69d639a59973b6019625df33e30">uint16_t</a> BlockNum, <a class="code" href="group__flash__exported__types.html#ga2a698e5fed2b9738cfce0ef44c109e58" title="FLASH Memory types.">FLASH_MemType_TypeDef</a> FLASH_MemType))
<a name="l00600"></a>00600 {
<a name="l00601"></a>00601   <a class="code" href="group__exported__types.html#ga06896e8c53f721507066c079052171f8">uint32_t</a> startaddress = 0;
<a name="l00602"></a>00602   
<a name="l00603"></a>00603 <span class="preprocessor">#if defined(STM8S105) || defined(STM8S005) || defined(STM8S103) || defined(STM8S003) || \</span>
<a name="l00604"></a>00604 <span class="preprocessor">    defined(STM8S001) || defined(STM8S903) || defined (STM8AF626x) || defined (STM8AF622x)</span>
<a name="l00605"></a>00605 <span class="preprocessor"></span>    <a class="code" href="group__exported__types.html#ga06896e8c53f721507066c079052171f8">uint32_t</a> <a class="code" href="group__stm8s__stdperiph__driver.html#ga1e44c0b03b9a8fa8fca626d23bd66851">PointerAttr</a>  *pwFlash;
<a name="l00606"></a>00606 <span class="preprocessor">#elif defined (STM8S208) || defined(STM8S207) || defined(STM8S007) || defined (STM8AF62Ax) || defined (STM8AF52Ax) </span>
<a name="l00607"></a>00607 <span class="preprocessor"></span>  <a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> <a class="code" href="group__stm8s__stdperiph__driver.html#ga1e44c0b03b9a8fa8fca626d23bd66851">PointerAttr</a>  *pwFlash;
<a name="l00608"></a>00608 <span class="preprocessor">#endif</span>
<a name="l00609"></a>00609 <span class="preprocessor"></span>  
<a name="l00610"></a>00610   <span class="comment">/* Check parameters */</span>
<a name="l00611"></a>00611   <a class="code" href="stm8s__stdperiph__examples_2adc2_2adc2__continuousconversion_2stm8s__conf_8h.html#a631dea7b230e600555f979c62af1de21" title="The assert_param macro is used for function&#39;s parameters check.">assert_param</a>(<a class="code" href="group__flash__private__macros.html#gaae738a21b75a1af104e567a3918aaef9" title="Macro used by the assert function in order to check the different sensitivity values for the flash me...">IS_MEMORY_TYPE_OK</a>(FLASH_MemType));
<a name="l00612"></a>00612   <span class="keywordflow">if</span>(FLASH_MemType == <a class="code" href="group__flash__exported__types.html#gga2a698e5fed2b9738cfce0ef44c109e58a1c8f4134115522bc662131cf3d4a9009">FLASH_MEMTYPE_PROG</a>)
<a name="l00613"></a>00613   {
<a name="l00614"></a>00614     <a class="code" href="stm8s__stdperiph__examples_2adc2_2adc2__continuousconversion_2stm8s__conf_8h.html#a631dea7b230e600555f979c62af1de21" title="The assert_param macro is used for function&#39;s parameters check.">assert_param</a>(<a class="code" href="group__flash__private__macros.html#ga9d9adeabf6ffc84c682f733ed8e47342" title="Macro used by the assert function in order to check the different sensitivity values for the flash pr...">IS_FLASH_PROG_BLOCK_NUMBER_OK</a>(BlockNum));
<a name="l00615"></a>00615     startaddress = <a class="code" href="group__flash__exported__constants.html#ga48567c7db8d449e8c7146a3cbbb65b3f">FLASH_PROG_START_PHYSICAL_ADDRESS</a>;
<a name="l00616"></a>00616   }
<a name="l00617"></a>00617   <span class="keywordflow">else</span>
<a name="l00618"></a>00618   {
<a name="l00619"></a>00619     <a class="code" href="stm8s__stdperiph__examples_2adc2_2adc2__continuousconversion_2stm8s__conf_8h.html#a631dea7b230e600555f979c62af1de21" title="The assert_param macro is used for function&#39;s parameters check.">assert_param</a>(<a class="code" href="group__flash__private__macros.html#ga86ad6cfcfe5701834a4bd9de177e9b2b" title="Macro used by the assert function in order to check the different sensitivity values for the data eep...">IS_FLASH_DATA_BLOCK_NUMBER_OK</a>(BlockNum));
<a name="l00620"></a>00620     startaddress = FLASH_DATA_START_PHYSICAL_ADDRESS;
<a name="l00621"></a>00621   }
<a name="l00622"></a>00622   
<a name="l00623"></a>00623   <span class="comment">/* Point to the first block address */</span>
<a name="l00624"></a>00624 <span class="preprocessor">#if defined (STM8S208) || defined(STM8S207) || defined(STM8S007) || defined (STM8AF62Ax) || defined (STM8AF52Ax)</span>
<a name="l00625"></a>00625 <span class="preprocessor"></span>  pwFlash = (<a class="code" href="group__stm8s__stdperiph__driver.html#ga1e44c0b03b9a8fa8fca626d23bd66851">PointerAttr</a> <a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> *)(<a class="code" href="group__stm8s__stdperiph__driver.html#ga28ff3e784e008f7e7c75cd51df83920d">MemoryAddressCast</a>)(startaddress + ((<a class="code" href="group__exported__types.html#ga06896e8c53f721507066c079052171f8">uint32_t</a>)BlockNum * FLASH_BLOCK_SIZE));
<a name="l00626"></a>00626 <span class="preprocessor">#elif defined(STM8S105) || defined(STM8S005) || defined(STM8S103) || defined(STM8S003) || \</span>
<a name="l00627"></a>00627 <span class="preprocessor">      defined(STM8S001) || defined (STM8S903) || defined (STM8AF626x) || defined (STM8AF622x)</span>
<a name="l00628"></a>00628 <span class="preprocessor"></span>    pwFlash = (<a class="code" href="group__stm8s__stdperiph__driver.html#ga1e44c0b03b9a8fa8fca626d23bd66851">PointerAttr</a> <a class="code" href="group__exported__types.html#ga06896e8c53f721507066c079052171f8">uint32_t</a> *)(<a class="code" href="group__stm8s__stdperiph__driver.html#ga28ff3e784e008f7e7c75cd51df83920d">MemoryAddressCast</a>)(startaddress + ((<a class="code" href="group__exported__types.html#ga06896e8c53f721507066c079052171f8">uint32_t</a>)BlockNum * FLASH_BLOCK_SIZE));
<a name="l00629"></a>00629 <span class="preprocessor">#endif  </span><span class="comment">/* STM8S208, STM8S207 */</span>
<a name="l00630"></a>00630   
<a name="l00631"></a>00631   <span class="comment">/* Enable erase block mode */</span>
<a name="l00632"></a>00632   <a class="code" href="stm8s_8h.html#a844ea28ba1e0a5a0e497f16b61ea306b">FLASH</a>-&gt;CR2 |= <a class="code" href="group__flash__registers__bits__definition.html#gab2357de72a300a00e6d60de621f7440c">FLASH_CR2_ERASE</a>;
<a name="l00633"></a>00633   <a class="code" href="stm8s_8h.html#a844ea28ba1e0a5a0e497f16b61ea306b">FLASH</a>-&gt;NCR2 &amp;= (<a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>)(~<a class="code" href="group__flash__registers__bits__definition.html#ga271b50e8780a38c3f578d87251f74c77">FLASH_NCR2_NERASE</a>);
<a name="l00634"></a>00634   
<a name="l00635"></a>00635 <span class="preprocessor">#if defined(STM8S105) || defined(STM8S005) || defined(STM8S103) || defined(STM8S003) ||  \</span>
<a name="l00636"></a>00636 <span class="preprocessor">    defined(STM8S001) || defined(STM8S903) || defined (STM8AF626x) || defined (STM8AF622x)</span>
<a name="l00637"></a>00637 <span class="preprocessor"></span>    *pwFlash = (<a class="code" href="group__exported__types.html#ga06896e8c53f721507066c079052171f8">uint32_t</a>)0;
<a name="l00638"></a>00638 <span class="preprocessor">#elif defined (STM8S208) || defined(STM8S207) || defined(STM8S007) || defined (STM8AF62Ax) || \</span>
<a name="l00639"></a>00639 <span class="preprocessor">  defined (STM8AF52Ax)</span>
<a name="l00640"></a>00640 <span class="preprocessor"></span>    *pwFlash = (<a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>)0;
<a name="l00641"></a>00641   *(pwFlash + 1) = (<a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>)0;
<a name="l00642"></a>00642   *(pwFlash + 2) = (<a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>)0;
<a name="l00643"></a>00643   *(pwFlash + 3) = (<a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>)0;    
<a name="l00644"></a>00644 <span class="preprocessor">#endif</span>
<a name="l00645"></a>00645 <span class="preprocessor"></span>}
<a name="l00646"></a>00646 <span class="comment"></span>
<a name="l00647"></a>00647 <span class="comment">/**</span>
<a name="l00648"></a>00648 <span class="comment">  * @brief  Programs a memory block</span>
<a name="l00649"></a>00649 <span class="comment">  * @note   This function should be executed from RAM.</span>
<a name="l00650"></a>00650 <span class="comment">  * @param  FLASH_MemType : The type of memory to program</span>
<a name="l00651"></a>00651 <span class="comment">  * @param  BlockNum : The block number</span>
<a name="l00652"></a>00652 <span class="comment">  * @param  FLASH_ProgMode : The programming mode.</span>
<a name="l00653"></a>00653 <span class="comment">  * @param  Buffer : Pointer to buffer containing source data.</span>
<a name="l00654"></a>00654 <span class="comment">  * @retval None.</span>
<a name="l00655"></a>00655 <span class="comment">  */</span>
<a name="l00656"></a>00656 <a class="code" href="group__stm8s__stdperiph__driver.html#ga5a8b983714e65a70c5a6ecf965068654">IN_RAM</a>(<span class="keywordtype">void</span> FLASH_ProgramBlock(<a class="code" href="group__exported__types.html#ga273cf69d639a59973b6019625df33e30">uint16_t</a> BlockNum, <a class="code" href="group__flash__exported__types.html#ga2a698e5fed2b9738cfce0ef44c109e58" title="FLASH Memory types.">FLASH_MemType_TypeDef</a> FLASH_MemType, 
<a name="l00657"></a>00657                         <a class="code" href="group__flash__exported__types.html#ga1e86181281cd4fca8e74de7343f99446" title="FLASH programming modes.">FLASH_ProgramMode_TypeDef</a> <a class="code" href="tags_8txt.html#a292ca069eee783bdd9efe03eef967202">FLASH_ProgMode</a>, <a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> *Buffer))
<a name="l00658"></a>00658 {
<a name="l00659"></a>00659   <a class="code" href="group__exported__types.html#ga273cf69d639a59973b6019625df33e30">uint16_t</a> Count = 0;
<a name="l00660"></a>00660   <a class="code" href="group__exported__types.html#ga06896e8c53f721507066c079052171f8">uint32_t</a> startaddress = 0;
<a name="l00661"></a>00661   
<a name="l00662"></a>00662   <span class="comment">/* Check parameters */</span>
<a name="l00663"></a>00663   <a class="code" href="stm8s__stdperiph__examples_2adc2_2adc2__continuousconversion_2stm8s__conf_8h.html#a631dea7b230e600555f979c62af1de21" title="The assert_param macro is used for function&#39;s parameters check.">assert_param</a>(<a class="code" href="group__flash__private__macros.html#gaae738a21b75a1af104e567a3918aaef9" title="Macro used by the assert function in order to check the different sensitivity values for the flash me...">IS_MEMORY_TYPE_OK</a>(FLASH_MemType));
<a name="l00664"></a>00664   <a class="code" href="stm8s__stdperiph__examples_2adc2_2adc2__continuousconversion_2stm8s__conf_8h.html#a631dea7b230e600555f979c62af1de21" title="The assert_param macro is used for function&#39;s parameters check.">assert_param</a>(<a class="code" href="group__flash__private__macros.html#ga808497762ac822b2115cfd4ad3b8eca5" title="Macro used by the assert function in order to check the different sensitivity values for the flash pr...">IS_FLASH_PROGRAM_MODE_OK</a>(FLASH_ProgMode));
<a name="l00665"></a>00665   <span class="keywordflow">if</span>(FLASH_MemType == <a class="code" href="group__flash__exported__types.html#gga2a698e5fed2b9738cfce0ef44c109e58a1c8f4134115522bc662131cf3d4a9009">FLASH_MEMTYPE_PROG</a>)
<a name="l00666"></a>00666   {
<a name="l00667"></a>00667     <a class="code" href="stm8s__stdperiph__examples_2adc2_2adc2__continuousconversion_2stm8s__conf_8h.html#a631dea7b230e600555f979c62af1de21" title="The assert_param macro is used for function&#39;s parameters check.">assert_param</a>(<a class="code" href="group__flash__private__macros.html#ga9d9adeabf6ffc84c682f733ed8e47342" title="Macro used by the assert function in order to check the different sensitivity values for the flash pr...">IS_FLASH_PROG_BLOCK_NUMBER_OK</a>(BlockNum));
<a name="l00668"></a>00668     startaddress = <a class="code" href="group__flash__exported__constants.html#ga48567c7db8d449e8c7146a3cbbb65b3f">FLASH_PROG_START_PHYSICAL_ADDRESS</a>;
<a name="l00669"></a>00669   }
<a name="l00670"></a>00670   <span class="keywordflow">else</span>
<a name="l00671"></a>00671   {
<a name="l00672"></a>00672     <a class="code" href="stm8s__stdperiph__examples_2adc2_2adc2__continuousconversion_2stm8s__conf_8h.html#a631dea7b230e600555f979c62af1de21" title="The assert_param macro is used for function&#39;s parameters check.">assert_param</a>(<a class="code" href="group__flash__private__macros.html#ga86ad6cfcfe5701834a4bd9de177e9b2b" title="Macro used by the assert function in order to check the different sensitivity values for the data eep...">IS_FLASH_DATA_BLOCK_NUMBER_OK</a>(BlockNum));
<a name="l00673"></a>00673     startaddress = FLASH_DATA_START_PHYSICAL_ADDRESS;
<a name="l00674"></a>00674   }
<a name="l00675"></a>00675   
<a name="l00676"></a>00676   <span class="comment">/* Point to the first block address */</span>
<a name="l00677"></a>00677   startaddress = startaddress + ((<a class="code" href="group__exported__types.html#ga06896e8c53f721507066c079052171f8">uint32_t</a>)BlockNum * FLASH_BLOCK_SIZE);
<a name="l00678"></a>00678   
<a name="l00679"></a>00679   <span class="comment">/* Selection of Standard or Fast programming mode */</span>
<a name="l00680"></a>00680   <span class="keywordflow">if</span>(FLASH_ProgMode == <a class="code" href="group__flash__exported__types.html#gga1e86181281cd4fca8e74de7343f99446a06c258783957a79c51d202d314168066">FLASH_PROGRAMMODE_STANDARD</a>)
<a name="l00681"></a>00681   {
<a name="l00682"></a>00682     <span class="comment">/* Standard programming mode */</span> <span class="comment">/*No need in standard mode */</span>
<a name="l00683"></a>00683     <a class="code" href="stm8s_8h.html#a844ea28ba1e0a5a0e497f16b61ea306b">FLASH</a>-&gt;CR2 |= <a class="code" href="group__flash__registers__bits__definition.html#gaf04700cefef948fc6f45d46ba3c43f88">FLASH_CR2_PRG</a>;
<a name="l00684"></a>00684     <a class="code" href="stm8s_8h.html#a844ea28ba1e0a5a0e497f16b61ea306b">FLASH</a>-&gt;NCR2 &amp;= (<a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>)(~<a class="code" href="group__flash__registers__bits__definition.html#ga4dac6097fa6defd267c0a3b8c7929ec2">FLASH_NCR2_NPRG</a>);
<a name="l00685"></a>00685   }
<a name="l00686"></a>00686   <span class="keywordflow">else</span>
<a name="l00687"></a>00687   {
<a name="l00688"></a>00688     <span class="comment">/* Fast programming mode */</span>
<a name="l00689"></a>00689     <a class="code" href="stm8s_8h.html#a844ea28ba1e0a5a0e497f16b61ea306b">FLASH</a>-&gt;CR2 |= <a class="code" href="group__flash__registers__bits__definition.html#gadc64903ced73cb5f3f6d582adb7b1d7b">FLASH_CR2_FPRG</a>;
<a name="l00690"></a>00690     <a class="code" href="stm8s_8h.html#a844ea28ba1e0a5a0e497f16b61ea306b">FLASH</a>-&gt;NCR2 &amp;= (<a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>)(~<a class="code" href="group__flash__registers__bits__definition.html#ga695d2868a6c8eb80a8400440aa0bc6bd">FLASH_NCR2_NFPRG</a>);
<a name="l00691"></a>00691   }
<a name="l00692"></a>00692   
<a name="l00693"></a>00693   <span class="comment">/* Copy data bytes from RAM to FLASH memory */</span>
<a name="l00694"></a>00694   <span class="keywordflow">for</span>(Count = 0; Count &lt; FLASH_BLOCK_SIZE; Count++)
<a name="l00695"></a>00695   {
<a name="l00696"></a>00696     *((<a class="code" href="group__stm8s__stdperiph__driver.html#ga1e44c0b03b9a8fa8fca626d23bd66851">PointerAttr</a> <a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>*) (<a class="code" href="group__stm8s__stdperiph__driver.html#ga28ff3e784e008f7e7c75cd51df83920d">MemoryAddressCast</a>)startaddress + Count) = ((<a class="code" href="group__exported__types.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>)(Buffer[Count]));
<a name="l00697"></a>00697   }
<a name="l00698"></a>00698 }
<a name="l00699"></a>00699 
<a name="l00700"></a>00700 <span class="preprocessor">#if defined (_COSMIC_) &amp;&amp; defined (RAM_EXECUTION)</span>
<a name="l00701"></a>00701 <span class="preprocessor"></span> <span class="comment">/* End of FLASH_CODE section */</span>
<a name="l00702"></a>00702 <span class="preprocessor"> #pragma section ()</span>
<a name="l00703"></a>00703 <span class="preprocessor"></span><span class="preprocessor">#endif </span><span class="comment">/* _COSMIC_ &amp;&amp; RAM_EXECUTION */</span>
<a name="l00704"></a>00704 <span class="comment"></span>
<a name="l00705"></a>00705 <span class="comment">/**</span>
<a name="l00706"></a>00706 <span class="comment">  * @}</span>
<a name="l00707"></a>00707 <span class="comment">  */</span>
<a name="l00708"></a>00708   <span class="comment"></span>
<a name="l00709"></a>00709 <span class="comment">/**</span>
<a name="l00710"></a>00710 <span class="comment">  * @}</span>
<a name="l00711"></a>00711 <span class="comment">  */</span>
<a name="l00712"></a>00712 
<a name="l00713"></a>00713 <span class="comment">/************************ (C) COPYRIGHT STMicroelectronics *****END OF FILE****/</span>
</pre></div></div>
</div>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html xmlns:v="urn:schemas-microsoft-com:vml" xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:w="urn:schemas-microsoft-com:office:word" xmlns="http://www.w3.org/TR/REC-html40"><head>

<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<link rel="File-List" href="footer_files/filelist.xml"><title>STM8 Standard Peripherals Library: Footer</title><!--[if gte mso 9]><xml>
 <o:DocumentProperties>
  <o:Author>STMicroelectronics</o:Author>
  <o:LastAuthor>STMicroelectronics</o:LastAuthor>
  <o:Revision>96</o:Revision>
  <o:TotalTime>61</o:TotalTime>
  <o:Created>2009-02-27T18:59:00Z</o:Created>
  <o:LastSaved>2009-03-01T17:58:00Z</o:LastSaved>
  <o:Pages>1</o:Pages>
  <o:Words>25</o:Words>
  <o:Characters>149</o:Characters>
  <o:Company>STMicroelectronics</o:Company>
  <o:Lines>1</o:Lines>
  <o:Paragraphs>1</o:Paragraphs>
  <o:CharactersWithSpaces>173</o:CharactersWithSpaces>
  <o:Version>11.6568</o:Version>
 </o:DocumentProperties>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:WordDocument>
  <w:Zoom>110</w:Zoom>
  <w:SpellingState>Clean</w:SpellingState>
  <w:GrammarState>Clean</w:GrammarState>
  <w:ValidateAgainstSchemas/>
  <w:SaveIfXMLInvalid>false</w:SaveIfXMLInvalid>
  <w:IgnoreMixedContent>false</w:IgnoreMixedContent>
  <w:AlwaysShowPlaceholderText>false</w:AlwaysShowPlaceholderText>
  <w:BrowserLevel>MicrosoftInternetExplorer4</w:BrowserLevel>
 </w:WordDocument>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:LatentStyles DefLockedState="false" LatentStyleCount="156">
 </w:LatentStyles>
</xml><![endif]-->


<style>
<!--
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
	{mso-style-parent:"";
	margin:0in;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";}
h1
	{mso-margin-top-alt:auto;
	margin-right:0in;
	mso-margin-bottom-alt:auto;
	margin-left:0in;
	mso-pagination:widow-orphan;
	mso-outline-level:1;
	font-size:24.0pt;
	font-family:"Times New Roman";
	font-weight:bold;}
h2
	{mso-style-next:Normal;
	margin-top:12.0pt;
	margin-right:0in;
	margin-bottom:3.0pt;
	margin-left:0in;
	mso-pagination:widow-orphan;
	page-break-after:avoid;
	mso-outline-level:2;
	font-size:14.0pt;
	font-family:Arial;
	font-weight:bold;
	font-style:italic;}
p.MsoCaption, li.MsoCaption, div.MsoCaption
	{mso-style-noshow:yes;
	mso-style-next:Normal;
	margin:0in;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:10.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";
	font-weight:bold;}
a:link, span.MsoHyperlink
	{color:blue;
	text-decoration:underline;
	text-underline:single;}
a:visited, span.MsoHyperlinkFollowed
	{color:#606420;
	text-decoration:underline;
	text-underline:single;}
p
	{mso-margin-top-alt:auto;
	margin-right:0in;
	mso-margin-bottom-alt:auto;
	margin-left:0in;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";}
p.StyleHeading1Arial135ptItalicBlack, li.StyleHeading1Arial135ptItalicBlack, div.StyleHeading1Arial135ptItalicBlack
	{mso-style-name:"Style Heading 1 + Arial 13\.5 pt Italic Black";
	mso-style-parent:"Heading 1";
	mso-margin-top-alt:auto;
	margin-right:0in;
	mso-margin-bottom-alt:auto;
	margin-left:0in;
	mso-pagination:widow-orphan;
	mso-outline-level:1;
	font-size:16.0pt;
	mso-bidi-font-size:24.0pt;
	font-family:Arial;
	mso-fareast-font-family:"Times New Roman";
	mso-bidi-font-family:"Times New Roman";
	color:black;
	mso-font-kerning:18.0pt;
	font-weight:bold;
	font-style:italic;}
@page Section1
	{size:8.5in 11.0in;
	margin:1.0in 1.25in 1.0in 1.25in;
	mso-header-margin:.5in;
	mso-footer-margin:.5in;
	mso-paper-source:0;}
div.Section1
	{page:Section1;}
-->
</style><!--[if gte mso 10]>
<style>
 /* Style Definitions */
 table.MsoNormalTable
	{mso-style-name:"Table Normal";
	mso-tstyle-rowband-size:0;
	mso-tstyle-colband-size:0;
	mso-style-noshow:yes;
	mso-style-parent:"";
	mso-padding-alt:0in 5.4pt 0in 5.4pt;
	mso-para-margin:0in;
	mso-para-margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:10.0pt;
	font-family:"Times New Roman";
	mso-ansi-language:#0400;
	mso-fareast-language:#0400;
	mso-bidi-language:#0400;}
</style>
<![endif]--><!--[if gte mso 9]><xml>
 <o:shapedefaults v:ext="edit" spidmax="23554"/>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <o:shapelayout v:ext="edit">
  <o:idmap v:ext="edit" data="1"/>
 </o:shapelayout></xml><![endif]--></head>
<body style="" link="blue" vlink="#606420">

<div class="Section1">

<p style="margin-top: 13px; height: 7px;" class="MsoNormal"><o:p>&nbsp;</o:p></p>

<div align="center">

<table class="MsoNormalTable" style="width: 903px; height: 120px;" border="0" cellpadding="0" cellspacing="0">
 <tbody><tr style="">
  <td style="padding: 0in;" valign="top">
  <p style="height: 13px;" class="MsoNormal"><span style="display: none;"><o:p>&nbsp;</o:p></span></p>
  <table class="MsoNormalTable" style="width: 675pt;" border="0" cellpadding="0" width="900">
   <tbody><tr style="">
    <td style="padding: 0in;" valign="top">
    <table class="MsoNormalTable" style="width: 864px; height: 53px;" border="0" cellpadding="0" cellspacing="5">
     <tbody><tr style="">
      <td style="border-style: solid none none; border-color: windowtext -moz-use-text-color -moz-use-text-color; border-width: 1pt medium medium; padding: 0in; width: 98.86%; height: 61px;" width="98%">
      
      <p class="MsoNormal" style="text-align: center; height: 10px;" align="center"><span style="font-size: 10pt; font-family: Arial;"><o:p>&nbsp;</o:p></span></p>
<span style="font-size: 10pt; font-family: Arial;">&nbsp; &nbsp; &nbsp; For complete
documentation on STM8 8-bit Microcontrollers platform visit&nbsp;<span style="color: blue;"><a href="http://www.st.com/internet/mcu/family/141.jsp" target="_blank">www.st.com</a></span></span><p class="MsoNormal" style="text-align: center; margin-top: 0px; height: 5px;" align="center"></p>
      </td>
     </tr>
    </tbody></table>
    <p style="height: 12px;" class="MsoNormal"><span style="font-size: 10pt;"><o:p></o:p></span></p>
    </td>
   </tr>
  </tbody></table>
  <p class="MsoNormal"><span style="font-size: 10pt;"><o:p></o:p></span></p>
  </td>
 </tr>
</tbody></table>

</div>

<p class="MsoNormal"><o:p>&nbsp;</o:p></p>

</div>

</body></html>
